Public MustInherit Class FormulaBase
    Public MustInherit Function Formula(ByVal p as Parameters) as Result
    Public MustInherit Function GetXML() as Text.StringBuilder
End Class

Public Class SumFormula
    Inherits FormulaBase

    Public Shared ReadOnly Property XMLTag() As String
        Get
            Return "sum"
        End Get
    End Property

    Private X As FormulaBase
    Private Y As FormulaBase

    Public Sub New(ByVal xmlText as Xml.XmlNode)
        ' Code to obtain read the sum parameters form XML.'
    End Sub

    Public Overrides Function Formula(ByVal p as Parameters) as Result
        Return X.Formula(p) + Y.Formula(p)
    End Function

    Public Override Function GetXml() as Text.StringBuilder
        Return New Text.StringBuilder().Append("<sum>").Append(X.GetXml()).Append(Y.GetXml()).Append("</sum>")
    End Function
End Class

Public NotInheritable Class FormulaFactory
    Private Shared Formulas As Dictionary(Of String, Reflection.ConstructorInfo) = InitializeFormulas()

    Private Shared Sub Add(ByVal collection As Dictionary(Of String, Reflection.ConstructorInfo), ByVal formula as Type)
        ' Some code to extract the contructor and XmlTag from each class and add them to the dictionary.'
    End Sub

    Private Shared Function InitializeFormulas() As Dictionary(Of String, Reflection.ConstructorInfo)
        Dim Collection As New Dictionary(Of String, Reflection.ConstructorInfo)
        Add(Collection, GetType(SumFormula))
        Return Collection
    End Sub

    Public Shared Function ConstructFormula(xmlText as Xml.XmlNode) as FormulaBase
        Return DirectCast(Formulas(xmlText).Invoke(New Object(){xmlText}), FormulaBase)
    End Function
End Class

