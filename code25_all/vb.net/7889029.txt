    Private Sub doRead(ByVal ar As System.IAsyncResult)
    Dim totalRead As Integer
    Try
        totalRead = client.GetStream.EndRead(ar) 'Ends the reading and returns the number of bytes read.
    Catch ex As Exception
        'The underlying socket have probably been closed OR an error has occured whilst trying to access it, either way, this is where you should remove close all eventuall connections
        'to this client and remove it from the list of connected clients.
    End Try

    If totalRead > 0 Then
        'the readBuffer array will contain everything read from the client.
        Dim receivedString As String = System.Text.Encoding.UTF8.GetString(readBuffer, 0, totalRead)
        messageReceived(receivedString)
    End If
    Try
        client.GetStream.BeginRead(readBuffer, 0, BYTES_TO_READ, AddressOf doRead, Nothing) 'Begin the reading again.
    Catch ex As Exception
        'The underlying socket have probably been closed OR an error has occured whilst trying to access it, either way, this is where you should remove close all eventuall connections
        'to this client and remove it from the list of connected clients.
        MessageBox.Show(ex.ToString)
    End Try
End Sub

 Private Sub messageReceived(ByVal message As String)
    Dim data() As String = message.Split("|"c)
    Select Case data(0)
        Case "MESSAGE"

            Dim chatDialog As New RichTextBox
            Try
                If conversations.ContainsKey(data(1)) Then
                    Dim convoWindow As ChatWindow
                    convoWindow = New ChatWindow
                    convoWindow = conversations.Item(data(1))
                    chatDialog = convoWindow.RichTextBox1
                Else
                    Try
                        Dim convoWindow As New ChatWindow()

                        conversations.Add(data(1), convoWindow)
                        convoWindow = conversations.Item(data(1))
                        convoWindow.ShowDialog()
                        chatDialog = convoWindow.RichTextBox1
                        AppendTextChatWindows(data(2), chatDialog)

