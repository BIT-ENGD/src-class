Imports System.Net.Sockets
Imports System.Windows.Forms
Imports System.IO
Imports System.Threading

Public Class recieve

Private reader As BinaryReader
Private message As String = ""
Private frmObject As frmMain
Private readthred As Thread
Private Delegate Sub af(ByVal item As String)
Public Sub fun(ByVal item As String)
    If (frmMain.ListBox1.InvokeRequired()) Then
        frmMain.ListBox1.Invoke(New af(AddressOf fun))
        frmMain.ListBox1.Items.Add(item)
    Else
        frmMain.ListBox1.Items.Add(item)

    End If
End Sub
Public Sub New(ByVal frmObject As frmMain)
    MyBase.New()
    Me.frmObject = frmObject
    readthred = New Thread(AddressOf runClinet)
    readthred.SetApartmentState(ApartmentState.STA)
    readthred.Start()

End Sub



Public Sub runClinet()
    Dim client As TcpClient
    Try
        client = New TcpClient()
        client.Connect("127.0.0.1", 5234)
        reader = New BinaryReader(client.GetStream())
        Try
            Dim Path As String
            Path = reader.ReadString
            frmMain.ListBox1.SelectedItem = Path

            frmObject.Playlist.SelectedItem = frmObject.ListBox1.SelectedItem
            frmMain.AxWindowsMediaPlayer1.URL = Path
            frmObject.ListBox1.Items.Add(Path)
            frmObject.Playlist.Items.Add(Path)
            Try
                While True
                    Path = reader.ReadString
                    Select Case Path
                        Case "1"
                            frmObject.AxWindowsMediaPlayer1.Ctlcontrols.pause()
                        Case "2"
                            frmObject.AxWindowsMediaPlayer1.Ctlcontrols.play()
                        Case "3"
                            frmObject.AxWindowsMediaPlayer1.Ctlcontrols.stop()
                    End Select
                End While
            Catch ex As Exception
            End Try
        Catch inputoutputException As IOException
        Finally
        End Try
        Try
            frmObject.AxWindowsMediaPlayer1.Ctlcontrols.stop()
            reader.Close()
            client.Close()
        Catch exx As Exception
        End Try
    Catch inputoutputException As IOException
    End Try
End Sub

