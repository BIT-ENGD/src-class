Dim DNS As String() = {"192.168.1.1", "192.168.1.2"}

Dim objMC As ManagementClass = New ManagementClass("Win32_NetworkAdapterConfiguration")
Dim objMOC As ManagementObjectCollection = objMC.GetInstances()

For Each objMO As ManagementObject In objMOC
    If (Not CBool(objMO("IPEnabled"))) Then
        Continue For
    End If

    Try
        Dim objSetIP As ManagementBaseObject = Nothing
        Dim objNewDNS As ManagementBaseObject = Nothing
        objNewDNS = objMO.GetMethodParameters("SetDNSServerSearchOrder")

        'Set DNS to DHCP
        objNewDNS("DNSServerSearchOrder") = New String() {DNS()}
        objSetIP = objMO.InvokeMethod("SetDNSServerSearchOrder", objNewDNS, Nothing)
        Console.WriteLine("Updated IPAddress, SubnetMask and Default Gateway!")
    Catch ex As Exception
        MessageBox.Show("Unable to Set IP : " & ex.Message)
    End Try
Next objMO

