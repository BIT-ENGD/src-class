Imports System.IO

Public Function Send(ByVal URL As String, _
    Optional ByVal PostData As String = "", _
    Optional ByVal Method As String = "", _
    Optional ByVal ContentType As String = "")


    Dim request As HttpWebRequest
    request = WebRequest.Create(URL)

    request.ServicePoint.Expect100Continue = False

    Dim Response As HttpWebResponse

    Dim SW As StreamWriter
    Dim SR As StreamReader
    Dim ResponseData As String

    If UseProxy = 1 Then
        request.Proxy = New WebProxy(Proxy, Port)

    End If

    ' Prepare Request Object
    request.Method = Method

    ' Set form/post content-type if necessary
    If (Method = "POST" AndAlso PostData <> "" AndAlso ContentType = "") Then
        ContentType = "application/x-www-form-urlencoded"
    End If

    ' Set Content-Type
    If (ContentType <> "") Then
        request.ContentType = ContentType
        request.ContentLength = PostData.Length
    End If

    ' Send Request, If Request
    If (Method = "POST") Then
        ' Try
        SW = New StreamWriter(request.GetRequestStream())
        SW.Write(PostData)
        ' Catch Ex As Exception
        'Throw Ex
        ' Finally
        'SW.Close()
        '  End Try
    End If

    ' Receive Response
    '  Try
    Response = request.GetResponse()
    SR = New StreamReader(Response.GetResponseStream())
    ResponseData = SR.ReadToEnd()
    '  Catch Wex As System.Net.WebException
    '    SR = New StreamReader(Wex.Response.GetResponseStream())
    '     ResponseData = SR.ReadToEnd()
    '     Throw New Exception(ResponseData)
    '  Finally
    '     SR.Close()
    '  End Try

    Return ResponseData
End Function

