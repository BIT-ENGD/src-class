Private fileSystemWatcher As FileSystemWatcher
Private fileSystemEventHandler As New FileSystemEventHandler(AddressOf UpdateSomething)
Private isStopping As Boolean

Private Sub NewThread()
    fileSystemWatcher = New FileSystemWatcher("C:\Temp")
    fileSystemWatcher.Filter = "*.xml"
    fileSystemWatcher.IncludeSubdirectories = False
    fileSystemWatcher.NotifyFilter = NotifyFilters.FileName
    AddHandler fileSystemWatcher.Created, fileSystemEventHandler
    fileSystemWatcher.EnableRaisingEvents = True
End Sub

Private Sub UpdateSomething(ByVal source As Object, ByVal e As FileSystemEventArgs)
    Thread.CurrentThread.Name = "UpdateSomething"
    Console.WriteLine(e.FullPath)
End Sub

Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
    fileSystemWatcher.EnableRaisingEvents = False
    RemoveHandler fileSystemWatcher.Created, fileSystemEventHandler
    fileSystemWatcher.Dispose()
    fileSystemWatcher = Nothing
End Sub

Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click
    Dim thread As New Thread(AddressOf NewThread)
    thread.Name = "NewThread"
    thread.Start()
End Sub

