For i As Integer = 0 To numberOfProxies - 1

            Try
                'create request to a proxyJudge php page using proxy
                Dim request As HttpWebRequest = HttpWebRequest.Create("http://www.pr0.net/deny/azenv.php")
                request.Proxy = New Net.WebProxy(proxies(i)) 'select the current proxie from the proxies array
                request.Timeout = 10000 'set timeout 

                Dim response As HttpWebResponse = request.GetResponse()

                Dim sr As StreamReader = New StreamReader(response.GetResponseStream())
                Dim pageSourceCode As String = sr.ReadToEnd()
                'check the downloaded source for certain phrases, each identifies a type of proxy
                'HTTP_X_FORWARDED_FOR identifies a transparent proxy
                If pageSourceCode.Contains("HTTP_X_FORWARDED_FOR") Then
                    'delegate method for cross thread safe
                    UpdateListbox(ListBox3, proxies(i))
                ElseIf pageSourceCode.Contains("HTTP_VIA") Then
                    UpdateListbox(ListBox2, proxies(i))
                Else
                    UpdateListbox(ListBox1, proxies(i))
                End If

            Catch ex As Exception
                'MessageBox.Show(ex.ToString) used in testing
                UpdateListbox(ListBox4, proxies(i))
            End Try
            completedProxyCheck += 1
            lblTotalProxiesChecked.CustomInvoke(Sub(l) l.Text = completedProxyCheck)

        Next

Using response As HttpWebResponse = request.GetResponse()
Using sr As StreamReader = New StreamReader(response.GetResponseStream())
    Dim pageSourceCode As String = sr.ReadToEnd()
                    'check the downloaded source for certain phrases, each identifies a type of proxy
                    'HTTP_X_FORWARDED_FOR identifies a transparent proxy
                    If pageSourceCode.Contains("HTTP_X_FORWARDED_FOR") Then
                        'delegate method for cross thread safe
                        UpdateListbox(ListBox3, proxies(i))
                    ElseIf pageSourceCode.Contains("HTTP_VIA") Then
                        UpdateListbox(ListBox2, proxies(i))
                    Else
                        UpdateListbox(ListBox1, proxies(i))
                    End If
End Using
End Using

