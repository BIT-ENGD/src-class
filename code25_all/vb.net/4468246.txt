Private dgv As DataGridView 
Private dataSet As DataSet 
Private bindingSource As New BindingSource

Dim ht As New Hashtable()

Public Sub new( ByRef dgv As DataGridView, ByVal dataSet As dataset )

    Me.dgv = dgv 
    Me.dataSet = dataSet 

    For Each col As DataGridViewColumn In dgv.Columns 
        ht.Add( col.headertext, col ) 
    Next

End Sub

Public Sub quickFilter( ByVal searchterm As string,  ByVal tablename As String, optional ByVal colname As string = Nothing )

    dgv.DataSource = dataSet 
    dgv.DataMember = tablename 

    bindingSource.DataSource = CType( dgv.DataSource, DataSet ).Tables.Item( tablename ) 

    bindingSource.Filter = determineColumnsFilter( searchterm, colname ) 

    dgv.DataSource = bindingSource.DataSource 

    restoreCols() 

End Sub

Private Sub restoreCols()

    For Each col As DataGridViewColumn In dgv.Columns 

        Dim colcopy As DataGridViewColumn = ht( col.headertext )

        col.Width = colcopy.Width 
        col.Visible = colcopy.Visible 
        col.DisplayIndex = colcopy.DisplayIndex 

    Next

End Sub

