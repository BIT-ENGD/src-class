Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    'Get the data to populate the controls
    Dim oMySqlData As New MySqlDataProvider
        PlaceHolder1.Controls.Add(CreateExistingNotesHTML(oMySqlData.GetParentNotes("104628"), oMySqlData.GetChildNotes("104628")))
End Sub

Public Sub OnCommentClick(ByVal sender As Object, ByVal e As EventArgs)
    'The event handler for the link buttons
    Label1.Text = "You clicked " & DirectCast(sender, LinkButton).ID
End Sub

Public Function CreateExistingNotesHTML(ByVal dtParent As DataTable, ByVal dtChild As DataTable) As HtmlGenericControl
    'The routine that creates the dynamic controls
    Dim divContainer As New HtmlGenericControl("div")
    For Each drParent As DataRow In dtParent.Rows()
        divContainer.Controls.Add(WriteNote(drParent.Item("NoteId").ToString(), drParent.Item("UserName").ToString(), drParent.Item("ItemNote").ToString, CDate(drParent.Item("InsertDate")), "note"))
    Next

    Return divContainer

End Function

Private Function WriteNote(ByVal NoteId As String, ByVal UserName As String, ByVal ItemNote As String, ByVal InsertDate As DateTime, ByVal DivClass As String) As HtmlGenericControl
    Dim div As New HtmlGenericControl("div")
    div.ID = "d" & NoteId
    div.Attributes.Add("class", DivClass)
div.Controls.Add(New LiteralControl(" Â· "))

   'Add the dynamic link buttons
    Dim lnkComment As New LinkButton
    lnkComment.ID = "l" & NoteId
    lnkComment.Text = "Comment"
    lnkComment.Style("Text-decoration") = "none"
    AddHandler lnkComment.Click, AddressOf oNotes.OnCommentClick
    div.Controls.Add(lnkComment)
 Return div
End Function

