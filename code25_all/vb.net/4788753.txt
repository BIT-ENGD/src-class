Public Sub ReadEvent()
    Dim iCount As Int16
    Dim PastFourHours As Date = Date.Now.AddHours(-4)
    Dim sQuery As String = "Select * from Win32_NTLogEvent Where Logfile = 'MyLogFile' AND TimeGenerated > '" & PastFourHours.ToString() & "'"

    Dim myConnectionOptions As New System.Management.ConnectionOptions
    Dim myManagementScope As System.Management.ManagementScope
    Dim myObjectSearcher As System.Management.ManagementObjectSearcher
    Dim colLoggedEvents As System.Management.ManagementObjectCollection
    Dim objEvent As System.Management.ManagementObject

    With myConnectionOptions
        .Impersonation = System.Management.ImpersonationLevel.Impersonate
        .Authentication = System.Management.AuthenticationLevel.Packet
    End With

    myManagementScope = New System.Management.ManagementScope("\\.\root\cimv2", myConnectionOptions)
    myManagementScope.Connect()                         'connect to WMI namespace

    If (Not myManagementScope.IsConnected) Then
        Call PrintLogToAFile("Could not connect to WMI namespace")
    End If

    myObjectSearcher = New System.Management.ManagementObjectSearcher(myManagementScope.Path.ToString, sQuery.ToString())
    colLoggedEvents = myObjectSearcher.Get()               'execute query

    For Each objEvent In colLoggedEvents
        Call PrintLogToAFile("Category: " + objEvent("Category").ToString())                           
        Call PrintLogToAFile("Message: " + objEvent("Message").ToString())
        Call PrintLogToAFile("Type: " + objEvent("Type").ToString())                                   

        iCount = iCount + 1
    Next

    Call PrintLogToAFile("Number of records: " + iCount.ToString())
End Sub

//Event Log structure:
uint16 Category;
string CategoryString;
string ComputerName;
uint8 Data[];
uint16 EventCode;
uint32 EventIdentifier;
uint8 EventType;
string InsertionStrings[];
string Logfile;
string Message;
uint32 RecordNumber;
string SourceName;
datetime TimeGenerated;
datetime TimeWritten;
string Type;
string User;

