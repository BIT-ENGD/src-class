Class MainWindow

Private MainDispatcher As System.Windows.Threading.Dispatcher = System.Windows.Threading.Dispatcher.CurrentDispatcher

Private Sub MainWindow_Loaded(ByVal sender As Object, ByVal e As System.Windows.RoutedEventArgs) Handles Me.Loaded
    StartProcess("cmd.exe")
End Sub

Private Sub InputTB_KeyUp(ByVal sender As Object, ByVal e As System.Windows.Input.KeyEventArgs) Handles InputTB.KeyUp
    If e.Key = System.Windows.Input.Key.Enter Then
        InputStream.WriteLine(InputTB.Text)
        InputTB.Text = ""
    End If
End Sub

Private InputStream As IO.StreamWriter
Private OutputStream As IO.StreamReader
Public ProcessToMonitor As New Process
Private Sub StartProcess(ByVal FileName As String)

    ProcessToMonitor = New Process
    ProcessToMonitor.StartInfo.FileName = FileName
    ProcessToMonitor.StartInfo.UseShellExecute = False
    ProcessToMonitor.StartInfo.RedirectStandardError = True
    ProcessToMonitor.StartInfo.RedirectStandardOutput = True
    ProcessToMonitor.StartInfo.RedirectStandardInput = True
    ProcessToMonitor.StartInfo.ErrorDialog = False
    ProcessToMonitor.StartInfo.CreateNoWindow = True

    ProcessToMonitor.Start()

    InputStream = ProcessToMonitor.StandardInput
    OutputStream = ProcessToMonitor.StandardOutput

    ConstantReadThread.Priority = System.Threading.ThreadPriority.Lowest
    ConstantReadThread.Start()
End Sub

Private Sub OutputReceived(ByVal sender As Object, ByVal e As System.Diagnostics.DataReceivedEventArgs)
    MainDispatcher.Invoke(New WriteOutputDelegate(AddressOf WriteOutput), e.Data)
End Sub

Private ConstantReadThread As New System.Threading.Thread(AddressOf ConstantRead)
Private Sub ConstantRead()
    Do
        MainDispatcher.Invoke(New WriteOutputDelegate(AddressOf WriteOutput), OutputStream.ReadLine())
    Loop
End Sub

Private Delegate Sub WriteOutputDelegate(ByVal Text As String)
Private Sub WriteOutput(ByVal Text As String)
    OutputTB.Text &= Text & vbNewLine
    OutputTB.ScrollToEnd()
End Sub

