    Public Sub ExportADUsers()

            Dim i As Integer

            Dim strfilter, strAttributes, strScope
            strfilter = "(&(objectCategory=Person)(objectClass=User))"

            strAttributes = "givenName, sn, displayName, mail," & _
            "initials, description, company, title, department," & _
            "location, telephoneNumber, mobile," & _
            "physicalDeliveryOfficeName, streetAddress," & _
            "l, st, postalCode, c, info"

            strScope = "subtree"

            Dim cn, cmd, rs
            cn = CreateObject("ADODB.Connection")
            cmd = CreateObject("ADODB.Command")

            cn.open("Provider=ADsDSOObject;")
            cmd.ActiveConnection = cn
            cmd.commandtext = "LDAP://OU=MyOU,OU=Groups,DC=myDomain,DC=local>;" & strfilter & ";" & strAttributes & ";" & strScope
            rs = cmd.EXECUTE

            Dim objExcel, objWB, objSheet

            objExcel = CreateObject("Excel.Application")
            objWB = objExcel.Workbooks.Add
            objSheet = objWB.Worksheets(1)

            For i = 0 To rs.Fields.Count - 1
                objSheet.Cells(1, i + 1).Value = rs.Fields(i).Name
                objSheet.Cells(1, i + 1).Font.Bold = True
            Next

            objSheet.Range("A2").CopyFromRecordset(rs)
            objSheet.Cells.EntireColumn.AutoFit()
            objSheet.Cells.EntireRow.AutoFit()
            objSheet.SaveAs("C:\Sheet.xlsx")

            'Clean up
            rs.Close()
            cn.Close()
            objSheet = Nothing
            objExcel.Quit()
            objExcel = Nothing

End Sub

