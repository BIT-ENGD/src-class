
Public Function CheckForNewPost(ByVal arg As String) As Boolean

        Dim x As Integer = 0
        Using dc As New WhatEverDataContext()
            Dim newcomment = From mytable In dc.PostTable _
                           Where mytable.PostingUser.ToLower() = User.Identity.Name.ToLower() And mytable.PageOwner.ToLower() = arg.ToLower() And mytable.PostedDate.AddHours(5) >= DateTime.Now _
                           Select mytable
            For Each comment In newcomment
                x = x + 1
            Next
            If x > 0 Then
         'user has posted a comment recently
                Return True
            Else
                Return False
            End If
        End Using

    End Function


  Protected Sub Repeater1_ItemInserted(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.ListViewInsertedEventArgs) Handles Repeater1.ItemInserted
        'send our mail
        Dim PageOwner As String = Request.QueryString.Get("PageOwnerName")
        If CheckForNewPost(PageOwner) = False Then
            SendEMail(PageOwner)
        End If

    End Sub

