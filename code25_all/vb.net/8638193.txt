Private _dispatcher As Dispatcher
Delegate Sub SetLabelText(caption As String)
Private _setLabelText As SetLabelText

Public Sub New()
    _setLabelText = New SetLabelText(AddressOf SetConnectionStatus)
    _dispatcher = Dispatcher.CurrentDispatcher
    ',,,
End Sub

Public Sub Connect
   Try
         _dispatcher.BeginInvoke(DispatcherPriority.Normal, _setLabelText, "test")
        ConnectionStatus = "Connecting to server..."
        _client = WCFClient.GetClient
        Response = _client.GetInfo(Request)
        ConnectionStatus = "Connected to server"
    Catch ex As System.TimeoutException
        ConnectionStatus="Timeout"
    Catch ex As System.ServiceModel.EndpointNotFoundException
        ConnectionStatus="Server down"
    End Try
End Sub

 Private Sub SetConnectionStatus(statusMessage As String)
    ConnectionStatus = statusMessage
 End Sub

Private _connectionStatus As String
Public Property ConnectionStatus() As String
    Get
        Return _connectionStatus
    End Get
    Set(ByVal value As String)
        _connectionStatus = value
        OnPropertyChanged("ConnectionStatus")
    End Set
End Property

Private Sub OnPropertyChanged(propertyName As String)
    RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs(propertyName))
End Sub

Public Event PropertyChanged(sender As Object, e As PropertyChangedEventArgs) Implements INotifyPropertyChanged.PropertyChanged

