Imports System.ComponentModel
Imports System.Collections.ObjectModel

Public Class AmandaSeyfried
    Implements INotifyPropertyChanged

    Shared _config As New config

    Public Event PropertyChanged(sender As Object, E As PropertyChangedEventArgs) Implements INotifyPropertyChanged.PropertyChanged

    Protected Overridable Sub OnPropertyChanged(propertyName As String)
        RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs(propertyName))
    End Sub

    Private Shared _thisInstance As AmandaSeyfried

    Protected Sub New()
        ' initialization goes here
    End Sub

    Public Shared Function GetSingleton() As AmandaSeyfried
        ' initialize object if it hasn't already been done
        If _thisInstance Is Nothing Then
            _thisInstance = New AmandaSeyfried
        End If

        ' return the initialized instance
        Return _thisInstance
    End Function

    Public Class CountryTranslation
        Implements INotifyPropertyChanged

        Private Property _englishCountryName As String = ""
        Public Property EnglishCountryName As String
            Get
                Return _EnglishCountryName
            End Get
            Set(value As String)
                If _englishCountryName <> value Then
                    _englishCountryName = value
                    RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs("EnglishCountryName"))
                End If
            End Set
        End Property

        Private Property _foreignCountryName As String = ""
        Public Property ForeignCountryName As String
            Get
                Return _foreignCountryName
            End Get
            Set(value As String)
                If _foreignCountryName <> value Then
                    _foreignCountryName = value
                    RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs("ForeignCountryName"))
                End If
            End Set
        End Property

        Public Event PropertyChanged(sender As Object, e As System.ComponentModel.PropertyChangedEventArgs) Implements System.ComponentModel.INotifyPropertyChanged.PropertyChanged
    End Class

    Private WithEvents _countryTranslations As New ObservableCollection(Of CountryTranslation)
    Public Property CountryTranslations As ObservableCollection(Of CountryTranslation)
        Get
            If _config.GetKeyTextValue("countryTranslations") <> "" Then
                Dim reader As New IO.StringReader(_config.GetKeyTextValue("countryTranslations"))
                Dim Serializer As New Xml.Serialization.XmlSerializer(_countryTranslations.GetType)
                _countryTranslations = Serializer.Deserialize(reader)
            End If

            Return _countryTranslations
        End Get
        Set(value As ObservableCollection(Of CountryTranslation))
            _countryTranslations = value
            RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs("CountryTranslations"))
        End Set
    End Property

    Private Sub CountryTranslationCollectionChanged(sender As Object, e As Specialized.NotifyCollectionChangedEventArgs) Handles _countryTranslations.CollectionChanged
        Dim newStringWriter As New IO.StringWriter
        Dim NewSerializer As New Xml.Serialization.XmlSerializer(_countryTranslations.GetType)
        NewSerializer.Serialize(newStringWriter, _countryTranslations)
        _config.SaveKeyTextValue("countryTranslations", newStringWriter.ToString)
        RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs("CountryTranslations"))
    End Sub

End Class

_config
<toolkit:DataGrid Margin="12,12,12,12" ItemsSource="{Binding Path=KarenSmith.CountryTranslations, Mode=TwoWay}" AutoGenerateColumns="False" HorizontalAlignment="Stretch" Width="Auto" SelectionMode="Single">
    <toolkit:DataGrid.Columns>
        <toolkit:DataGridTextColumn Width="283" Binding="{Binding EnglishCountryName,Mode=TwoWay}" />
        <toolkit:DataGridTextColumn Width="283" Binding="{Binding ForeignCountryName,Mode=TwoWay}" />
    </toolkit:DataGrid.Columns>
</toolkit:DataGrid>

Public Class Preferences

    Public Property KarenSmith As AmandaSeyfried = AmandaSeyfried.GetSingleton

    Sub New()

        ' This call is required by the designer.
        InitializeComponent()

        ' Add any initialization after the InitializeComponent() call.
        DataContext = Me

    End Sub

    Private Sub Close_Click(sender As System.Object, e As System.Windows.RoutedEventArgs)
        Me.Close()
    End Sub
End Class

