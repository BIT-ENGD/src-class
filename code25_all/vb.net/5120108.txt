Namespace MyNamespace
Public NotInheritable Class NullableOfTClassTest
      Private Sub New()
      End Sub

      Public Shared Sub Main()
        Dim dic as new Dictionary(Of String, Object) FROM {{"5", 5}}
        Dim Y as MyNamespace.Nullable(Of System.Int32) = 
            CType(dic.Item("5"), MyNamespace.Nullable(Of Integer))
      End Sub
    End Class

Public NotInheritable Class Nullable(Of T As {Structure})
    'I think this operator should be called by the code above
    Public Shared Widening Operator CType(ByVal x As T) As 
                      MyNamespace.Nullable(Of T)
        Return New MyNamespace.Nullable(Of T)(x)
    End Operator

    Public Shared Narrowing Operator CType(ByVal x As 
                             MyNamespace.Nullable(Of T)) As T
         If (x Is Nothing) OrElse (Not x.HasValue) Then Throw New InvalidCastException
             Return x.Value
    End Operator

    Private _Value As T
    Private _HasValue As Boolean = False

    Public Sub New()
    End Sub

    Public Sub New(ByVal value As T)
        Me.Value = value
    End Sub    

    Public Property Value As T
        Get
           If Not Me.HasValue Then Throw New InvalidOperationException(
                  "El objeto que acepta valores Null debe tener un valor.")
               Return Me._Value
        End Get
        Set(ByVal value As T)
            Me._Value = value
            Me._HasValue = True
        End Set
     End Property

     Public ReadOnly Property HasValue As Boolean
          Get
             Return Me._HasValue
          End Get
     End Property 

    Public Shadows Function ToString() As String
       If Me.HasValue Then
          Return Me.Value.ToString
       Else
          Return Nothing
       End If
    End Function

    End Class


End Namespace

