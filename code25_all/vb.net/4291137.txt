Private Sub loadLeads()
        Using db As New CRMDataDataContext(SQLConnectionString)
            Dim count = 0
            Dim l As IEnumerable(Of Company)
            If CanViewAllLeads(User.Identity.Name, db) = True Then
                Dim q = From leads In db.Companies _
                        Join s In db.CompanySources On s.CompanySourceID Equals leads.CompanySourceID _
                        Where leads.Active = True And leads.CompanyStatusID = 1 _
                        Select leads.CompanyID, _
                                leads.BusinessName, _
                                leads.Website, _
                                leads.Phone, _
                                leads.Fax, _
                                leads.LastContacted, _
                                leads.FollowUp, _
                                leads.CreatedBy, _
                                leads.Created, _
                                leads.UpdatedBy, _
                                leads.Updated, _
                                Source = s.Source
                count = q.Count
                l = q
            Else
                Dim q = From leads In db.Companies _
                    Join s In db.CompanySources On s.CompanySourceID Equals leads.CompanySourceID _
                    Join xref In db.UserCompaniesXrefs On leads.CompanyID Equals xref.CompanyID _
                    Where leads.Active = True And leads.CompanyStatusID = 1 And xref.UserID = NCGuid(User.Identity.Name) _
                    Select leads.CompanyID, _
                            leads.BusinessName, _
                            leads.Website, _
                            leads.Phone, _
                            leads.Fax, _
                            leads.LastContacted, _
                            leads.FollowUp, _
                            leads.CreatedBy, _
                            leads.Created, _
                            leads.UpdatedBy, _
                            leads.Updated, _
                            Source = s.Source
                count = q.Count
                l = q
            End If
            If count > 0 Then
                dgLeads.DataSource = l
                dgLeads.DataBind()
            Else
                pnlLeads.Visible = False
                pnlNoLeads.Visible = True
            End If
        End Using
    End Sub

1[VB$AnonymousType_1
1[System.DateTime],System.Nullable
1[System.Guid],System.Nullable
1[System.Guid],System.Nullable
