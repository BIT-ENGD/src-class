<%@ Page Title="Nested ListView" Language="VB" MasterPageFile="~/MasterPages/SimpleMasterPage.master"
    CodeFile="NLV2PA_A.aspx.vb" Inherits="Demos_NLV2PA_A" %>


<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="Server">
</asp:Content>

<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder1" runat="Server">

    <asp:ListView ID="ListView1" runat="server" ItemPlaceholderID="PlaceHolder1" DataKeyNames="Id"
        DataSourceID="SqlDataSource1">

        <LayoutTemplate>
            <asp:PlaceHolder runat="server" ID="PlaceHolder1"></asp:PlaceHolder>
        </LayoutTemplate>
        <EmptyDataTemplate>
            <span>ListView 1 No data was returned. </span>
        </EmptyDataTemplate>
        <ItemTemplate>
            <span style="">Id:
                <asp:Label ID="IdLabel" runat="server" Text='<%# Eval("Id") %>' />
                <br />
                Name:
                <asp:Label ID="NameLabel" runat="server" Text='<%# Eval("Name") %>' />
                <br />
                <br />
            </span>
            <asp:ListView ID="ListView2" runat="server" ItemPlaceholderID="PlaceHolder2" DataSourceID="SqlDataSource2">
                <LayoutTemplate>
                    <asp:PlaceHolder runat="server" ID="PlaceHolder2"></asp:PlaceHolder>
                </LayoutTemplate>
                <EmptyDataTemplate>
                    <span>ListView2 No data was returned. </span>
                </EmptyDataTemplate>
                <ItemTemplate>
                    <span style="">Title:
                        <asp:Label ID="TitleLabel" runat="server" Text='<%# Eval("Title") %>' />
                        <br />
                        <h1>
                            <%# Eval("Title") %></h1>
                        <br />
                        Summary:
                        <asp:Label ID="SummaryLabel" runat="server" Text='<%# Eval("Summary") %>' />
                        <br />
                        PhotoAlbumID:
                        <asp:Label ID="PhotoAlbumIdLabel" runat="server" Text='<%# Eval("PhotoAlbumId") %>' />
                        <br />
                        <br />
                    </span>
                </ItemTemplate>
            </asp:ListView>
        </ItemTemplate>
    </asp:ListView>
    <asp:SqlDataSource ID="SqlDataSource1" runat="server" ConnectionString="<%$ ConnectionStrings:RenaissanceConnectionString1 %>"
        SelectCommand="SELECT [Id], [Name] FROM [PhotoAlbum] ORDER BY [Id]"></asp:SqlDataSource>
    <asp:SqlDataSource ID="SqlDataSource2" runat="server" ConnectionString="<%$ ConnectionStrings:RenaissanceConnectionString1 %>"
        SelectCommand="SELECT [Title], [Summary], [PhotoAlbumId] FROM [Apartments] WHERE ([PhotoAlbumId] = @PAId)">
        <SelectParameters>
            <asp:ControlParameter ControlID="ListView1" DefaultValue="0" Name="PAId" PropertyName="SelectedValue"
                Type="Int32" />
        </SelectParameters>
    </asp:SqlDataSource>
</asp:Content>

Protected Sub ListView1_ItemDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.ListViewItemEventArgs) Handles ListView1.ItemDataBound

    If e.Item.ItemType = ListViewItemType.DataItem Then
        SqlDataSource2.SelectParameters("PAId").DefaultValue = DirectCast(e.Item.FindControl("IdLabel"), Label).Text
    End If
End Sub

Id: 8 
Name: First set of Photos 

ListView2 No data was returned.

Id: 9 
Name: Second set of Photos 

ListView2 No data was returned.

etc.

