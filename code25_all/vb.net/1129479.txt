'** web.config'
<appSettings>
    <add key="ConnectionString" value="Persist Security Info=True;Initial Catalog=[database];Data Source=[server];User ID={0};Password={1};"/>
</appSettings>

<connectionStrings>
    <add name="ConnectionString" connectionString="Data Source=[server];Initial Catalog=[database];Persist Security Info=True;User ID={0};Password={1};" providerName="System.Data.SqlClient"/>
</connectionStrings>

'** BasePage.vb'
Public ReadOnly Property DB() As Database
    Get
        If m_DB Is Nothing Then
            'open database connection
            m_DB = New Database
            m_DB.Open(ConnectionString) ' ********** Line 41'
        End If
        Return m_DB
    End Get
End Property

Public ReadOnly Property ErrHandler() As ErrorHandler
    Get
        If m_ErrHandler Is Nothing Then m_ErrHandler = New ErrorHandler(DB)
        Return m_ErrHandler '**********Line 49'
    End Get
End Property

Private Sub Page_PreInit(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.PreInit
    'if using "appSettings" section for connectionstring'
    ConnectionString = DBConnectionString.GetConnectionString(ConfigurationManager.AppSettings("ConnectionString"), ConfigurationManager.AppSettings("ConnectionStringUsername"), ConfigurationManager.AppSettings("ConnectionStringPassword"))
    'if using "connectionStrings" section for getting connectionstring'
    'ConnectionString = DBConnectionString.GetConnectionString(ConnectionStrings.Item("ConnectionString").ConnectionString, AppSettings("ConnectionStringUsername"), AppSettings("ConnectionStringPassword"))'
End Sub

'** ConnectionStrings.vb'
Public Shared Function GetConnectionString(ByVal cs, ByVal Username, ByVal Password) As String
    Dim ConnString As DBConnectionString = New DBConnectionString(cs, Username, Password)
    Return ConnString.ConnectionString
End Function

'** Database.vb'
    Public Sub Open(ByVal connectionstring As String)
        RefCount = RefCount + 1

        If con Is Nothing Then
            con = New SqlConnection(connectionstring)
        End If
        If Not IsOpen() Then
            con.Open() ' ********** Line 47'
        End If
    End Sub

'** SitePage.vb'
Private Sub Page_Error(ByVal sender As Object, ByVal e As System.EventArgs) Handles MyBase.Error
    ErrHandler.LogError(Server.GetLastError) '********** Line 116'
End Sub

