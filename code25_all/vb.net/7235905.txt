<!-- Targets -->
<asp:TabPanel ID="tab8" runat="server" HeaderText="Targets">
<HeaderTemplate>Targets</HeaderTemplate>
    <ContentTemplate>
        <ul class="info">
        <asp:ListView ID="lvTargets" runat="server" DataSourceID="dsTargets" DataKeyNames="TargetID">   
        <ItemTemplate>
            <li><%# Eval("TargetName")%>
            <asp:ImageButton ID="DeleteTargetButton" runat="server" Style="float:right;" AlternateText="" ImageUrl="../../images/delete.png" CommandName="Delete" OnClientClick="return confirm('Are you sure you want to delete this target audience?')" />
            </li>
        </ItemTemplate>
        </asp:ListView>
        </ul>
    </ContentTemplate>
</asp:TabPanel>
</asp:TabContainer>

 <!-- Add a Target -->
      <li>
        <asp:LinkButton ID="TargetButton" runat="server">Target</asp:LinkButton>
        <asp:Panel ID="TargetPanel" runat="server" CssClass="modalPopup" Style="display:none">
            <asp:CheckBoxList ID="cbxAddTarget" runat="server" DataSourceID="dsNewTargets" DataTextField="TargetName" DataValueField="TargetID"></asp:CheckBoxList>
            <asp:Button ID="SubmitTargets" runat="server" Text="Submit" />
            <asp:Button ID="CancelSubmitTargets" runat="server" Text="Cancel" />
        </asp:Panel>
        <asp:ModalPopupExtender ID="TargetModal" runat="server" BackgroundCssClass="modalBackground" CancelControlID="CancelSubmitTargets" DropShadow="True" DynamicServicePath="" Enabled="True" PopupControlID="TargetPanel" TargetControlID="TargetButton"></asp:ModalPopupExtender>
    </li>

    Protected Sub SubmitTargets_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles SubmitTargets.Click
    DocumentModal.Hide()
    dsNewTargets.DataBind()
    For Each Target As ListItem In cbxAddTarget.Items
        If Target.Selected Then
            Dim sqlAddTarget As String = Nothing
            'SQL INSERT: TargetLink Table
            sqlAddTarget = "INSERT INTO TargetLink (ProductID, TargetID) VALUES (" & ProductID.Value & ", " & Target.Value & ")"
            sqlAddTarget.Replace("'", "''")
            Dim SqlConnection As New SqlConnection("Server=off-db1;uid=productsDB_admin;pwd=******;database=Products")
            SqlConnection.Open()
            Dim sqlCommand As New SqlCommand(sqlAddTarget, SqlConnection)
            sqlCommand.ExecuteNonQuery()
            SqlConnection.Close()
        End If
    Next
    Response.Redirect(Request.RawUrl)
End Sub   

    Protected Sub dsTargets_Deleted(ByVal sender As Object, ByVal e As SqlDataSourceStatusEventArgs)
    If e.Exception Is Nothing Then
        'rebind the new targets list to show updates
        dsNewTargets.DataBind()
    End If
End Sub

