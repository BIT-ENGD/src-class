select
    p.Code,
    s.pkServiceId, 
    ps.fkPatientId, 
    ps.fkStatusId, 
    s.Code AS ServiceCode, 
    s.Description AS ServiceDescription, 
    st.Code AS StatusCode, 
    st.Description as StatusDescription, 
    ps.TsStart
from 
    Service s
inner join
    Patient p on 1 = 1
left outer join
      (select
            max(TsStart) AS TsStart, 
            fkPatientId, 
            fkServiceId
        from
            PatientStatus AS ps
        group by
            fkServiceId, fkPatientId
     ) AS psLast on 
        psLast.fkServiceId = s.pkServiceId and 
        psLast.fkPatientId = p.pkPatientId
left outer join
    PatientStatus AS ps ON 
        psLast.TsStart = ps.TsStart and 
        psLast.fkPatientId = ps.fkPatientId and 
        psLast.fkServiceId = ps.fkServiceId 
left outer join
    Status st on
        st.pkStatusId = ps.fkStatusId

