declare @DataXml xml
set @DataXml='<root v="test data"/>' ;
--or: set @DataXml='<root v-base64="AgB0AGUAcwB0ACAAHwQSBCQEFw...."/>' ;
SELECT ISNULL( 
    @DataXml.value('root[1]/@v', 'nvarchar(max)'), 
    CAST( @DataXml.value('xs:base64Binary(root[1]/@v-base64)', 
        'varbinary(max)') AS nvarchar(max) ) )

CREATE FUNCTION dbo. udf_DataXmlValue 
(
    @DataXml xml,
    @NodeName nvarchar(max),
    @AttributeName nvarchar(max)
)
RETURNS nvarchar(max)
AS
BEGIN
    DECLARE @result nvarchar(max) ;

    DECLARE @xquery nvarchar(max) ;
    SET @xquery = @NodeName + '[1]/' + @AttributeName;
    SET @result = @DataXml.value('sql:variable("@xquery")', 'nvarchar(max)') ;

    IF @result IS NULL
    BEGIN
        ... do base64 stuff ...
    END

    RETURN @result ;
END
GO

SELECT dbo.udf_DataXmlValue( @xml, 'root', 'v' )

