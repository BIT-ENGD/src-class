ALTER FUNCTION [dbo].[Objects] (@id uniqueidentifier)
RETURNS @objects TABLE
( 
    ObjectId uniqueidentifier NOT NULL,
    InternalId uniqueidentifier NOT NULL
)
AS
BEGIN 
    declare @city varchar(50)
    declare @country int

    select  @city = city,
            @country = country
    from Europe
    where internalId = @id

    insert @objects
    select @id, internalId from
    (
        select distinct top 6 [level], internalId from
        (
            select top 6 1 as [level], internalId
            from Europe N4
            where N4.city = @city
            and N4.internalId != @id            

            union select top 6 2 as [level], internalId
            from Europe N5
            where N5.countryId = @country
            and N5.internalId != @id            

        ) as selection_1
        order by [level]
    ) as selection_2
    return
END

