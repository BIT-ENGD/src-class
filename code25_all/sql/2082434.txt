                SELECT 
                    t.id, 
                    t.name, 
                    t.type, 
                    p.value,
                    (SELECT 
                        value 
                    FROM 
                        prices 
                    WHERE 
                        prices.id = p.id AND 
                        prices.country='US' AND 
                        prices.timestamp < p.timestamp
                    ORDER BY 
                        prices.timestamp DESC 
                    LIMIT 1) AS last_value
                FROM
                    prices AS p
                INNER JOIN
                    titles AS t
                ON
                    t.row_id = p.id
                WHERE
                    p.country = 'US' AND
                    (SELECT 
                        value 
                    FROM 
                        prices 
                    WHERE 
                        prices.id = p.id AND 
                        prices.country='US' AND 
                        prices.timestamp < p.timestamp
                    ORDER BY 
                        prices.timestamp DESC 
                    LIMIT 1) IS NOT NULL
                GROUP BY
                    t.id
                ORDER BY
                    p.timestamp DESC,
                    last_value DESC
                LIMIT 0, 25"

