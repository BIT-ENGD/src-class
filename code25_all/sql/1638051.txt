CREATE TRIGGER dbo.trg_Priority
    ON  dbo.Stories
    AFTER INSERT,UPDATE,DELETE
AS
BEGIN
    SET NOCOUNT ON;

-- Insert statements for trigger here
DECLARE @StoryId INT
DECLARE @OldLocation INT
DECLARE @NewLocation INT

SELECT @NewLocation = Priority, @StoryId = StoryId FROM INSERTED
SELECT @OldLocation = Priority FROM DELETED

IF @NewLocation = @OldLocation
    RETURN;

IF @NewLocation IS NULL
BEGIN
    UPDATE Stories SET
        Priority = Priority - 1
    WHERE Priority > @OldLocation
END

IF @NewLocation > @OldLocation
BEGIN
    UPDATE Stories SET
        Priority = Priority + 1
    WHERE Priority >= @NewLocation
    AND StoryId <> @StoryId
END

IF @NewLocation < @OldLocation
BEGIN
    UPDATE Stories SET
        Priority = Priority + 1
    WHERE Priority >= @NewLocation
    AND Priority < @OldLocation
    AND StoryId <> @StoryId
END
END
GO

UPDATE
