CREATE PROCEDURE dbo.GetMessages (
  @username nchar(12),
  @isCount bit,
  @message_count int OUTPUT,
  @unread_message_count int OUTPUT
) AS

IF @isCount = 1
BEGIN
  SET @message_count = 
  (
    SELECT        COUNT(*)
    FROM          messages
    WHERE         usernameTo = @username
  )

  SET @unread_message_count =
  (
    SELECT        COUNT(*)
    FROM          messages
    WHERE         usernameTo = @username AND message_read = 1
  )
END
ELSE
BEGIN
  SELECT        *
  FROM          messages
  WHERE         usernameTo = @username
END

