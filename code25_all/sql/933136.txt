create table #tableA 
(
    id int IDENTITY(1,1),
    groupid int,
    flag bit,
    CONSTRAINT [PK_TableA] PRIMARY KEY CLUSTERED 
    (
        [id] ASC
    )
)

insert into #tableA (groupid,flag) values (1,0),(1,0),(1,1),(2,0),(2,1)

select 
    a.groupid ,
    cast(totalCount as float)/count(*) as ratio
from 
    #tableA a 
    join 
    (
        select 
            groupid,
            COUNT(*) totalCount 
        from 
            #tableA 
        where 
            flag=1 
        group by 
            groupid
    ) b on a.groupid=b.groupid 
group by 
    a.groupid,
    b.totalCount

drop table #tableA

