ALTER PROCEDURE [dbo].[RestaurantsFullText]
    @searchText nvarchar(255) 
AS
SELECT 
    b.*, 
    COALESCE(akt2.[Rank],0) / 30 + 
    COALESCE(akt1.[Rank],0) / 30 + 
    COALESCE(akt.[Rank],0) / 30 + 
    COALESCE(bkt.[Rank],0)  as rankCount  
FROM 
    Restaurants b 
left JOIN Cuisines c on b.Id = c.RestaurantId 
left join CuisineType a 
ON c.CuisineId = a.id 

left JOIN 
containstable(Restaurants, Name, @searchText) bkt 
ON b.id = bkt.[Key] 

left JOIN containstable(CuisineType, Name, @searchText) akt 
ON a.id = akt.[Key]

left JOIN containstable(Restaurants, Postcode, @searchText) akt1 
ON b.id = akt1.[Key]

left JOIN containstable(Restaurants, citytown, @searchText) akt2 
ON b.id = akt2.[Key]

where 
    COALESCE(akt2.[Rank],0) / 30 + 
    COALESCE(akt1.[Rank],0) /30 + 
    COALESCE(akt.[Rank],0) / 30 + 
    COALESCE(bkt.[Rank],0)  > 5
ORDER BY 
    COALESCE(akt2.[Rank],0) / 30 + 
    COALESCE(akt1.[Rank],0) / 30 + 
    COALESCE(akt.[Rank],0) / 30 + 
    COALESCE(bkt.[Rank],0)   asc

