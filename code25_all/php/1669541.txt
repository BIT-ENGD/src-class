$active = null;

do {
    $process = curl_multi_exec($curl, $active);
} while ($process === CURLM_CALL_MULTI_PERFORM);

while (($active >= 1) && ($process === CURLM_OK))
{
    if (curl_multi_select($curl, 3) != -1)
    {
        do {
            $process = curl_multi_exec($curl, $active);
        } while ($process === CURLM_CALL_MULTI_PERFORM);
    }
}

while (true)
{
    $active = 1;
    $process = curl_multi_exec($curl, $active);

    if ($process === CURLM_OK)
    {
        while (($active >= 1) && (curl_multi_select($curl, 3) != -1))
        {
            $process = CURLM_CALL_MULTI_PERFORM;

            while ($process === CURLM_CALL_MULTI_PERFORM)
            {
                $process = curl_multi_exec($curl, $active);
            }
        }

        break;
    }

    else if ($process === CURLM_CALL_MULTI_PERFORM)
    {
        continue;
    }

    break;
}

