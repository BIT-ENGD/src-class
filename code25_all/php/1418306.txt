if ($_SERVER['REQUEST_METHOD']=='GET' && $_GET['download']==='1')
{
    $handle = fopen('lastdownload.txt','rw');
    $date = @fread($handle,filesize('lastdownload.txt'));

    if (time() - 30 * 60 > $date)
    {
    fwrite($handle,time());
    header('Content-type: application/zip');
    header('Content-Disposition: attachment; filename="dwnld_'.date('d_m_Y_H_i',filemtime('download.zip')).'.zip"');
    readfile('download.zip');
    }

    exit;
}

