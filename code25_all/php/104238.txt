$matches = preg_split("/<%[\s]*(.*?)[\s]*%>/i",$markup,-1,(PREG_SPLIT_NO_EMPTY  |  PREG_SPLIT_DELIM_CAPTURE));

&amp;% some stuff %&amp;gt;
<% or &amp;lt;% and %> or %&amp;gt;
&amp;lt; to &amp;gt; and < to >
