<asp:FileUpload runat="server" ID="File1" />

var file1 = document.getElementById("<%# File1.ClientID %>");
var desktop = google.gears.factory.create('beta.desktop');

file1.onclick = function()
{
    desktop.openFiles(openFilesCallback,
        {
            singleFile: true,
            filter: ["image/jpeg"]
        }
    );
    return false;
}

function openFilesCallback(files)
{
    if(files.length == 0)
    {
        alert("No files selected");
    }
    else
    {
        // 1MB = 1024 * 1024 bytes
        if(files[0].blob.length > (1024 * 1024)) 
        {
            alert("File '" + files[0].name + "' is too big to upload");
        }
        else
        {
            uploadFile(files[0]);
        }
    }
}

function uploadFile(file)
{
    var up = google.gears.factory.create("beta.httprequest");
    up.open("POST", "upload.ashx");
    up.send(file.blob);
}

public void ProcessRequest (HttpContext ctx)
{
    ctx.Response.ContentType = "text/plain";
    ctx.Response.Write("Hello World");
    ctx.Response.Write(ctx.Request.Files.Count.ToString());
    ctx.Response.Write(ctx.Request.Form.Count.ToString());
}

Files.Count
Form.Count
Component returned failure code: 0x80004001 (NS_ERROR_NOT_IMPLEMENTED)
