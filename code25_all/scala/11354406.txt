// returns Either[String, Int]
db.handle withSession { implicit ss: Session=>
  ss.withTransaction {
    val result = for {
      u  <- either(User.insert(User(model)), ss)
      ur <- either(UserRole.insert( UserRole(u) ), ss)
      m  <- either(Membership.insert(Membership(u)), ss)
    } yield u

// bad: rollback occurs regardless of left/right outcome
result fold( {ss.rollback; Left(_)}, Right(_) )

// good: rollback occurs as expected on left outcome only
result fold( e=>{ss.rollback; Left(e)}, Right(_) )

