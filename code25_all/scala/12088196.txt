import net.liftweb.actor.LiftActor
import net.liftweb.util.Schedule
import net.liftweb.util.Helpers._
import net.liftweb.http.CometActor
import net.liftweb.http.js.JsCmds.SetHtml
import net.liftweb.http.js.jquery.JqJsCmds._

case class FetchGMail(userID: Int, sender: CometActor)
case class NewStuffs(mails: List[Stuff])

object GMailListener extends LiftActor
{
    def getMails(userID: Int) = {
        // Get Mails from GMail
    }

    def messageHandler = {
        case FetchGMail(userID, sender) => 
            println("Get FetchMail request")
            sender ! NewStuffs(getMails(userID))
            Schedule.schedule(this, FetchGMail(userID, sender), 5 minutes)
    }
}

class Inbox extends CometActor with JSImplicit
{
    def render = <div>Empty Inbox</div>

    GMailListener ! FetchGMail(1, this)

    override def lowPriority = {
        case NewStuffs(mails) => 
            println("get new mails")
            partialUpdate(AppendHtml("mails", <div>{mails}</div>))
    }
}

