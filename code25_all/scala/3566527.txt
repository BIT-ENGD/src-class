val conn = connect(url, _.getHeaderField("X-RateLimit-Remaining").toInt > 0, 500)

def connect(url: String, succeeded: URLConnection=>Boolean, waitMillis: Int) = {
  var conn = new URL(url).openConnection
  while (!succeeded(conn)) {
    Thread.sleep(waitMillis)
    conn = new URL(url).openConnection
  }
  conn
}

