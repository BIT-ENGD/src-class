val socket = new Socket(InetAddress.getByName(host), port)
val in = socket.getInputStream;
val out = new PrintStream(socket.getOutputStream)

val reader = new DataInputStream(in)
val baos = new ByteArrayOutputStream
val buffer = new Array[Byte](1024)

out.print(cmd + "\r\n")
out.flush

val firstLine = reader.readLine.split("\\s")

if(firstLine(0) == "OK") {
  def read(written: Int, max: Int, baos: ByteArrayOutputStream): Array[Byte] = {
    if(written >= max) baos.toByteArray
    else {
      val count = reader.read(buffer, 0, buffer.length)
      baos.write(buffer, 0, count)
      read(written + count, max, baos)
    }
  }

  read(0, firstLine(1).toInt, baos)
} else {
  // RAISE something
}

baos.toByteArray()

DataInputStream#readLine
read(...)
readLine(...)
BufferedReader
read
