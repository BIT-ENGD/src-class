  def ensure[T](f: => Boolean)(truth: => T, lie: T) = if (f) truth else lie


  def lines(): Stream[String] = {
    def matchLine(text: String, acc: String): Stream[String] = text match {
      ...
      case NewLine(string) =>
        ensure(contents.hasNext && acc != null)(acc +: matchLine(contents.next, string),
          ensure(contents.hasNext)(matchLine(contents.next, string), acc +: string +: empty))
      ...
    }
    ensure(contents.hasNext)(matchLine(contents.next, null), empty)
  } 

