class A {
    def f = {
        val b: B = C.factory(this).asInstanceOf[B]
    }
    class B
}

object C {
    def factory(a: A): A#B = new a.B
}

C.factory
A#B
B
A
f
factory
error: type mismatch;
found   : A#B
required: A.this.B

