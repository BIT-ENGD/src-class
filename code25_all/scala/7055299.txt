MessageQueue.scala
def extractFirst(p: Any => Boolean): MessageQueueElement = {
changeSize(-1) // assume size decreases by 1

val msg = if (null eq last) null
else {
    ...
  }
}

val msg = if (null eq last) null
eq
null
if (last==null) null
