use strict;
use warnings;
use IO::File;
use XML::Parser;

my $xml = <<EOD;
<?xml version="1.0"?>
<messages>
  <message>
    <from id="t_8ur9k0" type="king">Maximus</from>
    <to>knave</to>
    <subject>My boots</subject>
    <body>I <i>really</i> want my riding boots. Bring them to me, at once!</body>
  </message>
</messages>
EOD

my $parser = new XML::Parser(Style => 'Stream', ErrorContext => 2);
$parser->setHandlers(Start => \&handle_start, 
      End => \&handle_end, 
      Char => \&handle_char,
      Default => \&handle_default);

$parser->parse($xml);

sub handle_start {
  my ($self, $tag, %attrs) = @_;
  my $atts = '';
  if (%attrs) {
    while ( my ($key, $val) = each(%attrs) ) {
      $atts .= " " . $key . '="' . $val . '"';
    }
  }
  print "<" . $tag . $atts . ">";
}

sub handle_end {
  my ($self, $tag) = @_;
  print "</" . $tag . ">";
}

sub handle_char {
  my ($self,$raw) = @_;
  if ( !($raw =~ m/\s/) ) {
    $raw =~ s/.*/FOO/;
  }
  print $raw;
}

sub handle_default {
  my ($self,$str) = @_;
  print $str;
}

