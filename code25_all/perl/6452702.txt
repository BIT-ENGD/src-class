--|proxy|--|mux|--|demux|--|proxy|--
                --
                --
                --
machineA   satellite link    machineB

use IO::Socket;
$| = 1;
$socket = new IO::Socket::INET (
    LocalHost => '172.16.1.218',
    LocalPort => '5000',
    Proto => 'tcp',
    Listen => 5,
    Reuse => 1
);
die "Coudn't open socket" unless $socket;
print "\nTCPServer Waiting for client on port 5000";

while(1)
{
        $client_socket = "";
        $client_socket = $socket->accept();
        $peer_address = $client_socket->peerhost();
        $peer_port = $client_socket->peerport();

        #print "\n I got a connection from ( $peer_address , $peer_port ) ";
        while (1){
                $send_data = <STDIN>;
                $client_socket->send($send_data);
                $client_socket->recv($recieved_data,10);
                print $recieved_data;#."\n";
                #$client_socket->autoflush(); 
        }
}

use IO::Socket;

$socket = new IO::Socket::INET (
    PeerAddr  => '172.16.1.224',
    PeerPort  =>  5000,
    Proto => 'tcp',
)
or die "Couldn't connect to Server\n";

while (1) {
        $socket->recv($recv_data,10);
        print $recv_data."\n";
        $send_data = <STDIN>;
        $socket->send($send_data);
}

