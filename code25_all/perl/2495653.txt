%old_hash
my %old_hash;
$old_hash{"foo"}{"bar"}{"zonk"} = "hello";

&flatten(...)
my %h = &flatten(\%old_hash);
die unless($h{"zonk"} eq "hello");

&flatten(...)
sub flatten {
  my $hashref = shift;
  my %hash;
  my %i = %{$hashref};
  foreach my $ii (keys(%i)) {
    my %j = %{$i{$ii}};
    foreach my $jj (keys(%j)) {
      my %k = %{$j{$jj}};
      foreach my $kk (keys(%k)) {
        my $value = $k{$kk};
        $hash{$kk} = $value;
      }
    }
  }
  return %hash;
}

