#!/usr/bin/perl    
use strict;
use warnings;
use MongoDB;

# Open file
print "--> Read file\n";
open( INPUT, "<userlist.txt" ) or die "Could not open the file: $!\n";
print "--> Read INPUT OK\n";
open( OUTPUT, ">>outfile.txt" ) or die "Could not open the file: $!\n";
print "--> Read OUTPUT OK\n";

# MongoDB parameter
my $mongoHost = localhost;
my $mongoPort = 12345;

my $conn = MongoDB::Connection->new( "host" => "$mongoHost", "port" => $mongoPort );    # Open connection
my $db = $conn->mylist;                                                                 # Connect to database
my $user_stats = $db->user_stats;                                                    # Choose a collection
print "--> Connect to MongoDB\n";

# Read through line
foreach my $line ( <INPUT> ) {
    # Extract content
    chomp( $line );   # Remove newline
    print "$line\n";

    my $statsResult = $user_stats->find( { nickname => '$line' } );
    while ( my $obj = $statsResult->next ) {
        print $obj->{ "nickname" } . ";";
        print $obj->{ "total" } . "\n";
    }
}
close( OUTPUT );
close( INPUT );

print "--> End of Code\n";
exit 0;

$line
my $statsResult = $user_stats->find( { msisdn => '$line' } );
$line
mynickname
