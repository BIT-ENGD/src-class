#!/usr/bin/perl -w
    use strict;
    use CGI;
    package SwitchGUI;

    sub new {
        my ($classe, $nom, $nbports, $gio) = @_;

        my $this = {
            "nom"     => $nom,
            "nbports" => $nbports,
            "gio"     => $gio
        };

        bless($this, $classe);
        $this->afficher();
        return $this;   
    }

    sub afficher {
        my ($this) = @_;
        my @tab = ( 1 .. $this->{nbports} );
        my @odd = grep { $_ % 2 } @tab;
        my @even = grep { not $_ % 2 } @tab;

        my $cgi = new CGI;
        my $i;
        my $j;

        print "<div id=\"$this->{nom}\" class=\"switch\">\n";
        print $cgi->h2("$this->{nom}");

        print "<div class=\"ports\">";
        for my $port (@odd) {
            my $res = `perl ifname-index.pl -h $this->{nom} -i FastEthernet0/$port -c reseau`;

            if ($res =~ /^Erreur /) {
                print $cgi->img({
                src => 'ressources/interface_haut_down.png',  
                alt => "port n°$port",
                }), "\n",
            }
            else {
                print $cgi->a({class=>"tooltip", title=>$res},$cgi->img({
                src => 'ressources/interface_haut_up.png',  
                alt => "port n°$port",
                }), "\n",)
            }
        }

        print "<br/>";
        for my $port (@even) {
            my $res = `perl ifname-index.pl -h $this->{nom} -i FastEthernet0/$port -c reseau`;      
            if ($res =~ /^Erreur/) {
                print $cgi->img({
                src => 'ressources/interface_bas_down.png',  
                alt => "port n°$port",
                }), "\n",
            }
            else {
                if ($this->getDuplex($res)!="Full") {
                    print $cgi->a({class=>"tooltip", title=>$res},$cgi->img({
                    src => 'ressources/interface_bas_duplex.png',  
                    alt => "port n°$port",
                    }), "\n",)
                }
                elsif ($this->getVitesse($res)!="100"){
                    print $cgi->a({class=>"tooltip", title=>$res},$cgi->img({
                    src => 'ressources/interface_bas_speed.png',  
                    alt => "port n°$port",
                    }), "\n",)
                }
                else {
                    print $cgi->a({class=>"tooltip", title=>$res},$cgi->img({
                    src => 'ressources/interface_bas_up.png',  
                    alt => "port n°$port",
                    }), "\n",)
                }
            }
        }
        print "</div>";
        print "<div class=\"gio\">";
        for ($j=0;$j<$this->{gio};$j++) {
            my $req = system("perl ifname-index.pl -h $this->{nom} -i GigabitEthernet0/$j -c reseau &");
            print $cgi->img({
                src => 'ressources/interface_bas_down.png',  
                alt => "port",
                });
        }
        print "</div>\n";

        print "</div>\n";

    }

    1;

&
my $res = `perl ifname-index.pl -h $this->{nom} -i FastEthernet0/$port -c reseau`;

