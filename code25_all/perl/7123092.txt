use IO::Socket;
use IO::Select;
use strict;
$|=1;
my $host="10.0.0.12";
my $SELECT = new IO::Select;
print "Connecting...";
my $sock=new IO::Socket::INET (
    PeerAddr => $host,
    PeerPort => 3128,
    Proto => 'tcp',
    Blocking => 0);
    if(!$sock)
    {
        print "Could not create socket: $!n";
    }
    #print "ok\n";
    $SELECT->add($sock);
    my $buf;
    while (1){
    if($sock and $sock->connected())
    {
        print "ok\n";
    }
    while (my @ready=$SELECT->can_read(0.5))
    {
        foreach my $child (@ready)
        {
            if(!sysread($child, $buf, 256))
            {
                $SELECT->remove($child);
                next;
            }

        }
    }
    sleep 1;
}

if(!sysread($child, $buf, 256))
{
  $SELECT->remove($child);
  next;
}

