#! /usr/bin/perl

use strict;
use warnings;
use POSIX;
use Data::Dumper;



my $input = $ARGV[0];
open (DATAFILE, $input) or die $!;
open(OUT,">>"."final.output.txt");

my($line,$fMeasure,$filename,$recall,$precision,$z_score,$computer_calls,$johns_calls,$false_negatives,$false_positives,$true_positives,$count);
$fMeasure=$filename=$recall=$precision=$z_score=$computer_calls=$johns_calls=$false_negatives=$false_positives=$true_positives=$count = 0;




my %stats=();
my %zscore=();
while($line = <DATAFILE>){ 
     # Chop off new line character, skip the comments and empty lines.                 
     chomp($line); 
     my @temp = split(/\t/, $line);
     $true_positives = $temp[0];
     $false_positives = $temp[1];
     $false_negatives = $temp[2];
     $johns_calls = $temp[3];
     $computer_calls = $temp[4];
     $z_score = $temp[5];
     $fMeasure = $temp[6];
     $precision = $temp[7];
     $recall =  $temp[8];
     $filename = $temp[9];
     $stats{$z_score}{$filename}[0] = $true_positives;
     $stats{$z_score}{$filename}[1] = $false_positives;
     $stats{$z_score}{$filename}[2] = $johns_calls;
     $stats{$z_score}{$filename}[3] = $computer_calls;
     $stats{$z_score}{$filename}[4] = $fMeasure;
     $stats{$z_score}{$filename}[5] = $precision;
     $stats{$z_score}{$filename}[6] = $recall;
     $stats{$z_score}{$filename}[6] = $filename;
     $zscore{$z_score}++;

}


my $false_positives_new = 0;
my $true_positives_new = 0;
my $johns_calls_new = 0; 
my $computer_calls_new = 0;
my $file_name = 0;


foreach $z_score ( sort keys %stats ) {
foreach $filename( keys %{$stats{$z_score}} ){
    my $tp = $stats{$z_score}{$filename}[0];
    my $fp = $stats{$z_score}{$filename}[1];
    my $jc = $stats{$z_score}{$filename}[2];
    my $cc = $stats{$z_score}{$filename}[3];
    my $fn = $stats{$z_score}{$filename}[6];
    #print "$z_score\t$jc\n";
    $false_positives_new = $false_positives + $fp;
    $true_positives_new = $true_positives + $tp;
    $johns_calls_new = $johns_calls + $jc; 
    $computer_calls_new = $computer_calls + $cc;

    #print OUT "$fn\n";
}

print OUT"$true_positives_new\t$false_positives_new\t$johns_calls_new\t$computer_calls_new\t$z_score  \n";
$false_positives_new = 0;
$true_positives_new = 0;
$johns_calls_new = 0;
$computer_calls_new = 0;
$file_name = 0;

}



close(OUT);
close (DATAFILE);

