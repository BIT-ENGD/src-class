authResult/access_token
#!/usr/bin/perl

use WWW::Mechanize;
#use HTTP::Request::Common qw(POST);
use HTTP::Cookies;
use LWP::UserAgent;
use Data::Dumper;
use CGI;

my $email; #stores our mail
my $password; #stores our password
my $user_agent = 'Nest/1.1.0.10 CFNetwork/548.0.4';

$email = "email@email";
$password = "mypassword";

my @headers = (
   'User-Agent' => 'Nest/1.1.0.10 CFNetwork/548.0.4',
   'X-nl-user-id' => $email, 
   'X-nl-protocol-version' => '1', 
   'Accept-Language' => 'en-us', 
   'Connection' => 'keep-alive', 
   'Accept' => '*/*'
  );

# print "Content-type: text/html\n\n";

my $cookie = HTTP::Cookies->new(file => 'cookie',autosave => 1,);

my $browser = WWW::Mechanize->new(cookie_jar => $cookie, autocheck => 1,);

# tell it to get the main page
$browser->get("https://home.nest.com/user/login");

print Dumper($browser->forms);

# okay, fill in the box with the name of the
# module we want to look up
$browser->form_number(1);
$browser->field("username", $email);
$browser->field("password", $password);
$browser->submit();
print $browser->content();

         'inputs' => [
                       bless( {
                                'maxlength' => '75',
                                '/' => '/',
                                'value_name' => 'E-mail address',
                                'name' => 'username',
                                'id' => 'id_username',
                                'type' => 'text'
                              }, 'HTML::Form::TextInput' ),
                       bless( {
                                '/' => '/',
                                'value_name' => 'Password',
                                'name' => 'password',
                                'id' => 'id_password',
                                'type' => 'password',
                                'minlength' => '6'
                              }, 'HTML::Form::TextInput' ),
                       bless( {
                                'readonly' => 1,
                                '/' => '/',
                                'value_name' => '',
                                'value' => '',
                                'name' => 'next',
                                'type' => 'hidden'
                              }, 'HTML::Form::TextInput' ),
                       bless( {
                                'readonly' => 1,
                                '/' => '/',
                                'value_name' => '',
                                'value' => 'dbbadca7910c5290a13d30785ac7fb79',
                                'name' => 'csrfmiddlewaretoken',
                                'type' => 'hidden'
                              }, 'HTML::Form::TextInput' )

csrfmiddlewaretoken
