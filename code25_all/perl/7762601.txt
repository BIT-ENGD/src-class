#!/usr/bin/perl
use strict;
use AnyEvent;

my $cv = AnyEvent->condvar( cb => sub {
    warn "done";
});

for my $i (1..10) {
    $cv->begin;
    my $w; $w = AnyEvent->timer(after => $i, cb => sub {
    warn "finished timer $i";
    undef $w;
    $cv->end;
    });
}

$cv->recv;

send/recv/begin/end
my $i = 1;
my $s = sub {
    print $i;
};
my $i = 10;
$s->();  # 1

