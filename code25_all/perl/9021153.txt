my $var = $cgi->param('param_name');
$cgi->delete_all();
my $challenge = $q->param('recaptcha_challenge_field');
my $response = $q->param('recaptcha_response_field');
my $username = $q->param('Username');
my $password = $q->param('Password');
my $name = $q->param('Name');
my $email = $q->param('Username');
my $security = $q->param('Security');
my $answer = $q->param('Answer');
my $permissions = 1;

# Verify submission
my $result = $c->check_answer(
    "my_private_key", $ENV{'REMOTE_ADDR'},
    $challenge, $response
);

if ( $result->{is_valid} ) {
    insert_new_user();
    print  $q->redirect('cgi-bin/admin/text_campaign.pl');
}
else {
    # Error
    print  $q->redirect('login.pl?crc=false');
}

###############################################################################
# Sub Routines                                                                #
###############################################################################
sub insert_new_user
{
    my $sql = "INSERT INTO users (u_username, u_password, u_realname, u_email, u_security_question, u_security_answer, PRIVILEGES_idPRIVILEGES)
               VALUES(?, ?, ?, ?, ?, ?, ?) ";
    my $sth=$dbh->prepare($sql);
    $sth->execute($username, $password, $name, $email, $security, $answer, $permissions);
    $sth->finish();

    return;
}

