# step 1: Redirect user to Twitter
my $client = Net::Twitter::OAuth->new(
traits          => ['OAuth'],
consumer_key    => Bargain->config->{'consumer_key'},
consumer_secret => Bargain->config->{'consumer_secret'},
);

my $url = $client->oauth->get_authorization_url({ callback => $callback_url});

$c->response->cookies->{oauth} = {
      value => {
          token => $client->request_token,
          token_secret => $client->request_token_secret,
      },
};

$c->response->redirect($url);


# step 2 - After installing the app, Twitter redirects the user here
my $verifier = $c->req->params->{oauth_verifier};
my $oauth_token = $c->req->params->{oauth_token};

$client->request_token($client->request_token);
$client->request_token_secret($client->request_token_secret);

my($access_token, $access_token_secret) = 
    $client->request_access_token(verifier => $verifier);

# step 3 - With all the info, Access suer account
my $nt = Net::Twitter::OAuth->new(
     traits          => ['OAuth'], # 'API::REST', 
     consumer_key    => Bargain->config->{'consumer_key'},
     consumer_secret => Bargain->config->{'consumer_secret'},
);

$nt->access_token($access_token);
$nt->access_token_secret($access_token_secret);

if ( $nt->authorized ) {
    print "Authorized, sending tweets\n";
    print $nt->friends_timeline, "\n"; # OK

    $nt->update('First example'); # Does not work
}

