Ã©
&#xe9;
sub as_entity{
  my $char = shift;
  return sprintf("&#x%.4x;", ord($char));
}

sub entitify{
  my $str = shift;
  $str =~ s/([\x7f-\x{ffffff}])/(?{as_entity($1)})/g;
  return $str;
}

(?{...})
