 if($userTz && $userTz ne "Europe/London"){
    $ENV{TZ} = "$userTz";
 }

($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime($time);
...

