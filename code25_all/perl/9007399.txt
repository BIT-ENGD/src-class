my $hash = foo();

while (my ($key, $value) = each %$hash)

my @keysArray = ();

for my $key (@keysArray){
    delete $hash{$key};# this line of code is causing the problem
}

