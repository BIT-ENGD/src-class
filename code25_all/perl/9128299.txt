my %ba;
while ( my ( $before, $afters_aref ) = each %deps ) {
  for my $after ( @{ $afters_aref } ) {
        $ba{$before}{$after} = 1 if $before ne $after;
        $ba{$after} ||= {};
    }
}

