#!/usr/bin/env perl
use warnings; use strict;

use Email::Sender::Transport::SMTP::TLS; 
my $mailer = Email::Sender::Transport::SMTP::TLS->new(
    host => 'smtp.my.host',
    port => 587,
    username => 'username',
    password => 'password',
);

use Email::MIME::Creator;
use IO::All;
my @parts = (    
    Email::MIME->create(
    attributes => {
        content_type => 'text/plain',
        disposition  => 'inline',
        encoding     => 'quoted-printable',
        charset      => 'UTF-8',
    },
    body => "Hello there!\n\nHow are you?",
    ),
    Email::MIME->create(
    attributes => {
        filename     => "test.jpg",
        content_type => "image/jpeg",
        disposition  => 'attachment',
        encoding     => "base64",
        name         => "test.jpg",
    },
    body => io( "test.jpg" )->all,
    ),
);
my $email = Email::MIME->create(
    header => [ From => 'my@address', To => 'your@address', Subject => 'subject', ],
    parts  => [ @parts ],
);

eval {
    $mailer->send( $email, {
        from => 'my@address',
        to   => [ 'your@address' ],
    } );
};
die "Error sending email: $@" if $@;

