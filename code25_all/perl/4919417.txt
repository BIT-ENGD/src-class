#!/use/bin/perl
use strict;
use warnings;
use Frontier::Daemon;
use DBI;

sub credentials {
    my ($username, $password) = @_;

    my $tablename = "users";
    my $user      = "db_user";
    my $pw        = "db_pass";

    $dbh = DBI->connect('DBI:mysql:database;host=localhost', $user, $pw, {RaiseError => 1});
    $sql = "SELECT username, password FROM $tablename";
    $sth = $dbh->prepare($sql);
    $sth->execute or die "SQL Error: $DBI::errstr\n";

    if ($sth->rows > 0) {
        $login_response = "Login Successful";
    } else {
        $login_response = "Invalid Credentials";
        return {'login' => $login_response};
        die();
    }
}

$methods = {'login.credentials' => \&credentials,};
Frontier::Daemon->new(LocalPort => 8080, methods => $methods)
  or die "Couldn't start HTTP server: $!";

