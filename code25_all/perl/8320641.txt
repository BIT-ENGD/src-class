if (not defined $config{'crontab'}) {
  die "no crontab defined!";
}

sub main()
{
    my %config = %{getCommandLineOptions()};
    my $programdir = File::Spec->canonpath (    (fileparse ( Win32::GetFullPathName($PROGRAM_NAME) ))[1] );
    my $logdir = File::Spec->catdir ($programdir, 'logs');
    $logfile = File::Spec->catfile ($logdir, 'cronw.log');

    configureLogger($logfile);
    $log = get_logger("cronw::cronService-pl");

    # if --exec option supplied, we are being invoked to execute a job
    if ($config{exec}) {
        execJob(decodeArgs($config{exec}), decodeArgs($config{args}));
        return;
    }

    my $cronfile = $config{'crontab'};

    $log->info('starting service');
    $log->debug('programdir: '.$programdir);
    $log->debug('logfile: '.$logfile);
    if (not defined $config{'crontab'}) {
        $log->error("no crontab defined!\n");
        die "no crontab defined!";
        # fixme: crontab detection?
    }
    $log->debug('crontab: '.$config{'crontab'});

sub getCommandLineOptions()
{
my $clParser = new Getopt::Long::Parser config => ["gnu_getopt", "pass_through"];
my %config = ();
my @parameter = (   'crontab|cronfile=s',
    'exec=s',
    'args=s',
    'v|verbose'
                          );

$clParser->getoptions (\%config, @parameter);
if (scalar (@ARGV) != 0)  { $config{'unknownParameter'} = $true; }

return \%config;
}

