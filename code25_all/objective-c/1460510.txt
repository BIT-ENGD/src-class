// In OneLine.h
@interface OneLine : UIView {}
@end

// In OneLine.m
- (void)drawRect:(CGRect)rect {
    // Drawing code
    [[UIColor blackColor] set];
    UIRectFill(rect);
    [[UIColor whiteColor] set];
    UIRectFill(CGRectMake(rect.origin.x, rect.origin.y, rect.size.width, 1));
}
- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        // Initialization code
        self.contentMode = UIViewContentModeTop;
    }
    return self;
}

// In MyTable.h
#import <UIKit/UIKit.h>

@interface MyTable : UITableViewController {
    NSMutableArray *data;
}
@end

// In MyTable.m
#import "MyTable.h"
#import "OneLine.h

@implementation MyTable
- (id)initWithStyle:(UITableViewStyle)style {
    if (self = [super initWithStyle:style]) {
        srand(time(NULL));
        data = [[NSMutableArray alloc] init];
        for (size_t index = 0; index < 200; ++index) {
            // Each cell has a different height betweet 40 and 50 pixels tall.
            [data addObject:[NSNumber numberWithInt:(rand() % 10) + 40.5]];
        }
    }
    return self;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"Cell"];
    if (cell == nil) {
        cell = [[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@"Cell"] autorelease];
        cell.contentView.contentMode = UIViewContentModeTop;
        OneLine *view = [[OneLine alloc] initWithFrame:cell.contentView.bounds];
        [cell.contentView addSubview:view];
    }

    // Set up the cell...
    OneLine *view = [cell.contentView.subviews objectAtIndex:[cell.contentView.subviews count] - 1];
    // Build the correct frame
    view.frame = CGRectMake(0, 0, cell.contentView.bounds.size.width, [MyTable tableView:(UITableView*)self.view heightForRowAtIndexPath:indexPath]);
    return cell;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return [data count];
}

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath {
    NSNumber *num = (NSNumber*) [data objectAtIndex:indexPath.row];
    return [num intValue];
}
@end

