+(NSSet *)extractXMLSectionsWithTag:(NSString *)tag fromString:(NSString *)source firstOnly:(BOOL)firstOnly
{
 if (!source)
    return nil;
 NSScanner *scanner = [NSScanner scannerWithString:source];
 NSString *openingToken = [NSString stringWithFormat:@"<%@", tag];
 NSString *closingToken = [NSString stringWithFormat:@"</%@>", tag];
 NSMutableSet *sections = [NSMutableSet set];
 NSCharacterSet *majorChar = [NSCharacterSet characterSetWithCharactersInString:@">"];

 while (![scanner isAtEnd]) {
    NSString *xmlBlock = [[[NSString alloc] init] autorelease];
    [scanner scanUpToString:openingToken intoString:NULL];
    [scanner scanString:openingToken intoString:NULL];
    [scanner scanUpToCharactersFromSet:majorChar intoString:NULL];
    [scanner scanCharactersFromSet:majorChar intoString:NULL];
    [scanner scanUpToString:closingToken intoString:&xmlBlock];
    if (![xmlBlock isEqualToString:@""]) { // Leaking line
        [sections addObject:xmlBlock];
        if (firstOnly) {
            break;
        }
    }
 }
 return [sections copy];
}

