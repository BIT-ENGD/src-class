kernel vec4 threshold(sampler image, float midPoint, float range ) // First error on this line
//This from http://www.codingadventures.com/2008/06/threshold-filter-in-glsl/
{
    vec4 pixel=unpremultiply( sample(image, samplerCoord(image)) );

    float high = midPoint + range * 0.5;
    float low = midPoint - range * 0.5; 

    high = min(1.0, high);
    low = max(0.0, low);

    float brightness = 0.3 * pixel.x + 0.59 * pixel.y+ 0.11 *pixel.z;

    brightness = step( low, brightness ) * brightness;

    brightness = brightness + step(  high, brightness );
    brightness = min( 1.0, brightness );

    pixel.x = pixel.y =pixel.z = brightness;

    return premultiply(pixel);
}

