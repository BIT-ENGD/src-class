- (void)getUserName 
{ 

        NSString *fql = [NSString localizedStringWithFormat: @"SELECT uid FROM user WHERE is_app_user = 1 AND uid IN (SELECT uid2 FROM friend WHERE uid1 = %lld)",[FBSession session].uid];

        NSDictionary* params = [NSDictionary dictionaryWithObject:fql forKey:@"query"];
        [[FBRequest requestWithDelegate:self] call:@"facebook.friends.get" params:params];
        }

            - (void)request:(FBRequest*)request didLoad:(id)result {

              if ([request.method isEqualToString:@"facebook.fql.query"]) {
              NSArray* users = result;
              NSDictionary* user = [users objectAtIndex:0];
              NSString* name = [user objectForKey:@"name"];
              _label.text = [NSString stringWithFormat:@"Logged in as %@", name];
          }   else if ([request.method isEqualToString:@"facebook.users.setStatus"]) {
             NSString* success = result;
             if ([success isEqualToString:@"1"]) {
             _label.text = [NSString stringWithFormat:@"Status successfully set"]; 
             } else {
             _label.text = [NSString stringWithFormat:@"Problem setting status"]; 
             }
             } else if ([request.method isEqualToString:@"facebook.freinds.get"]) 
             {

        if(myList==nil) 
              {
            NSArray* users = result;
            myList =[[NSArray alloc] initWithArray: users];
            for(NSInteger i=0;i<[users count];i++) {
              NSDictionary* user = [users objectAtIndex:i];
              NSString* uid = [user objectForKey:@"uid"];
              NSString* fql = [NSString stringWithFormat:
                @"select name from user where uid == %@", uid];
           NSDictionary* params = [NSDictionary dictionaryWithObject:fql forKey:@"query"];
           [[FBRequest requestWithDelegate:self] call:@"facebook.fql.query" params:params];
            }
           }
           else {
                NSArray* users = result;
                NSDictionary* user = [users objectAtIndex:0];
                NSString* name = [user objectForKey:@"name"];
          //txtView.text=[NSString       localizedStringWithFormat:@"%@%@,\n",txtView.text,name];
           NSLog(name);       
          }}

