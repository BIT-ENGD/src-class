    @implementation PowerListener
void myPowerChanged(void * context) {
    printf("Is charging: %d\n", [PowerFunctions isCharging]);
    printf("Is on ac: %d\n", [PowerFunctions isOnAC]);
    printf("Charge left: %d\n", [PowerFunctions currentCapacity]);
    printf("Powerchanged\n");
    NSManagedObject *newBatteryEvent = [NSEntityDescription 
                        insertNewObjectForEntityForName:@"BatteryEvent" 
                                     inManagedObjectContext:context];
}

- (PowerListener*) init {
    self = [super init];
    if(self) {
        CFRunLoopSourceRef loop = IOPSNotificationCreateRunLoopSource(myPowerChanged, [[NSApp delegate] managedObjectContext]);
        CFRunLoopAddSource(CFRunLoopGetCurrent(), loop, kCFRunLoopDefaultMode);
        CFRelease(loop);
    } else {
        printf("Error\n");
    }
    return self;
}
@end

2009-08-19 17:59:46.078 BatteryApp[5851:813] +entityForName: could not locate an NSManagedObjectModel for entity name 'BatteryEvent'

