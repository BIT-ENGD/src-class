- (void) run:(NSString *)sql {
NSArray *data = [NSArray arrayWithObjects:
                 sql,
                 [self returnItemClass],
                 nil];

NSInvocationOperation *operation = 
[[NSInvocationOperation alloc] initWithTarget:self 
                                     selector:@selector(loadRecords:) 
                                       object:data]; 
[self.queue addOperation:operation];
[operation release];
}

- (void) loadRecords:(NSArray *)data {
    NSLog(@"Runing sql");
    NSString * sql = [data objectAtIndex:0];
    Class cls = [data objectAtIndex:1];

    Db *db= [Db currentDb];

    NSArray *list = [db loadAndFill:sql theClass:cls];
    [UIAppDelegate performSelectorOnMainThread:@selector(recordsLoaded:)
                                           withObject:list
                                        waitUntilDone:YES];
}

- (void) recordsLoaded:(NSArray *)data {
NSLog(@"Loading sql");
for (DbObject *o in data) {
    [self.objectCache setObject:o forKey:[NSNumber numberWithInt:o.Id]];
}
}

    [UIAppDelegate performSelectorOnMainThread:@selector(recordsLoaded:)
                                       withObject:list
                                    waitUntilDone:YES];

