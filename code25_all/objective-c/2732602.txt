#import <UIKit/UIKit.h>
#import "DTGridView.h"

@interface TestController : UIViewController <DTGridViewDelegate, DTGridViewDataSource> 
{
    DTGridView*     thumbGrid;
}

@end

#import "TestController.h"

@implementation TestController

int rows = 1;

- (NSInteger)numberOfRowsInGridView:(DTGridView *)gridView
{
    return rows;
}

- (NSInteger)numberOfColumnsInGridView:(DTGridView *)gridView forRowWithIndex:(NSInteger)index
{
    if (index == rows - 1)
        return 1;
    else
        return 3;
}

- (CGFloat)gridView:(DTGridView *)gridView heightForRow:(NSInteger)rowIndex
{
    return 57.0f;
}

- (CGFloat)gridView:(DTGridView *)gridView widthForCellAtRow:(NSInteger)rowIndex column:(NSInteger)columnIndex
{
    if (rowIndex == rows - 1)
        return 320.0f;
    else
        return 106.6f;
}

- (DTGridViewCell *)gridView:(DTGridView *)gridView viewForRow:(NSInteger)rowIndex column:(NSInteger)columnIndex
{
    DTGridViewCell *view = [[gridView dequeueReusableCellWithIdentifier:@"thumbcell"] retain];

    if (!view)
        view = [[DTGridViewCell alloc] initWithReuseIdentifier:@"thumbcell"];

    if (rowIndex == rows - 1)
    {
        UIButton* btnLoadMoreItem = [[UIButton alloc] initWithFrame:CGRectMake(10, 0, 301, 57)];
        [btnLoadMoreItem setTitle:[NSString stringWithFormat:@"Button %d", rowIndex] forState:UIControlStateNormal];
        [btnLoadMoreItem.titleLabel setFont:[UIFont boldSystemFontOfSize:20]];
        [btnLoadMoreItem setBackgroundImage:[[UIImage imageNamed:@"big-green-button.png"] stretchableImageWithLeftCapWidth:10.0 topCapHeight:0.0] forState:UIControlStateNormal];
        [btnLoadMoreItem addTarget:self action:@selector(selectLoadMoreItems:) forControlEvents:UIControlEventTouchUpInside];
        [view addSubview:btnLoadMoreItem];
        [btnLoadMoreItem release];
    }
    else {
        UILabel* label = [[UILabel alloc] initWithFrame:CGRectMake(10,0,100,57)];
        label.text = [NSString stringWithFormat:@"%d x %d", rowIndex, columnIndex];     
        [view addSubview:label];
        [label release];
    }

    return [view autorelease];
}

- (void) selectLoadMoreItems:(id) sender
{
    rows++;
    [thumbGrid setNeedsDisplay];
}

- (void)viewDidLoad
{
    [super viewDidLoad];

    thumbGrid = [[DTGridView alloc] initWithFrame:CGRectMake(0,0, 320, 320)];
    thumbGrid.dataSource = self;
    thumbGrid.gridDelegate = self;
    [self.view addSubview:thumbGrid];
}

- (void)viewDidUnload
{
    [super viewDidUnload];
}

- (void)dealloc {
    [super dealloc];
}

@end

