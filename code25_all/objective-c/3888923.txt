PersonDetails *personDetails = [[PersonDetails alloc] init];

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
// Navigation logic may go here. Create and push another view controller.
updatePersonArray = YES;
arrayIndex = indexPath.row-1;       
editPerson = [[EditClassController alloc] initWithNibName:@"EditPerson" bundle:nil];    
editPerson.title = @"Edit Person";

if (arrayIndex != -1) { 
    personDetails = [classArray objectAtIndex:arrayIndex];      
}
else {
    personDetails = [[PersonDetails alloc] init];   
}   
editPerson.personDetails = personDetails;

[self.navigationController pushViewController:editPerson animated:YES];
[editPerson release];

- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];

    if ([personDetails isEmpty]) {
        updatePersonArray = NO;
    }

    if (updatePersonArray) {
        if (arrayIndex == -1) {
            NSLog(@"adding new object to array");
            [personArray addObject:personDetails];
        }
        else {  
            NSLog(@"replacing object at index %d", arrayIndex);
            [personArray replaceObjectAtIndex:arrayIndex withObject:personDetails];
             }

        [self saveArrayToDisk];

        [self.tableView reloadData];

        updatePersonArray = NO;
    }
    else {
         //load the array from disk
    NSLog(@"loading array from disk");
        NSData *theData = [[NSUserDefaults standardUserDefaults] objectForKey:@"personArray"];
        if (theData != nil) {
            NSLog(@"found something");
            personArray = [[NSMutableArray alloc] initWithArray:[NSKeyedUnarchiver unarchiveObjectWithData:theData]];
        }
        else {
            personArray = [[NSMutableArray alloc] init];
        }

    }

}

