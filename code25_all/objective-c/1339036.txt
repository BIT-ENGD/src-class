- (IBAction)sortingSegmentAction:(id)sender{

NSString *keyToSortBy = [NSString alloc];

if([sender selectedSegmentIndex] == 0)
{
    self.sortingSegmentActionPressed = 0;
    keyToSortBy = @"FirstName";
}
else if([sender selectedSegmentIndex] == 1)
{
    self.sortingSegmentActionPressed = 1;
    keyToSortBy = @"LastName";
}

    //Create the sort descriptors
    NSSortDescriptor *sortDescriptor = [[[NSSortDescriptor alloc] initWithKey:keyToSortBy ascending:YES] autorelease];
    NSArray *sortDescriptors = [NSArray arrayWithObject:sortDescriptor];

    //Sort allSubItams by the values set in the sort descriptors
    NSArray *sortedArray;
    self.sortedArray = [allSubItems sortedArrayUsingDescriptors:sortDescriptors];

    //Recreate the data structure by putting the newly sorted items into a dictionary sorted by inital letters.
    NSDictionary *eachItemList;  //A DICTIONARY FOR PUTTING ALL THE DATA FOR EACH ITEM IN IT'S OWN SECTION
    NSMutableDictionary *tempSectionedDictionaryByFirstLetter = [[NSMutableDictionary alloc] init];

    for (eachItemList in sortedArray)   //eachElementList is a dictionary with a section for each item
    {
        NSDictionary *aDictionary = [[NSDictionary alloc] initWithDictionary:eachItemList];
        NSString *firstLetterString;
        firstLetterString = [[aDictionary valueForKey:keyToSortBy]substringToIndex:1];
        NSMutableArray *existingArray;
        if (existingArray = [tempSectionedDictionaryByFirstLetter valueForKey:firstLetterString]) 
        {
            [existingArray addObject:eachItemList];
        } else {
            NSMutableArray *tempArray = [NSMutableArray array];
            [tempSectionedDictionaryByFirstLetter setObject:tempArray forKey:firstLetterString];
            [tempArray addObject:eachItemList];
        }
        [aDictionary release];
        [eachItemList release];
    }

 //Set the data source for the table (sectionedDictionaryByFirstLetter) to tempSectionedDictionaryByFirstLetter.
    self.sectionedDictionaryByFirstLetter = tempSectionedDictionaryByFirstLetter;
    NSMutableArray *keyArray = [[NSMutableArray alloc] init];
    [keyArray addObjectsFromArray:[[self.sectionedDictionaryByFirstLetter allKeys] sortedArrayUsingSelector:@selector(compare:)]];
    self.keys = keyArray;

    [self.tableView reloadData];

    [keyArray release];
    [tempSectionedDictionaryByFirstLetter release];

}

