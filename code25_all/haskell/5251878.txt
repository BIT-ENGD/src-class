{-# LANGUAGE ScopedTypeVariables #-}
module Test where

import Database.Oracle.Enumerator
import Control.Monad.Trans (liftIO)
import Connections (watDevDb, watProdDb)
import System.Environment
import Data.Char

main :: IO ()
main = do
  [fn] <- getArgs
  sqls <- readFile fn
  flip catchDB reportRethrow (withSession watProdDb $ do
         let iter (c1::Maybe String) (c2::Maybe String) (c3::Maybe String) (r::Maybe String) = result' c3
         rslt <- doQuery (sql sqls) iter (Nothing::Maybe String)
         liftIO (putStrLn . show $ rslt))

test = withArgs ["extract.sql"] main

c2
c3
*** Exception: DBError ("01","000") 1406 " : ORA-01406: fetched column value was truncated\n"
c3
c3
