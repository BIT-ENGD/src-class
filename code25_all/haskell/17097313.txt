TBQueue
TVar
shouldRead <- readTVar shouldReadVar
if shouldRead
  then do
    a <- readTBQueue queue
    doSomethingWith a
  else doSomethingElse

queue
shouldReadVar
True
readTBQueue
retry
shouldReadVar
False
queue
SyncChan
writeSyncChan
readSyncChan
shouldRead <- readTVar shouldReadVar
if shouldRead
  then do
    a <- readSyncChan syncChan
    doSomethingWith a
  else doSomethingElse

writeSyncChan
shouldReadChan
True
retry
shouldReadChan
False
writeSyncChan
retry
writeSyncChan
readSyncChan
retry
shouldReadVar
T
MVar
atomically
TMVar
TMVar
