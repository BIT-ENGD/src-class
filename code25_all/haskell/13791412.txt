Profile
    username Text
    user UserId
    UniqueProfile user
    UniqueUsername username

Left
profileForm :: Maybe ProfileForm -> Form ProfileForm
profileForm mpf = renderBootstrap $ ProfileForm
        <$> areq usernameField (FieldSettings {fsLabel = "Username", fsTooltip = Nothing, fsId = Nothing, fsName = Nothing, fsAttrs = [("autofocus","autofocus")]}) (pfUsername <$> mpf)
    where
        unav x = do
            (Entity uid _) <- requireAuth
            usernamecount <- runDB $ count [ ProfileUsername ==. x 
                                          , ProfileUser !=. uid ]
            return $ if usernamecount > 0
                        then Left ("Username already taken" :: Text)
                        else Right x

        usernameField = checkM unav textField

