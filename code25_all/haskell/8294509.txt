main = withSocketsDo $ do
        s <- socket AF_INET Datagram defaultProtocol
        hostAddr <- inet_addr host
        done <- newEmptyMVar
        let p = B.pack "ping"
        thread <- forkIO $ receiveMessages s done
        forM_ [0 .. 10000] $ \i -> do
              sendAllTo s (B.pack  "ping") (SockAddrInet port hostAddr)
        takeMVar done
        killThread thread
        sClose s
        return()

receiveMessages :: Socket ->  MVar () -> IO ()
receiveMessages socket done = do
        forM_ [0 .. 10000] $ \i -> do
              r <- recvFrom socket 1024
              print (r) --this is a placeholder to make the fun complete
        putMVar done ()

