{-# LANGUAGE EmptyDataDecls, DeriveDataTypeable, TemplateHaskell #-}
{-# OPTIONS_GHC -fcontext-stack=100 #-}

module Rectangle where

import OOHaskell

$(label "getLength")
$(label "getWidth")
$(label "incr")
$(label "lengthenBy")
$(label "setLength")
$(label "setWidth")

rectangle length width self
          = do
             lengthRef <- newIORef value
              widthRef <- newIORef width
              return $
              getLength   .=. readIORef lengthRef
          .*. getWidth    .=. readIORef widthRef
          .*. setLength   .=. writeIORef lengthRef
          .*. setWidth    .=. writeIORef widthRef
          .*. lengthenBy  .=. (\dv ->
                 do
                   value <- self # getValue
                   (self # setValue) (value + dv))
          .*. incr        .=. (self # (lengthenBy 1))
          .*. emptyRecord

 Rectangle.hs:21:38: Not in scope: `widthRef'
 Rectangle.hs:22:39: Not in scope: `lengthRef'
 Rectangle.hs:23:39: Not in scope: `widthRef'

The function `lengthenBy' is applied to one argument,
but its type `Proxy LengthenBy' has none
In the second argument of `(#)', namely `(lengthenBy 1)'
In the second argument of `(.=.)', namely `(self # (lengthenBy 1))'
In the first argument of `(.*.)', namely
  `incr .=. (self # (lengthenBy 1))'

