#include <stdio.h>
#include <stdlib.h>
#include <gio/gio.h>
#include <netdb.h>
/*
 * 
 */

static GSocket *sock;
    static GError *err = NULL;

void klwar()
{
    g_socket_close(sock,&err);
}

int main(int argc, char** argv) {


    GSocketAddress *gsockaddr;
    struct sockaddr_in sockaddr;
    sockaddr.sin_family = AF_INET;
    sockaddr.sin_port = htons(1221);
    sockaddr.sin_addr.s_addr = INADDR_ANY;

    g_type_init();
    gsockaddr = g_socket_address_new_from_native(&sockaddr,sizeof(sockaddr));

    sock = g_socket_new(G_SOCKET_FAMILY_IPV4,G_SOCKET_TYPE_STREAM,G_SOCKET_PROTOCOL_TCP,&err);

    g_socket_bind(sock,gsockaddr,TRUE,&err);

    g_socket_listen(sock,&err);

    char buff[123];

    atexit(klwar); //avoiding 

    GSocket *ja;


    while(ja = g_socket_accept(sock,NULL,&err))
    {

    gssize a = g_socket_receive(ja,buff,123,NULL,&err);
        printf("data : %s\n",buff);

    }

    return (EXIT_SUCCESS);
}

