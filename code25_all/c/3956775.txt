
SEC_WINNT_AUTH_IDENTITY_W identity;
ZeroMemory(&identity, sizeof(identity));

identity.Domain = (unsigned short *)_T("DOMAIN");
identity.DomainLength = lstrlenW(_T("DOMAIN"));
identity.User = (unsigned short *)_T("USER");
identity.UserLength = lstrlenW(_T("USER"));
identity.Password = (unsigned short *)_T("PASS");
identity.PasswordLength = lstrlenW(_T("PASS"));
identity.Flags = SEC_WINNT_AUTH_IDENTITY_UNICODE;

PCredHandle credentials = NULL;
PTimeStamp credentialsExpiry = NULL;

SECURITY_STATUS result = AcquireCredentialsHandleW(_T("USER"), _T("NTLM"), SECPKG_CRED_OUTBOUND, NULL, &identity, NULL, NULL, credentials, credentialsExpiry);

