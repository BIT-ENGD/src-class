#define SIZE 4
int main(void){
  int chars_read = 1;
  char buffer[SIZE + 1] = {0};  
  setvbuf(stdin, (char *)NULL, _IOFBF, sizeof(buffer)-1);  
  while(chars_read){
    chars_read = fread(buffer, sizeof('1'), SIZE, stdin);
    printf("%d, %s\n", chars_read, buffer);
  }
  return 0;
}



Using the above code, I am trying to read from a file using redirection ./a.out < data. Contents of input file:

1line
2line
3line
4line


But I am not getting the expected output, rather some graphical characters are mixed in.
What is wrong?



Hint: (Courtesy Alok)


sizeof('1') == sizeof(int)
sizeof("1") == sizeof(char)*2


So, use 1 instead :-)




Using the above code, I am trying to read from a file using redirection ./a.out < data. Contents of input file:

1line
2line
3line
4line


But I am not getting the expected output, rather some graphical characters are mixed in.
What is wrong?



Hint: (Courtesy Alok)


./a.out < data
1line
2line
3line
4line


sizeof('1') == sizeof(int)

sizeof('1') == sizeof(int)
sizeof("1") == sizeof(char)*2
Take a look at this post for buffered IO example using fread
