
    typedef struct{
        void *data;
        int body_size;
        int bytes_remaining;
        int bytes_written;
    } postdata;

size_t readfunc(void *ptr, size_t size, size_t nmemb, void *stream) {

if(stream) {
    postdata *ud = (postdata*)stream;

    if(ud->bytes_remaining) {
        if(ud->body_size > size*nmemb) {
            memcpy(ptr, ud->data+ud->bytes_written, size*nmemb);
            ud->bytes_written+=size+nmemb;
     ud->bytes_remaining = ud->body_size-size*nmemb;
            return size*nmemb;
 } else {
     memcpy(ptr, ud->data+ud->bytes_written, ud->bytes_remaining);
            ud->bytes_remaining=0;
  return 0;
        }
    }



size_t readfunc(void *ptr, size_t size, size_t nmemb, void *stream) {

if(stream) {
    postdata *ud = (postdata*)stream;

    if(ud->bytes_remaining) {
        if(ud->body_size > size*nmemb) {
            memcpy(ptr, ud->data+ud->bytes_written, size*nmemb);
            ud->bytes_written+=size+nmemb;
     ud->bytes_remaining = ud->body_size-size*nmemb;
            return size*nmemb;
 } else {
     memcpy(ptr, ud->data+ud->bytes_written, ud->bytes_remaining);
            ud->bytes_remaining=0;
  return 0;
        }
    }

