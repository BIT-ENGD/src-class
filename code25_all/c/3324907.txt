if((strlen(rbuf) > 0) && (rbuf[strlen(rbuf)-1] == '\n')){
    rbuf[strlen(rbuf)-1] = '\0';
   }

