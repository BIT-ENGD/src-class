size(void *p,int size);

Int *a = malloc((sizeof(int)*100));
size(a,sizeof(int)); // this should return 100

int size(void *p, int size)
{
  p = (unsigned int *)p - 1;
  unsigned int elements = (*(unsigned int *)p);
  return elements/size;
}

