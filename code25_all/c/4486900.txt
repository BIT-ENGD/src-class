#include <stdio.h>
#include <dlfcn.h>

int global_var = 0x9262;

int main(void) {
  void *handle = dlopen("libb.so", RTLD_LAZY);
  void (*func)(void);
  char *err;
  if (handle == NULL) {
    fprintf(stderr, "%s\n", dlerror());
    return 1;
  }
  func = dlsym(handle, "func");
  if ((err = dlerror()) != NULL) {
    fprintf(stderr, "%s\n", err);
    return 2;
  }
  global_var = 0x9263;
  func();
  return -dlclose(handle) * 3;
}

#include <stdio.h>

extern int global_var;

void func(void) {
  printf("0x%x\n", global_var);
}

$ gcc -shared -rdynamic -fpic -o liba.so a.c
$ gcc -shared -fpic -o libb.so -L. -la b.c
$ gcc -fpic -o a a.c
$ ./a
0x9262

0x9263
