currentHook = SetWindowsHookEx(WH_CALLWNDPROC, 
                               HookProc, 0, GetCurrentThreadId());

LRESULT CALLBACK HookProc(int nCode, WPARAM wp, LPARAM lp)
{
   CWPSTRUCT cwp = *(CWPSTRUCT *)lp;
   if (cwp.message == WM_COMMAND)
   {
      ATLTRACE("[hook!] WM_COMMAND id=%d\n", LOWORD(cwp.wParam));
   }
   return CallNextHookEx(currentHook, nCode, wp, lp);
}

