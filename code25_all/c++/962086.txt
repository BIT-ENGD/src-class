CODE:

struct Stringdata
{
  // Length of data in buffer.
  size_t len;
  // Allocated size of buffer.
  size_t alc;
  // Buffer.
  char data[1];
};

typedef std::list<Stringdata*> Stringdata_list;
Stringdata_list strings_;

Stringdata *psd = this->strings_.front();

//...
if (len > psd->alc - psd->len)
alc = sizeof(Stringdata) + buffer_size;
else
{
  char* ret = psd->data + psd->len;
  memcpy(ret, s, len - sizeof(Stringpool_char));
  memset(ret + len - sizeof(Stringpool_char), 0,
     sizeof(Stringpool_char));

  psd->len += len;

  return reinterpret_cast<const Stringpool_char*>(ret);
}

