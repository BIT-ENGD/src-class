<?xml version="1.0" encoding="utf-16"?>
<diagram>
  <refresh value="30" />
  <margin top="30" bottom="30" left="30" right="30" />
  <rates>
    <rate value="0" />
    <rate value="100" />
    <rate value="200" />
  </rates>
  <data>
    <record rate="121" label="" />
    <record rate="124" label="" />
    <record rate="141" label="" />
    <record rate="141" label="" />
    <record rate="148" label="" />
    <record rate="269" label="6:00" />
    <record rate="701" label="" />
    <record rate="755" label="" />
    <record rate="795" label="" />
    <record rate="850" label="7:00" />
    <record rate="935" label="" />
    <record rate="977" label="" />
  </data>
</diagram>

<record\b(?:(?=(\s+(?:rate="([^"]*)")|[^\s>]+|\s+))\1)*>

regex = Regexp.new('<record\b(?:(?=(\s+(?:rate="([^"]*)")|[^\s>]+|\s+))\1)*>')
matchdata = regex.match(s)
puts matchdata[0]

