class Document < ActiveRecord::Base
  has_many :document_sections, :dependent => :destroy, :autosave => true
  has_many :document_items, :through => :document_sections
end

class DocumentSection < ActiveRecord::Base
  belongs_to :document
  has_many :document_items, :dependent => :destroy, :autosave => true
end

class DocumentItem < ActiveRecord::Base
  belongs_to :document_section
end

-
Parameters: {"commit"=>"Submit Document", "authenticity_token"=>"4nx2B0pJkvavDmkEQ305ABHy+h5R4bZTrmHUv1setnc=", "id"=>"10184", "document"=>{"section"=>{"10254"=>{"seqnum"=>"3", "item"=>{"10259"=>{"comments"=>"tada"}}}}, "comment"=>"blah"}}

# PUT /documents/1                                                                                                                                                 
# PUT /documents/1.xml




def update
    @document = Document.find(params[:id])

    # This is header comment
    @document.comment = params[:document][:comment]

    params[:document][:section].each do |k,v|
       document_section =  @document.document_sections.find_by_id(k)
       if document_section

          v[:item].each do |key, value|
             document_item = document_section.feedback_items.find_by_id(key)
             if document_item

                # This is item comments
                document_item.comments = value[:comments]
             end
          end

       end
     end

    @document.save

  end

UPDATE documents SET updated_at = TO_DATE('2010-03-09 08:35:59','YYYY-MM-DD HH24:MI:SS'), comment = 'blah' WHERE id = 10184

