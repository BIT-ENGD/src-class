
user.valid_password? 'test'
=> true
Processing PasswordResetsController#update (for 127.0.0.1 at 2011-01-31 14:01:12) [PUT]
  Parameters: {"commit"=>"Update password", "action"=>"update", "_method"=>"put", "authenticity_token"=>"PQD4+eIREKBfHR3/fleWuQSEtZd7RIvl7khSYo5eXe0=", "id"=>"v3iWW5eD9P9frbEQDvxp", "controller"=>"password_resets", "user"=>{"password"=>"johnwayne"}}
 UPDATE users SET updated_at = '2011-01-31 22:01:12',
 crypted_password = 'blah',
 perishable_token = 'blah',
 password_salt = 'blah',
 persistence_token = 'blah'
 WHERE id = 580


users
updated_at
crypted_password
perishable_token
password_salt
persistence_token
id
I don't see an error per se, @user_session.save just returns false, as if the password didn't match.


I skip validating passwords in the User model:

class User < ActiveRecord::Base
  acts_as_authentic do |c|
    c.validate_password_field = false
  end


Here's the simplified controller code:

  def create
    logger.info("SAVED SESSION? #{@user_session.save}")
end


which outputs:


Processing UserSessionsController#create (for 127.0.0.1 at 2011-01-31 14:16:59) [POST]
  Parameters: {"commit"=>"Login", "user_session"=>{"remember_me"=>"0", "password"=>"johnwayne", "email"=>"test@email.com"}, "action"=>"create", "authenticity_token"=>"PQD4+eIREKBfHR3/fleWuQSEtZd7RIvl7khSYo5eXe0=", "controller"=>"user_sessions"}
  User Columns (2.2ms)   SHOW FIELDS FROM users
  User Load (3.7ms)   SELECT * FROM users WHERE (users.email = 'test@email.com') ORDER BY email ASC LIMIT 1
SAVED SESSION? false
  CACHE (0.0ms)   SELECT * FROM users WHERE (users.email = 'test@email.com') ORDER BY email ASC LIMIT 1
Redirected to http://localhost:3000/login


Lastly, the console indicates that the new password is valid:


class User < ActiveRecord::Base
  acts_as_authentic do |c|
    c.validate_password_field = false
  end

  def create
    logger.info("SAVED SESSION? #{@user_session.save}")
end


Processing UserSessionsController#create (for 127.0.0.1 at 2011-01-31 14:16:59) [POST]
  Parameters: {"commit"=>"Login", "user_session"=>{"remember_me"=>"0", "password"=>"johnwayne", "email"=>"test@email.com"}, "action"=>"create", "authenticity_token"=>"PQD4+eIREKBfHR3/fleWuQSEtZd7RIvl7khSYo5eXe0=", "controller"=>"user_sessions"}
  User Columns (2.2ms)   SHOW FIELDS FROM users
  User Load (3.7ms)   SELECT * FROM users WHERE (users.email = 'test@email.com') ORDER BY email ASC LIMIT 1
SAVED SESSION? false
  CACHE (0.0ms)   SELECT * FROM users WHERE (users.email = 'test@email.com') ORDER BY email ASC LIMIT 1
Redirected to http://localhost:3000/login

users
users
users
email
users
users
email

$ u.valid_password? 'johnwayne'
 => true

