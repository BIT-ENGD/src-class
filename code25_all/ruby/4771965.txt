class Pais
  include Mongoid::Document
  field :nome, :type => String
  field :sigla, :type => String

  embeds_many :ufds
  validates_uniqueness_of :sigla
end

class Ufd
  include Mongoid::Document
  field :codigo_ibge, :type => String
  field :sigla, :type => String
  field :nome, :type => String

  embedded_in :pais, :inverse_of => :ufds
  embeds_many :cidades

  validates_uniqueness_of :codigo_ibge, :sigla
end

class Cidade
  include Mongoid::Document
  field :codigo_ibge, :type => String
  field :nome, :type => String

  embedded_in :ufd, :inverse_of => :cidades
  validates_uniqueness_of :codigo_ibge
end

pais_base = Pais.create!(:nome => "Brasil", :sigla => "BR")

File.open(caminho + 'estados.txt').each_with_index do |linha, index|
  sigla, nome, ibge = linha.chomp.split("|")
  pais_base.ufds << Ufd.new(:sigla => sigla, :nome => nome, :codigo_ibge => ibge )
end

File.open(caminho + 'cidades.txt').each_with_index do |linha, index|
  ufd, ibge, nome = linha.chomp.split("|")
  uf = pais_base.ufds.find(:first, :conditions => {:codigo_ibge => ufd.to_s }) <<<<< NIL
  uf.cidades << Cidade.new(:codigo_ibge => ibge.to_s, :nome => nome)
end

