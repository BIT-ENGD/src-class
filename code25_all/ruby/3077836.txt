config.ru
require 'rubygems'
require 'couchrest'
require 'patina'

set :environment, :development
set :root, File.dirname(__FILE__)
set :run, false

FileUtils.mkdir_p 'log' unless File.exists?('log')
log = File.new("log/sinatra.log", "a")
$stdout.reopen(log)
$stderr.reopen(log)

set :db, CouchRest.database!("http://127.0.0.1:5984/test")

run Sinatra::Application

patina.rb
require 'rubygems'
require 'sinatra'
require 'couchrest'
require 'haml'

class Article < CouchRest::ExtendedDocument
  use_database settings.db

  property :title
  timestamps!
  view_by :title
end

get '/' do
  @db = settings.db
  haml :index
end

patina.rb
@db
patina.rb
Article.rb
