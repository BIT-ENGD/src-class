class Profile < ActiveRecord::Base
  belongs_to :user  
  has_attached_file :avatar, :styles => { :medium => "134x137>", :thumb => "111x111>", :tiny => "32x38>" }
  validates_attachment_content_type :avatar, :content_type => ['image/pjpeg','image/jpeg', 'image/x-png', 'image/png', 'image/gif']


class User < ActiveRecord::Base
  has_one :profile, :dependent => :destroy

def edit
  @user = User.find(params[:id])
  @profile = @user.profile
end

<% form_for @user do |f| %>
 <%= f.text_field :first_name %>
 <%= f.text_field :last_name %>
 <%= f.text_field :email %>
 <%= f.password_field :password %>
 <%= f.password_field :password_confirmation %>
<input id="send_update" name="send" type="submit" value="Update" />
<% end %>


<% form_for @profile , :html => { :multipart => true } do |f| %>
<%= render :partial => 'form', :locals => {:f => f, :profile => @profile, :title => 'Edit Profile'} %>
<%= submit_tag 'Update', :style => 'text_align:right'%>
<% end %>

<label>Upload Avatar</label>
<tr><%= f.file_field :avatar %></tr>

def update
  @user = User.find(params[:id])    
  current_email = @user.email
if @user.update_attributes(params[:user])
  UserMailer.deliver_email_changed (@user) if email_changed?(current_email, @user.email)
  flash[:notice] = "<h1>Account updated!</h1>"
  redirect_to edit_user_path(@user)
else
  flash.now[:error] = "Sorry, something went wrong"
  render :action => :edit
end
end

