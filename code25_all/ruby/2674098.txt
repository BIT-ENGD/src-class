class Book
  has_and_belongs_to_many :authors
end

class Author
  has_and_belongs_to_many :books
end

validates_length_of :first_name, :maximum => 255, :allow_blank => true, :allow_nil => false

@book = Book.new(params[:book])
@book.authors.build(params[:book][:authors].values)

validate :must_have_some_data

def must_have_some_data
  empty = true
  hash = self.attributes
  hash.delete("created_at")
  hash.delete("updated_at")
  hash.each_value do |value|
    empty = false if value.present?
  end

  if (empty)
    errors.add_to_base("Fields do not contain any data.")
  end
end

