Class Classroom

  has_many :registrations

  has_many :students, :through => :registrations, :uniq => true do
    def in_group(a_group)
      if a_driver
        scoped(:conditions => ['registrations.group_id = ?', a_group])
      else
        in_no_group
      end
    end

    def in_no_group
      scoped(:conditions => 'registrations.group_id is null')
    end
  end

end

classroom.students.in_group(honor_students)

classroom.students.in_group(honor_students)
ActiveRecord::StatementInvalid: Mysql::Error: Unknown column 'registrations.group_id' in 'where clause': SELECT * FROM `students` WHERE (registrations.group_id = 1234)

SELECT DISTINCT `students`.* FROM `students` INNER JOIN `registrations` ON `students`.id = `registrations`.student_id WHERE ((`registrations`.classroom_id = 9876))

