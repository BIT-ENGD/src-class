cars = Car.all.group_by(&:color)

cars
cars.inject([]) do |stack, (color, cars)|
  stack << cars.each do |car|
   ...
  end
end

