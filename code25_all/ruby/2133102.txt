def deploy
  # some stuff happens here
end

def do_deploy
   $deploy.kill! if $deploy
   $deploy = Thread.new { deploy }
   $deploy.join  # when I don't have the join here, it stop executing the deploy
                 # like after first when thread switches to something else, and
                 # then never finishes
end

reading = Thread.new do
  while line = gets.chomp!
    case line
    when "q" then
      puts "exiting"
      Thread.exit
      exit
    when "r" then
      do_deploy
    end
  end
end

reading.join

$deploy.join
fork()
gets
t1 = Thread.new { 10.times { |i| puts i } }
t2 = Thread.new { puts gets }
t1.join
t2.join

gets
