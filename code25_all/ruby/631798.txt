class MyServer < GServer
  def initialize(port=20607, host=GServer::DEFAULT_HOST)
    super(port, host, Float::MAX, $stderr, true)
  end

  def serve(sock)
    begin
      @clients << sock
      stock.accept
      message = sock.gets.chomp
      puts "message: " << message
      this.stop if message == "#quitserver"
      # TODO: code that process commmands comes here
    rescue

    ensure
      @clients.delete(sock)
    end
  end
end

require 'socket'
streamSock = TCPSocket.new( "127.0.0.1", 20607 )
puts "Socket created..." unless streamSock.nil?
sleep 5
streamSock.puts "hello world"
sleep 5
streamSock.close
puts "Socket closed."

