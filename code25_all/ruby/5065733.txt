require 'uri'
uri = URI.parse 'http://example.com'

path = URI.escape('/?foo[123]=5')
uri.merge!(path)

URI::InvalidURIError: bad URI(is not URI?): /?foo[123]=5

path = URI.escape(URI.escape('/?foo[123]=5'), '[]')
uri.merge!(path)

