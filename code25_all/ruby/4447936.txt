def test_transaction
  ActiveRecord::Base.connection.execute("create table if not exists t(name varchar(100))")
  ActiveRecord::Base.connection.uncached do
  begin
    ActiveRecord::Base.transaction do
      ActiveRecord::Base.connection.execute("insert into t values('one')")
      ActiveRecord::Base.connection.execute("insert into t values('two')")
      ActiveRecord::Base.connection.execute("insert into t values('three')")
      ActiveRecord::Base.connection.execute("insert into t values('four')")
      result = ActiveRecord::Base.connection.select_all("select count(*) as total from t")[0]['total'].to_i
      assert_equal(0, result)
    end
  ensure
    ActiveRecord::Base.connection.execute("drop table if exists t")
  end
end
end

