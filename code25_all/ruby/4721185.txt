Player = Player.create(:name => "Toby")
game.player << player 

player.pieces << Piece.create(:name => "Rook")

# works fine 
logger.debug(player.to_hash.to_json)

# FAILS with the above error
logger.debug(game.to_hash.to_json)    

class Game < Ohm::Model
  collection :player, Player  

  def to_hash
    super.merge(:players => players)
  end
end


class Player < Ohm::Model
  reference :game, Game
  collection :pieces, Piece

  attribute :name  

  def to_hash
    super.merge(:name => name, :pieces => pieces)
  end
end


class Piece < Ohm::Model
  reference :player, Player

  def to_hash
    super.merge(:name => name)
  end    
end

