ssl_requirement
def ensure_proper_protocol
  return true if ssl_allowed?
  if ssl_required? && !request.ssl?
    redirect_to "https://#{@account.subdomain}." + APP_CONF[:domain] + request.request_uri
    flash.keep
    return false
  elsif request.ssl? && !ssl_required?
    redirect_to "http://#{@account.sub_or_mapped_domain}" + request.request_uri
    flash.keep
    return false
  end
end

ssl_required?
protected
def ssl_required?
  return false if RAILS_ENV == "test" || RAILS_ENV == "development"
  true
end

