Please write your answer in the following textbox: [...]

Please write your answer in the following textarea:
...So here, on line, you should write one thing.
...Here, on line 2, you should write another.
...
...
...

[...]
...
new
edit
new
edit
class Staff::PlannersController < StaffController

  make_resourceful do
    actions :all

    before :create do
      find_planner_format
      if @planner_format
        current_object.body = fields_in_template @planner_format.body
      else
        flash[:error] = 'Planner format not found!'
        redirect_to staff_planners_path
      end
      current_object.user = @current_user
    end

    before :update do
      current_object.body = fields_in_template(current_object.body)
    end
  end

private

  def fields_in_template(template)
    fields = params[:fields] || {}
    if fields[:inline]
      template.gsub! /\[\.\.\..*\]/ do
        "[...#{fields[:inline].shift}]"
      end
    end
    if fields[:block]
      template.gsub! /^\.{3}.*(\n\.{3}.*)*$/ do
        fields[:block].shift.split("\n").collect { |line|
          "...#{line}"
        }.join("\n")
      end
    end
    current_object.body = template
  end

end

update
before :update
before :update do
  current_object.body = 'test string'
end

before :update do
  current_object.body = fields_in_template(current_object.body) + 'a'
end

update
reload
before :update do
  new_body = fields_in_template(current_object.body) + 'a'
  new_body.slice! -1
  current_object.body = new_body
end

UPDATE
body
