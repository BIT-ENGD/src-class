class Message
  include Mongoid::Document
  include Mongoid::Timestamps
  include Mongoid::Paranoia 

  field :subject
  field :body
  field :sender_deleted, :type => Boolean, :default => false
  field :recipient_deleted, :type => Boolean, :default => false
  field :read_at, :type => DateTime

  referenced_in :sender, :class_name => "User", :inverse_of => :sender, :foreign_key => 'sender_id'
  referenced_in :recipient, :class_name => "User", :inverse_of => :recipient, :foreign_key => 'recipient_id'

  embeds_many :replies, :class_name => 'Message'
  embedded_in :message, :inverse_of => :replies

  embeds_many :replies, :class_name => 'Message'
  embedded_in :message, :inverse_of => :replies

