CMS.ShopOrder order = new CMS.ShopOrder();

    order.CreatedOn = DateTime.Now;

    foreach (var item in CMS.CurrentSession.Cart.Items)
    {           
        order.ShopOrderItems.Add(item);
    }

    db.AddToShopOrder(order);       

    int selT = FormatHelper.GetInt32(ddTransport.SelectedValue);
    int selP = FormatHelper.GetInt32(ddTransport.SelectedValue);    

    order.Transportation = db.Transportation.Where(t => t.Id == selT).FirstOrDefault();
    order.Payment = db.Payment.Where(p => p.Id == selP).FirstOrDefault();
    order.Customer = db.Customer.Where(c=>c.Id == CMS.CurrentSession.Customer.Id).FirstOrDefault();

    db.SaveChanges();

