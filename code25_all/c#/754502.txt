ListBox
ListBox
ListBox
ListBox
ListBox.OnDrawItem
ListBox
OnDrawItem
ListBox
public partial class EventListBox : ListBox
{
    private Button _importButton;

    public EventListBox()
    {
        InitializeComponent();
        this.DrawMode = DrawMode.OwnerDrawVariable;

    // set up the button that will appear next to the currently-selected item
        _importButton = new Button();
        _importButton.Text = "Import...";
        _importButton.AutoSize = true;
        _importButton.Visible = false;

    // Add the button as a child control of this ListBox
        Controls.Add(_importButton);
    }


    protected override void OnDrawItem(DrawItemEventArgs e)
    {
        if (this.Items.Count > 0)
        {
            e.DrawBackground();

    // draw item here (omitted)

    // if drawing the selected item, re-position the "Import" button so that appears
    // inside the current item, and make it visible if it is hidden.
    // These checks prevent the resulting repaint that will occur from causing an infinite loop

    // The problem seems to be that if the ListBox is scrolled such that the selected item
    // moves off-screen , this code won't run, because it won't repaint the selected item anymore...
    // This means the button will be painted in its previous position.

    // The real question is: Is there a better way to approach the whole notion of
    // rendering buttons within ListBox items?

            if (e.State & DrawItemState.Selected == DrawItemState.Selected)
            {
                _importButton.Top = e.Bounds.Bottom - _importButton.Height - 20;
                _importButton.Left = e.Bounds.Left;
                if(!_importButton.Visible) _importButton.Visible = true;
            }
        }

        base.OnDrawItem(e);
    }

    protected override void OnMeasureItem(MeasureItemEventArgs e)
    {
        base.OnMeasureItem(e);
        e.ItemHeight = 100; //hard-coded for now...
    }

}

ListBox
ListBox
ListBox.Items
ListBox.Items
ListBox
AddItem
RemoveItem
ListBox
RemoveItem
ListBox.Items
OnDrawItem
System.Windows.Forms.ButtonRenderer
ButtonRenderer
OnDrawItem
Dictionary<Item, Button>
ListBox
ListBox
ListBox
ListBox
