if (Authenticate)
{

    NetworkStream clientStream = new NetworkStream(webSocket, false);
    NegotiateStream authStream = new NegotiateStream(clientStream);

    NetworkCredential netcred = CredentialCache.DefaultNetworkCredentials;


    try
    {
        authStream.AuthenticateAsClient(netcred,
            String.Empty,
            ProtectionLevel.None,
            TokenImpersonationLevel.Identification);

        if (!authStream.IsAuthenticated)
        {
            Console.WriteLine("Authentication failed");
            ErrorText = "Authentication using default credentials failed";
            return (HttpStatusCode)(-1);
        }
    }
    catch (Exception ex)
    {
        Console.WriteLine(ex.Message);
        ErrorText = ex.Message;
        return (HttpStatusCode)(-1);
    }
}

