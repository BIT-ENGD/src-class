using System;
using System.Runtime.Serialization;
using System.Windows.Forms;

namespace MySample
{
    [DataContract(IsReference = true)]
    class SerializeAndBind : IExtensibleDataObject
    {
        [DataMember]
        private String bindedControlName;
        [DataMember]
        private String bindedPropertyName;

        private DateTime creationTime;

        [System.ComponentModel.Browsable(false)]
        public virtual ExtensionDataObject ExtensionData { get; set; }

        public event EventHandler CreationTimeChanged;

        public SerializeAndBind()
        {
            CreationTime = DateTime.Now;
        }

        public SerializeAndBind(Control ControlName, String PropertyName)
            : this()
        {
            InitializeDataBinding(ControlName, PropertyName);
        }

        [DataMember]
        public DateTime CreationTime
        {
            get
            {
                return creationTime;
            }
            set
            {
                creationTime = value;

                if (CreationTimeChanged != null)
                    CreationTimeChanged(this, EventArgs.Empty);
            }
        }

        public override string ToString()
        {
            return CreationTime.ToString();
        }

        [OnDeserialized]
        private void InitializeDataBindingAfterDeserialization(StreamingContext ctx)
        {
            if (bindedControlName != null)
            {
                Control control;

                control = FindControlByName(bindedControlName);

                if(control != null)
                    InitializeDataBinding(control, bindedPropertyName);
            }
        }

        private void InitializeDataBinding(Control ControlName, string PropertyName)
        {
            BindingSource bindingSource = new BindingSource();
            bindingSource.DataSource = this;
            Binding binding = new Binding(PropertyName, bindingSource, "CreationTime", true, DataSourceUpdateMode.OnPropertyChanged);
            binding.Format += new ConvertEventHandler(OnFormat);
            ControlName.DataBindings.Add(binding);

            bindedControlName = ControlName.Name;
            bindedPropertyName = PropertyName;
        }

        private void OnFormat(object sender, ConvertEventArgs e)
        {
            if (e.DesiredType == typeof(String))
            {
                e.Value = this.ToString();
            }
        }
    }
}

FindControlByName()
