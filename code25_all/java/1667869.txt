DataHandler
DataHandler
XmlAttachmentRef
public class DataHandlerAttachmentSerialization {

    @XmlRootElement
    static class RootObject {
        @XmlElement
        @XmlAttachmentRef // Works without this, but required for streaming 
        DataHandler dataHandler = new DataHandler(
                new com.sun.xml.ws.util.ByteArrayDataSource(
                " ".getBytes(), "application/octet-stream"));
    }

    @Test
    public void test() throws JAXBException {
        JAXBContext context = JAXBContext.newInstance(RootObject.class);
        Marshaller marshaller = context.createMarshaller();
        StringWriter writer = new StringWriter();
        marshaller.marshal(new RootObject(), writer);
        Assert.assertNotNull(writer.toString());
    }
}

javax.xml.bind.MarshalException
 - with linked exception:
[com.sun.xml.bind.api.AccessorException: java.lang.NullPointerException]
    at com.sun.xml.bind.v2.runtime.MarshallerImpl.write(MarshallerImpl.java:318)
    at com.sun.xml.bind.v2.runtime.MarshallerImpl.marshal(MarshallerImpl.java:244)
    at javax.xml.bind.helpers.AbstractMarshallerImpl.marshal(AbstractMarshallerImpl.java:96)
    ...
Caused by: com.sun.xml.bind.api.AccessorException: java.lang.NullPointerException
    at com.sun.xml.bind.v2.runtime.XMLSerializer.reportError(XMLSerializer.java:246)
    at com.sun.xml.bind.v2.runtime.XMLSerializer.reportError(XMLSerializer.java:261)
    at com.sun.xml.bind.v2.runtime.ClassBeanInfoImpl.serializeBody(ClassBeanInfoImpl.java:335)
    at com.sun.xml.bind.v2.runtime.XMLSerializer.childAsSoleContent(XMLSerializer.java:593)
    at com.sun.xml.bind.v2.runtime.ClassBeanInfoImpl.serializeRoot(ClassBeanInfoImpl.java:320)
    at com.sun.xml.bind.v2.runtime.XMLSerializer.childAsRoot(XMLSerializer.java:494)
    at com.sun.xml.bind.v2.runtime.MarshallerImpl.write(MarshallerImpl.java:315)
    ... 25 more
Caused by: com.sun.xml.bind.api.AccessorException: java.lang.NullPointerException
    at com.sun.xml.bind.v2.runtime.reflect.AdaptedAccessor.get(AdaptedAccessor.java:74)
    at com.sun.xml.bind.v2.runtime.reflect.TransducedAccessor$CompositeTransducedAccessorImpl.writeLeafElement(TransducedAccessor.java:250)
    at com.sun.xml.bind.v2.runtime.property.SingleElementLeafProperty.serializeBody(SingleElementLeafProperty.java:98)
    at com.sun.xml.bind.v2.runtime.ClassBeanInfoImpl.serializeBody(ClassBeanInfoImpl.java:332)
    ... 29 more
Caused by: java.lang.NullPointerException
    at com.sun.xml.bind.v2.runtime.SwaRefAdapter.marshal(SwaRefAdapter.java:80)
    at com.sun.xml.bind.v2.runtime.SwaRefAdapter.marshal(SwaRefAdapter.java:65)
    at com.sun.xml.bind.v2.runtime.reflect.AdaptedAccessor.get(AdaptedAccessor.java:72)
    ... 32 more

SwaRefAdapter
return am.addSwaRefAttachment(data);
am
AttachmentMarshaller am = XMLSerializer.getInstance().attachmentMarshaller;
attachmentMarshaller
@XmlAttachmentRef
