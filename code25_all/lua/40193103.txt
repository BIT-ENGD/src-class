frontend RTMP
bind 0.0.0.0:1935
mode tcp
use_backend %[lua.choose_backend("d")]

backend a
    balance roundrobin
    mode tcp
    server origin_1 192.168.1.19:1935 check fall 3 rise 2

backend b
    balance roundrobin
    mode tcp
    server origin_1 192.168.1.20:1935 check fall 3 rise 2

function my_hash(txn, salt)

local str = ""
str = "HOST: " .. txn.sf:req_fhdr("host")
str = str .. " PATH: "
str = str .. txn.sf:path()
str = str .. " SRC: "
str = str .. txn.sf:src()

core.log(core.info, str)
   return 'a'
end

core.register_fetches("choose_backend", my_hash)

