getstatus = function()
        require("processinfo")
        local value,errtxt=processinfo.package_version(packagename)
        etc...

139: attempt to index global 'string' (a nil value)

while string.find(result, "%$[%w_]+") do
    -- do something
end

