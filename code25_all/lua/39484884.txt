local json = require( "json" )
local function handleResponse( event )
    if not event.isError then

        local data,pos,msg= json.decode(event.response)
        print( event.response )

        if not data then
            native.showAlert('error, no response', 'no response from the server', {'OK'})
        else
            if data.checked_in == "0" then
                myText.text = "Not checked in yet.\nVehicle Detail:\nReg#\n"..data.registration.."\nMake:\n"..data.make.."\nModel:\n"..data.model.."\n"
                urx2 = "http://mydomain/index.php/checkin/"..message
                network.request( urx2, "GET", handleResponse2 )
                print('Scanned message:', message)
            else
                myText.text = "WARNING: Vehicle already checked in.\nVehicle Detail:\nReg#\n"..data.registration.."\nMake:\n"..data.make.."\nModel:\n"..data.model.."\n"
            end
        end
    else
        native.showAlert('Darn: this url is broken: '..urx, message, {'OK'})
    end
    return true
end

local function handleResponse2( event )
    if not event.isError then

        local data,pos,msg= json.decode(event.response)
        print( event.response )

        if not data then
            native.showAlert('error, no response', {'OK'})
        else
            if data.checked_in == "0" then
                myText.text = "Still not checked in, try again."
            else
                myText.text = "Successfully checked in."
            end
            sceneGroup:insert( summary )
            print(data.checked_in)
        end
    end
    return true
end

local function status_listener(message)
    urx = "http://mydomainindex.php/checkedin/"..message
    network.request( urx, "GET", handleResponse )
end

local function checkin_listener(message)
    urx = "http://mydomain/index.php/checkin/"..message
    network.request( urx, "GET", handleResponse2 )
    print('Scanned message:', message)
end

                if data.checked_in == "0" then
                myText.text = "Not checked in yet.\nVehicle Detail:\nReg#\n"..data.registration.."\nMake:\n"..data.make.."\nModel:\n"..data.model.."\n"
                urx2 = "http://mydomain/index.php/checkin/"..message
                network.request( urx2, "GET", handleResponse2 )
                print('Scanned message:', message)

