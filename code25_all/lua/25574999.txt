require "pubnub"

multiplayer = pubnub.new({
    publish_key   = "my_publish_key",
    subscribe_key = "my_subscribe_key",
    secret_key    = nil,
    ssl           = nil,
    origin        = "pubsub.pubnub.com"
})

multiplayer:subscribe({
    channel  = "hello-world-corona",
    callback = function(message)
      print(message.msgtext)
    end,
    errorback = function()
      print("Oh no!!! Dropped 3G Conection!")
    end
})

function send_a_message(text)
  multiplayer:publish({
     channel = "hello-world-corona",
     message = { msgtext = text }
   })
end

function send_hello_world()
  send_a_message("Hello World!!!")
end

timer.performWithDelay( 500, send_hello_world, 10 )
send_hello_world()

   settings =
{ 
android =
   {
    permissions =
        {
            { name = ".permission.C2D_MESSAGE", protectionLevel = "signature" },
        },
        usesPermissions =
        {
           -- Required by the MapView to fetch its contents from the Google Maps 
           --servers.
            "android.permission.INTERNET",
            "android.permission.GET_ACCOUNTS",
            "android.permission.RECEIVE_BOOT_COMPLETED",
            "com.google.android.c2dm.permission.RECEIVE",
            ".permission.C2D_MESSAGE",


          -- Optional permission used to display current location via the GPS.
            "android.permission.ACCESS_FINE_LOCATION",

          -- Optional permission used to display current location via WiFi or 
          -- cellular   
          -- service.
          "android.permission.ACCESS_COARSE_LOCATION",
      },
      usesFeatures =
      {
          -- If you set permissions "ACCESS_FINE_LOCATION" and 
          --"ACCESS_COARSE_LOCATION" above, then you may want to set up 
          --your app to not require location services as follows.
          -- Otherwise, devices that do not have location sevices (such as a GPS) will 
          -- be unable
          -- to purchase this app in the app store.
            { name = "android.hardware.location", required = false },
            { name = "android.hardware.location.gps", required = false },
            { name = "android.hardware.location.network", required = false },
        },
   }, 
}

