local str = "This is some >>1234 text. This is some >>>/other/1234 text."

local pattern1 = ">>(%d+)"
local pattern2 = ">>>/(%w+)/(%d*)"

%d
local formatted = "This is some <a href='website.com/a/1220#1234'>>>1234</a> text. This is some <a href='website.com/other/1156#1234'>>>>/other/1234</a> text."

Error

attempt to yield across C-call boundary
Traceback

stack traceback:
    [C]: in function 'receive'
    /home/karai/.luarocks/share/lua/5.1/pgmoon/init.lua:419: in function 'receive_message'
    /home/karai/.luarocks/share/lua/5.1/pgmoon/init.lua:233: in function 'query'
    /usr/share/lua/5.1/lapis/db/postgres.lua:64: in function 'select'
    ./src/text_formatter.lua:39: in function <./src/text_formatter.lua:24>
    [C]: in function 'gsub'
    ./src/text_formatter.lua:55: in function 'quote'
    ./src/board.lua:58: in function 'handler'
    /usr/share/lua/5.1/lapis/application.lua:399: in function 'resolve'
    /usr/share/lua/5.1/lapis/application.lua:408: in function </usr/share/lua/5.1/lapis/application.lua:406>
    [C]: in function 'xpcall'
    /usr/share/lua/5.1/lapis/application.lua:406: in function 'dispatch'
    /usr/share/lua/5.1/lapis/nginx.lua:205: in function 'serve'
    content_by_lua(nginx.conf.compiled:27):2: in function <content_by_lua(nginx.conf.compiled:27):1>

