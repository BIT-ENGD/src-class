local append_column = function (filename, varname, data) 
-- assumes every column has the same number of values    
-- data is zero indexed! 

  if data==nil  then   
    do return end
  end 
  newfile = assert(io.open("temp.txt", "w"))
  count=0 
  for line in io.lines(filename) do               
    newfile:write(line)    
    if count==0 then
      newfile:write(varname, "\t")              
    elseif data[count-1] == nil then     
      newfile:write("\t")                 
    else      
      newfile:write(data[count-1], "\t")      
    end    
    newfile:write("\n")
    count = count + 1    
  end
  assert(newfile:close())
  copy_file("temp.txt", filename)
  os.remove("temp.txt")
end

f:read(BUFSIZE, "*line")

