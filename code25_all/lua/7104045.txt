#!/usr/bin/env wsapi.cgi

require("lib/request")  -- wsapi lib
require("lib/response")
require("io")
module("loadHtml", package.seeall)

---This function generates a response for the WSAPI calls that need to GET a file
function run(wsapi_env)
    --check the request
    local req = wsapi.request.new(wsapi_env or {})
    --generate response
    res = wsapi.response.new()
    ---a couple of utility functions that will be used to write something to response
    function print(str) res:write(str) end
    function println(str) res:write(str) res:write('<br/>') end

    println("running...")
    ff=dofile("index.html.lua")
    println("done!")

    return res:finish()
end

return _M

print([[<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Untitled Document</title>
</head>
<body>
Hello world!
</html>]])

running...<br/>done!<br/>

--tryDoFileRun.lua:
function e()
    function p(str)
        print(str)
    end
    dofile("tryDoFile.lua")
end
e()

--tryDoFile.lua
print("in tryDoFile.lua")
p("calling p")

in tryDoFile.lua
calling p

