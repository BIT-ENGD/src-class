fsctimeout = 0.01

function send_data(sock, data, i, l)
    local p,err,q = sock:send(data, i, l)
    if(err == "timeout" and q ~= l) then
        fsctimeout = fsctimeout * 2
        sock:settimeout(fsctimeout)
        send_data(sock, data, q + 1, l)
        fsctimeout = fsctimeout / 2
        sock:settimeout(fsctimeout)
    end
end

while not e do

rect, _, st = socket.select({csc, fsc}, nil, .01) --csc is S1, fsc is S2 sockets.

    if(rect[fsc] ~= nil and csc ~= nil) then
        local data, err, part = fsc:receive(8192)
        if(data ~= nil) then
            send_data(csc, data, 1, data:len())
            totalBytesFromFP = totalBytesFromFP + data:len()
        end
        if(part ~= nil) then
            send_data(csc, part, 1, part:len())
            totalBytesFromFP = totalBytesFromFP + part:len()
        end
    end
 end

send_data
send_data
