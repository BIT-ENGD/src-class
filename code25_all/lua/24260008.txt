IMAP host and port: example.com:143
My E-Mail: doesnotexist@example.com
The password: notsaying

require 'luarocks.require'

local imap4 = require 'imap4'

local username = "doesnotexist@example.com"
local password = "notsaying"

local connection = imap4('example.com', 143)

print(table.concat(connection:capability(), ', '))
assert(connection:isCapable('IMAP4rev1'))

connection:login(username, password)

for mb, info in pairs(connection:lsub()) do
    local stat = connection:status(mb, {'MESSAGES', 'RECENT', 'UNSEEN'})
    print(mb, stat.MESSAGES, stat.RECENT, stat.UNSEEN)
end

local info = connection:examine('INBOX')
print(info.exist, info.recent)

for _,v in pairs(connection:fetch('UID BODY.PEEK[HEADER.FIELDS (From Date Subject)]', (info.exist-3)..':*')) do
    print(v.id, v.UID, v.BODY.value)
end

connection:logout()

IMAP4rev1, CHILDREN, NAMESPACE
INBOX.Sent  3   0   0
INBOX   4   0   0
4   0
lua: example.lua:24: attempt to index field 'BODY' (a nil value)
stack traceback:
    example.lua:24: in main chunk
    [C]: ?

