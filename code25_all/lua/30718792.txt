local socket = require "socket"

-- begin
local udp = socket.udp()
udp:settimeout(1)
udp:setsockname('*', 12345)
local data, msg_or_ip, port_or_nil
local cmd, parms
local running = true
print "Beginning server loop."
while running do
    data, msg_or_ip, port_or_nil = udp:receivefrom()
    if data then
        print(data,msg_or_ip,port_or_nil)
        udp:sendto(data,msg_or_ip,port_or_nil)
    elseif msg_or_ip ~= 'timeout' then
        print("Unknown network error: "..tostring(msg))
    end

    socket.sleep(0.01)
end

local socket = require "socket"
local address, port = "192.168.137.161", 12345
udp = socket.udp()
udp:settimeout(1)
while true do
    udp:setpeername(address, port)
    udp:send(io.read())
    udp:close()
    --udp:setsockname("*",12345)
    data, msg_or_ip, port_or_nil = udp:receivefrom()
    print(data, msg_or_ip, port_or_nil)
    udp:close()
end

nil    refused nil
