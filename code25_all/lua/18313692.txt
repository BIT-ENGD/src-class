p = {};
for i = 0, 1000 do
    p[ i ] = {};
end

t = {}
t.__index = t

function new()
    local o = setmetatable({}, t)


    for key, value in pairs( p[1] ) do
        print(key .. " : " .. value)
        o[ key ] = value
    end

    t.__newindex = function(t, key, value)
        if type(value) ~= "function" then
          p[1][key] = value
        end
    end


    return o
end

local something = new()

something.xxx = 666
print(p[1].xxx)

local something = new()
print(something.xxx)
print(p[1].xxx)

for key, value in pairs( p[1] ) do
    print(key .. " : " .. value)
    o[ key ] = value
end

666
xxx : 666
nil
666

