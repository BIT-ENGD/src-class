local pin = 3
local addr = '29-example'
local DS2408_CHANNEL_WRITE_CMD   = 0x5A

function set_state(state)
    ow.setup(pin)

    if (ow.reset(pin) == 1) then
        ow.select(pin, addr)
        ow.write(pin, DS2408_CHANNEL_WRITE_CMD, 1)
        ow.write(pin, state, 1)
        ow.write(pin, bit.bnot(state), 1)

        if (ow.read(pin) == 0xAA) then
            if (ow.read(pin) == state) then
                return true
            end
        end
    else
        return false
    end
end

print(set_state(0x02))

