int _tmain(int argc, _TCHAR* argv[])
{
    std::string script = "";
    lua_State* L = luaL_newstate();
    luaL_openlibs(L);
    luaL_loadstring(L, script.c_str());
    lua_pcall(L, 0, LUA_MULTRET, 0);

    while (true)
    {
        lua_getglobal(L, "TestFunc");
        lua_pcall(L, 0, 0, 0);
    }

    return 0;
}

while (true)
{
    lua_getglobal(L, "TestFunc");
    if (lua_pcall(L, 0, 0, 0))
        lua_pop(L, -1);
}

