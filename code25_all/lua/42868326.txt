local coX = {0,2,2,0}
local coY = {0,0,2,0}
local xmax = 2
local ymax = 2

-- Matriz de coordenadas para función "on.paint(gc)"
function conCoor(x,y)
    local nx = x
    for i=1, #x do
        table.insert(nx,i*2,y[i])       
    end
    return nx
end

-- Valor absoluto
function math.abs(valor)
    if valor < 0 then
        valor = valor*(-1)
    end
    return valor
end

-- Inercia del polígono respecto el eje X
function inerciex(x,y)
    local E = 0
    local z =0
    for i = 1, #x-1 do
        E = (x[i+1]-x[i])*(y[i+1]+y[i])*((y[i+1])^2+(y[i])^2)
        z = E + z
    end
    return math.abs(z/12)
end

-- Inercia del polígono respecto el eje Y
function inerciey(x,y)
    local E = 0
    local z =0
    for i = 1, #x-1 do
        E = (y[i+1]-y[i])*(x[i+1]+x[i])*((x[i+1])^2+(x[i])^2)
        z = E + z
    end
    return math.abs(z/12)
end

-- Área del poligono
function area(x,y)
    local A = 0
    local z = 0
    for i = 1, #x-1 do
        A = (y[i]*x[i+1]-x[i]*y[i+1])
        z = A + z
    end -- Line 52, the line in question
    return math.abs(z/2)
end

-- Centro de masa del polígono (eje x)
function centroix(x,y)
    local Ac = area(x,y)
    local z = 0
    local cx = 0
    for i = 1, #x-1 do
        cx = (x[i]+x[i+1])*(x[i]*y[i+1]-x[i+1]*y[i])
        z = cx + z
    end
    return z/(6*Ac)
end

-- Centro de masa del polígono (eje y)
function centroiy(x,y)
    local Ac = area(x,y)
    local z = 0
    local cx = 0
    for i = 1, #x-1 do
        cx = (y[i]+y[i+1])*(x[i]*y[i+1]-x[i+1]*y[i])
        z = cx + z
    end
    return z/(6*Ac)
end

-- Escala de figura
function escala(xmax,ymax)
    local sc = 0
    if xmax > ymax then
        sc = 81/xmax
    else
        sc = 81/ymax
    end
    return math.floor(sc)
end

-- Coordenadas del origen en pantalla
function oriDispX(x,y,xmax,ymax)
    return math.floor(212 + (-1)*centroix(x,y)*escala(xmax,ymax))
end

function oriDispY(x,y,xmax,ymax)
    return math.floor(105 + (-1)*centroiy(x,y)*escala(xmax,ymax))
end

-- Cambio de coordenadas real
function coorCamb(x,y,xmax,ymax)
    -- Escalado de coordenadas
    local escx = x
    local escy = y
    local orix = oriDispX(escx,escy,xmax,ymax)
    local oriy = oriDispY(escx,escy,xmax,ymax)
    for i = 1, #escx do
        escx[i] = math.floor(escx[i]*escala(xmax,ymax))
        escy[i] = math.floor(escy[i]*escala(xmax,ymax))
    end
    -- Cambio de coordenadas
    for i = 1, #escx do
        escx[i] = escx[i] + orix
        escy[i] = escy[i] + oriy
    end
    return conCoor(escx,escy)
end

function on.paint(gc)
    local ox = oriDispX(coX,coY,xmax,ymax)
    local oy = oriDispY(coX,coY,xmax,ymax)
    local c = coorCamb(coX,coY,xmax,ymax)
    gc:drawPolyLine(c)
    gc:drawLine(ox-3,oy,ox+3,oy)
    gc:drawLine(ox,oy-3,ox,oy+3)
    gc:fillArc(ox-1,oy-1,2,2,0,360)
    gc:fillArc(212-1,105-1,2,2,0,360)
    gc:drawString(tostring(area(coX,coY)),10,10)
    platform.window:invalidate()
end

function area(x,y)
    local A = 0
    local z = 0
    for i = 1, #x-1 do
        A = (y[i]*x[i+1]-x[i]*y[i+1])
        z = A + z
    end -- Line 52, the line in question
    return math.abs(z/2)
end

