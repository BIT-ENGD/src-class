function connect_to_mqtt_broker()


    print("Connecting to broker...")
    m:connect(BROKER, PORT, 0, 1, function(client) 
                                    print("connected") 
                                    print("["..tmr.time().."(s)] - Client connected to broker: "..BROKER)
                                    m:subscribe(SUB_TOPIC,0, function(conn) 
                                        print("Subscribed to "..SUB_TOPIC.." topic")
                                        led(0,204,0,150) 
                                    end)
                                    m:publish(PUB_TOPIC,"Hello from: "..node.chipid()..RESTART_REASON,0,0, function(conn) 
                                        print("sent")
                                    end)
                                  end, 
                                  function(client, reason) 
                                    print("failed reason: "..reason)
                                  end)

end

---MQTT client---
print("--------------> Create mqtt clinet")
--set up MQTT client
-- init mqtt client with keepalive timer 120sec
m = mqtt.Client("ESP"..node.chipid(), KEEP_ALIVE_TMR, USER, PASSWORD)
m:lwt(PUB_TOPIC, "offline", 0, 0)
m:on("offline", function(conn) 
        print("["..tmr.time().."(s)] - Mqtt client gone offline")

end)
m:on("message", function(conn, topic, data) 
        --receive_data(data, topic)
        print("Data received: "..data) 
        led(200,50,50,30)
        receive_data(data, topic)
        led(0,204,0,150)
end)

m:on("offline", function(conn) 
        print("["..tmr.time().."(s)] - Mqtt client gone offline")

end)

