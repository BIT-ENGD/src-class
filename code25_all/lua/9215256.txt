model = { { player = "Cliff", age = 35, gender = "male" }, { player = "Ally", age = 36, gender = "female" }, { player = "Jasmine", age = 13, gender = "female" }, { player = "Lauren", age = 6.5, gender = "female" } }

function allplayers()
    return coroutine.create(function()
        for idx, each in ipairs(model) do
            coroutine.yield(idx, each)
        end
    end)
end

function handlePlayers(source)
    local status, idx, each = coroutine.resume(source)
    while each do
        print(idx, each.player)
        status, idx, each = coroutine.resume(source)
    end
end

function having(source, predicate)
    return coroutine.create(function()
        local status, idx, each = coroutine.resume(source)
        while each do
            if predicate(each)  then
                coroutine.yield(idx, each)
            end
            status, idx, each = coroutine.resume(source)
        end
    end)
end

handlePlayers(having(allplayers(), function(each) return each.age < 30 end))

allplayers(having(function(each) return each.age < 30 end))

allplayers(having({each.age < 30 }))

