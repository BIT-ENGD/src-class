str_resp0 = "HTTP/1.1 200 OK\r\nContent-Type: text/html; charset=UTF-8\r\n";
str_resp1 = "Connection: close\r\n\r\n";

send_buf = "";

uart.on("data", "$",
  function(data)
    t = {send_buf,data}
    send_buf = table.concat(t);

    if data=="quit$" then
      uart.on("data") -- quit the function
    end
end, 0)

srv=net.createServer(net.TCP)
srv:listen(80,function(conn)
  conn:on("receive",function(conn,payload)
    --print(payload)
    conn:send(str_resp0)
    conn:send(str_resp1)
    conn:send(send_buf)
    send_buf = "";
  end)
  conn:on("sent",function(conn) conn:close() 
  end)
end)

