local xPos = math.random(22,279)
local r = math.random(1, #spawnData)

local sd = spawnData[r] -- get the spawn data for this enemy 

local s = display.newSprite(sd.imgSheet, sd.seqData)
s.name = sd.name
physics.addBody(s, {isSensor = true})
s:setSequence(sd.seq)
s:setFrame(sd.frame)
s.y = display.contentHeight - 550 -- Create the enemies using spawnData 

local ok = false -- A flag to say whether we found a valid X position  
local gap = 2     -- Set the minimum gap in pixels between enemies 
local err = 0    -- An error flag to avoid the game slowing down if too many enemies 

while ok == false do -- Tell it to loop until a valid X position is found 
    xPos = math.random(20,300) -- give a new X position 
    ok = true -- Until it has checked against other enemies, assume it is ok for now 

    for i = 1, #enemies, 1 do -- Loop through the previously spawned enemies 
       local e = enemies[i] -- Link to this enemy

       local dist = mAbs(e.x - xPos) -- Work out the distance between this enemy and the random position chosen 
       if dist < (e.width + gap) then ok = false end -- If the enemies are too close, try agian 
    end 

    err = err + 1 -- Increase the count of attempts to find a valid position 
    if err > 50 then ok = true end -- After 50 tries, assume there is no empty space and just spawn wherever
end

s.x = xPos
enemies[#enemies+1] = s

enemyGroup:insert(s)

