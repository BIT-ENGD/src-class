output = {}
done = false

function mainLoop()
  while not done do
    if co == nil then
      co = coroutine.create(subLoop())
    elseif coroutine.status(co) == "suspended" then
      print(output[k])
      coroutine.resume(co)
    elseif coroutine.status(co) == "dead" then
      done = true
    end
  end
end

function subLoop()
  for k=1, 20 do
    table.insert(output, "This is line " .. k .. " of the test output")
    coroutine.yield()
  end
end

mainLoop()

