require 'class'

Session = class(function(self)
    self.session_name = "l_sid"
end)

function Session:init(r)
    self.session_id = r:getcookie(self.session_name)
    if not self.session_id then
        self.session_id = r:sha1(tostring(r.log_id) .. r.clock())
        r:setcookie({
            key =   self.session_name,
            value = self.session_id
        })
    end
end;

local session = require 'session'

function handle(r)
    local s = Session()
    s:init(r)
end

local s = session.Session()
attempt to index upvalue 'session' (a boolean value)
