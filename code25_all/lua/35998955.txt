local luasql = require "luasql.sqlite3"

dbname = "dbname"
table1 = "table1"
table2 = "table2"

env = luasql.sqlite3()
con = env:connect(dbname)

-- Create table1
res1 = con:execute(string.format("CREATE TABLE '%s' (" ..
    "id INTEGER PRIMARY KEY AUTOINCREMENT, " ..
    "test1 varchar(32), " ..
    "test2 varchar(32))", con:escape(table1)))

-- Create table2
res2 = con:execute(string.format("CREATE TABLE '%s' (" ..
    "id INTEGER PRIMARY KEY AUTOINCREMENT, " ..
    "id_of_row_in_table_1 varchar(32), " ..
    "test2 varchar(32))", con:escape(table2)))

-- Insert data into table1
last_inserted_id = con:execute(string.format("INSERT INTO '%s' ('%s', '%s')", con:escape(table1), 'test1', 'test2', con:escape('1'), con:escape('1')))

print(last_inserted_id) -- unfortunately this do not return just inserted id

-- Insert data into table2
res = con:execute(string.format("INSERT INTO '%s' ('%s', '%s')", con:escape(table2), 'last_inserted_id', 'test2', con:escape(last_inserted_id), con:escape('1')))

