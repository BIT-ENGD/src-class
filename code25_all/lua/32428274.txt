gpio.write(3,gpio.LOW)
gpio.mode(3,gpio.OUTPUT)

gpio.write(4,gpio.LOW)
gpio.mode(4,gpio.INT)


time=0
flag=0
i=1

function startDis(level)
    time=tmr.now()
end    

function endDis(level)
    time=tmr.now()-time
    flag=0
end    

function trigger()
    gpio.write(3,gpio.HIGH)
    tmr.delay(10)
    gpio.write(3,gpio.LOW)
    flag=1
end

gpio.trig(4,'up',startDis)
gpio.trig(4,'down',endDis)

while i<10 do
    if flag==0 then
        trigger()
    end
    tmr.delay(1000000)
    print(time)
    i=i+1
end

tmr.alarm(0,2000,1,function()
    print(time)
    print(i)
    if flag==0 then
        trigger()
    end
    i=i+1
    if i==10 then tmr.stop(0) end
end)

0
440184038
1999856
442183990
4000221
444184055
6000175
446184287
7999686

