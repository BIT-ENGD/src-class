local copas = require'copas'

local server = require'websocket'.server.copas.listen
{

  port = 8080,

  protocols = {
    echo = function(ws)
      while true do
        local message = ws:receive()
        if message then
           ws:send(message)
        else
           ws:close()
           return
        end
      end
    end
  }
}

copas.loop()

