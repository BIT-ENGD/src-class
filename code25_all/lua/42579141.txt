allow_anonymous true

listener 8883
cafile /etc/mosquitto/ca.crt
certfile /etc/mosquitto/minibian.crt
keyfile /etc/mosquitto/minibian.key
require_certificate false

dofile("cert.lua")
print (tls.cert.verify([[
-----BEGIN CERTIFICATE-----
cert here
-----END CERTIFICATE-----
]]))

function connect_to_broker()
   print ("Waiting for the broker")
   tls.cert.verify(true)
   m:connect(BROKER, BRPORT, 1, 1,
      function (client)
      print("Connected to MQTT:" .. BROKER .. ":" .. BRPORT .." as " .. CLIENTID )
      end,
   handle_connection_error
)
m:on("offline", handle_broker_offline)
end

[...]

print "Connecting to MQTT broker. Please wait..."
m = mqtt.Client( CLIENTID, MQTT_KEEPALIVE, BRUSER, BRPWD)
connect_to_broker()

1488542161: New connection from 192.168.0.101 on port 8883.
1488542162: OpenSSL Error: error:140940E5:SSL routines:SSL3_READ_BYTES:ssl handshake failure
1488542162: Socket error on client <unknown>, disconnecting.

mosquitto_pub --cafile ca.crt -h 192.168.0.103 -p 8883 -t /test -m message

