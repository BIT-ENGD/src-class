1.lua  2.lua  3.lua 4.lua and so on 

 first folder :   "/const/" 
 second folder:   "/virt/"

17
local virt_path = "/virt/"
local const_path = "/const"
local fs = require "lfs"

local const = {}

for num = 1, (numberoffile)do   -- numberoffile is predfined and can't be change 
    const[num] = assert(
        dofile (const_path .. mkfilename(num)),
        "Failed to load constant  ".. num ..".")
end

local function file_number()  --this is the function that causes me a headach
    local ci, co, num = ipairs(const)
    local vi, vo, _   = fs.dir(virt_path)
    local function vix(o)
        local file = vi(o)
        if file == nil then return nil end
        local number = file:match("^(%d+).lua$")
        if number == nil then return vix(o) end
        return tonumber(number)
    end
    local function iter(o, num)
        return ci(o.co, num) or vix(o.vo, num)
    end
    return iter, {co=co, vo=vo}, num
end

