IGNORE_GLOBALS = "dofile\|string\|tostring\|tonumber\|math\|io\|type\|os\|table\|pairs\|next\|require"

all: $(patsubst src/common/%.lua, %.lua, $(wildcard src/common/*.lua))

%.lua: 
    @echo check $@
    @luac -l src/common/$@  | grep '.ETGLOBAL' | grep -v $(IGNORE_GLOBALS) && $(error Unexpected globals in $@) || echo "No unexpected globals in $@"

Makefile:10: *** Unexpected globals in chat-cmd.lua. Stop.

@echo check $@

@luac -l src/common/$@  | grep '.ETGLOBAL' | grep -v $(IGNORE_GLOBALS) && echo "Unexpected globals in $@" || echo "No unexpected globals in $@"

