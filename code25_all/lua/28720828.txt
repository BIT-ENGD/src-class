    #curl -i -X GET 'http://localhost/widgets/widget?name=testname&loc=20000' -H "Accept:application/json"
    location /widgets/widget {
            default_type "text/pain";
            #ifisEvil... unless done inside lua
            content_by_lua '
                    ngx.say("request is:",ngx.var.request_method)
                    ngx.say("the constant is:",ngx.HTTP_GET)
                    --ngx.say("the type is: ", type(ngx.HTTP_GET)

                    if ngx.var.request_method == ngx.HTTP_GET then
                            local args = ngx.req.get_uri_args()
                            for key, val in pairs(args) do
                                    if type(val) == "table" then
                                            ngx.say(key, ": ", table.concat(val, ", "))
                                    else
                                            ngx.say(key, ": ", val)
                                    end
                            end
                    end
            ';

    }

mytestdevbox2:/var/www/nsps2# curl -i -X GET 'http://localhost/widgets/widget?name=testname&loc=20000' -H "Accept:application/json"
HTTP/1.1 200 OK
Server: nginx/1.6.2
Date: Wed, 25 Feb 2015 13:44:11 GMT
Content-Type: text/pain
Transfer-Encoding: chunked
Connection: keep-alive

request is:GET
the constant is:2
mytestdevbox2:/var/www/nsps2# 

