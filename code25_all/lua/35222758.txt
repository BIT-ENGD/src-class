collectgarbage()
fp = io.open(('predictions/valid_test.txt'), "w")
local soft = nn.SoftMax()
local n = 100

for i = 1, n do
   local t_data = data[{{start_idx, end_idx},{},{},{}}]
   local outputs = model:forward(t_data):float()
   local soft_data = soft:forward(outputs)
   fp:write(fname[i] .. ',' ..  soft_data[1] .. ',' .. '\n')
   xlua.progress(i, n)
end
fp.close()

