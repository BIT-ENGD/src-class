location
access_by_lua_block {
  # proceed as usual if our cookie is not detected
  if ngx.var.cookie_demo ~= nil and string.len(ngx.var.cookie_demo) ~= 32 then
    return
  end
  # proxy and return w/out further processing
  ngx.exec("@ngxbackend")
  return ngx.exit(ngx.HTTP_OK)
}

# proxy upstream
location @ngxbackend {
  include /etc/nginx/proxy_params_demo;
  proxy_pass https://demo-upstreams;
}

