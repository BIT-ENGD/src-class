lookback <- 500
for(i in (lookback+1):nrow(x))
{   
        x.now <- x[(i-lookback):i]        
        x.prcomp <- prcomp(x.now)
        ans[i] <- (some R code on x.prcomp)
}

x
cbind(x,lag(x),lag(x,k=2),lag(x,k=3)...lag(x,k=lookback))
prcomp
apply
Rprof
Rprof
