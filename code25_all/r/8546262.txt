f <- function() {
  parentOnExit(print("B"))
  print("A")
}

foo <- function(r=NULL) {
  if (is.null(r)) {  # If we weren't passed open connection, open one
    r <- openR()
    on.exit(close(r))
  }
  bar(r=r)  # Pass the open connection down
}

r <- openIfNull(r)  # Magically call on.exit(close(r)) in scope of caller

