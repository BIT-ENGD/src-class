scorecard
subset.loans
subset.collateral
loans
collaterals
  LOANS              COLLATERAL           
id | value       id | value   type             
----------       -------------------             
 1     200        1     600      a
 2    4390        1     899      b               
 2     860        2     190      d               
 2    9750        3    4930      e               
 3     600        3     300      a               
 :       :        :       :      :

id | loans             collateral
-----------------------------
 1   c(200)            data.frame(a=c(600,899), b=('a','b'))
 2   c(4390,860,9750)  data.frame(a=c(190), b=c('d'))
 3   c(600)            data.frame(a=c(4930,300), b=c('e','a'))

*apply
plyr
scorecard
for
# An Nx2 data frame of loans (ID, amount)
loans <- read.table(...)

# An Mx4 data frame of collaterals to loans (ID, type, value, lien)
collateral <- read.table(...)

# One person (ID) can have >1 loan and >1 collateral, so first just
# find all unique IDs
loans.ID.unique = unique(loans$ID)

# Run an analysis on each ID grouping:
for(n in 1:length(loans.ID.unique)) {

  # ...all loans for that ID...
  subset.loans      <- loans$loans[
                         which(
                           loans$scorecard_id == loans.ID.unique[n])]

  # ...all collateral for that ID...
  subset.collateral <- collateral[
                         which(
                           collateral$scorecard_id == loans.ID.unique[n]),
                         c('type','value','lien')]

  # Output scores for each ID
  scores[n,1]   <- loans.ID.unique[n]
  scores[n,c(2,3)] <- scorecard(loans=subset.loans,
                                collateral=subset.collateral,
}

