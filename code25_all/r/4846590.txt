ptile <- function(x) {
  p <- (rank(x) - 1)/(length(which(!is.na(x))) - 1)
  p[p > 1] <- NA
  p 
}

data <- c(1, 2, 3, 100, 200, 300)

ptile(data)
[1] 0.0 0.2 0.4 0.6 0.8 1.0

f <- as.factor(c("a", "a", "b", "a", "b", "b"))

0.0 0.5 0.0 1.0 0.5 1.0

tapply(data,f,ptile)

[1] a a b a b b
Levels: a b
> tapply(data,f,ptile)
$a
[1] 0.0 0.5 1.0

$b
[1] 0.0 0.5 1.0

