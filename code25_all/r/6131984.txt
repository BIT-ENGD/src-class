severity = 1 , 2 , 3 (integer code for mild moderate severe)
patid visit bodysys prefterm
Baseline rows are rows such that visit<=2
Post baseline rows are rows such that visit>2

data base1_dset ;
 set ae_dset ;
 if visit<=2 ;

proc sort data=base1_dset ;
 by patid bodysys prefterm severity ;

data base2_dset ;
 set base1_dset ;
 by patid bodysys prefterm severity ;
 if last.prefterm ;

data post1_dset ;
 set ae_dset ;
 if visit> 2 ;

proc sort data=post1_dset ;
 by patid bodysys prefterm severity ;

data post2_dset ;
 set post1_dset ;
 by patid bodysys prefterm severity ;
 if last.prefterm ;
 rename severity = severity2 ;

data new_ae_dset ;
 merge base2_dset post2_dset ;
 by patid bodysys prefterm ;
 if severity2>severity or severity==. ;

inlist ae_dset ;
if not ( visit<=2 ) deleterow ;
select severity=max(severity) by patid bodysys prefterm ;
sendoff(base2_dset) patid bodysys prefterm severity ;

inlist ae_dset ;
if not ( visit>2 ) deleterow ;
select severity2=max(severity) by patid bodysys prefterm ;
sendoff(post2_dset) patid bodysys prefterm severity2 ;

inlist base2_dset post2_dset ;
mergeby patid bodysys prefterm ;
if not ( severity2>severity or severity is null ) deleterow ;
sendoff(new_ae_dset) patid bodysys prefterm severity2 ;

