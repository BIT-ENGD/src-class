#generate the calibration curves
x <- 1:10
calib.data.1 <- x+runif(10)
lm.1 <- lm(calib.data.1~x)
calib.data.2 <- 2*x+runif(10)
lm.2 <- lm(calib.data.2~x)

compound <- factor(c("cpd1", "cpd2"))
values <- runif(2)
raw <- data.frame(compound, values)

choose.calib <- function(raw, cpd)
    if(cpd=="cpd1"){
        calib=coef(lm.1)[1]+val*coef(lm.2)[2]
    }else{
    if(cpd=="cpd2"){
        calib=coef(lm.2)[1]+val*coef(lm.2)[2]
    }else{
        warning("no calib curve for compound")}}
    }

cal<-ddply(raw, .(compound), choose.calib)

