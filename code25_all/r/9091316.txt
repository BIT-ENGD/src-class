m<- matrix(1:9, nrow= 3, ncol=3)
f <- function(x,y,z) {(as.vector(y)%*%x%*%as.vector(y))*z}
f(m,rep(1,3),2)

z<- as.vector(1,2,3)

apply (c(rep(m,3),rep(1,3),rep(2,3)),1,f)

