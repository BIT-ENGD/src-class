z <- scale(x) / sqrt(n-1)   # standardized matrix x such that z'z=correlation matrix
R <- t(z) %*% z             # correlation matrix
I <- diag(py - 1)           # identity matrix(py defined before)
df <- rep(0, length(k))     # k=seq(0,5,0.001)
for (i in seq(0,5,0.001)) {
    H <- z %*% solve(R+(i*I)) %*% t(z)
    tr <- sum(diag(H))
    df <- c(df,tr)          ## problem here
}

df
tr
tr
