f.table <- function(x) {

    if (is.factor(x[[1]])) { 
        frequency <- function(x) {
            x <- round(length(x)/n, digits=2)
        }
        x <- na.omit(melt(x,c()))
        x <- cast(x, variable ~ value, frequency)
        x <- cbind(x,top2=x[,ncol(x)]+x[,ncol(x)-1], bottom=x[,2])
    }

    if (is.numeric(x[[1]])) {
        frequency <- function(x) { 
            x[x > 1] <- 1
            x[is.na(x)] <- 0
            x <- round(sum(x)/n, digits=2) 
            } 

        x <- na.omit(melt(x))
        x <- cast(x, variable ~ ., c(frequency, mean, sd, min, max))
        x <- transform(x, variable=reorder(variable, frequency))
    }

return(x) 
}

n <- 100    
x <- data.frame(a=c(1:25),b=rnorm(100),c=rnorm(100))
x[x > 20] <- NA 

frequency <- function(x) {
                x <- round(length(x)/n, digits=2)
            }
f.table(x)

