df <- data.frame(x = c(1,2,3,4,5,6), index = c('a', 'a', 'b', 'b', 'c', 'c'))

c(1/(1+2), 2/(1+2), 3/(3+4), 3/(3+4), 5/(5+6), 6/(5+6))  

select 
 x / sum(x) over (partition by index) as z 
from df

ddply(df, .(index), transform, z = x / sum(x))

