available.packages()
Error in contrib.url(getOption("repos"), type):
  trying to use CRAN without setting a mirror.
Calls: p_cran -> available.packages -> contrib.url
Execution is halted

x <- getOption("repos")
#SOME HOW TEST IF x IS NOT SET BUT NOT SURE HOW
if (is.not.set(x)){
    y <- get.local.mirror.function()
    options(repos=structure(c(CRAN=y)))
    on.exit(options(repos=structure(c(CRAN=x))))
}

repos
