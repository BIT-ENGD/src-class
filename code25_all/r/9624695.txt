<%

library(reshape2)
library(ggplot2)
library(Cairo)

x <- data.frame(read.table("/R/output/output.txt", sep=",", header=T))
y <- melt(x, id=c("Hostname", "Date", "MetricType"))
y$value <-as.numeric(y$value)
yy <- dcast(y, Hostname + Date + variable ~ MetricType, fun.aggregate=mean)
yy$variable <- as.integer(gsub('Hour', '', yy$variable))
yy$variable <- paste(yy$variable, ":00:00", sep='')
yy$Date <- as.Date(yy$Date, format='%m/%d/%Y')
yy$Date <- paste(yy$Date, yy$variable)
db1 <- subset(yy, yy$Hostname=="server1")
db1<-data.frame(db1)
db1$Date <-as.POSIXct(db1$Date, "%Y-%m-%d %H:%M:%S", tz="EST")

filename <- paste(tempfile(tmpdir='/usr/local/apache2/htdocs'), '.png', sep='')
CairoPNG(filename)
qplot(Date, CPUAVG, data=db1, geom=c("line", "smooth"), method = "lm", ylab="AVG CPU", xlab="Date", main="Server1")
dev.off()


%>
<img src="<%=gsub('/usr/local/apache2/htdocs', '', filename)%>"/>                                   
</body>
</html>

