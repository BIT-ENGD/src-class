queue = Queue.Queue(500)
process = subprocess.Popen(
    command,
    stdout=subprocess.PIPE,
    stderr=subprocess.STDOUT)
iothread = threading.Thread(
    target=simple_io_thread,
    args=(process.stdout, queue))
iothread.daemon=True
iothread.start()

def simple_io_thread(pipe, queue):
    while True:
        line = pipe.readline()
        queue.put(line, block=True)
        if line=="":
            break

process.stdout.close()

IOError: close() called during concurrent operation on the same file object.

os.close(process.stdout.fileno())

close failed in file object destructor: IOError: [Errno 9] Bad file descriptor

