command > >(tee "${stdoutF}") 2> >(tee "${stderrF}" >&2)

$stdoutF
diff -r "$source" "$target" > >(tee "${stdoutF}") 2> >(tee "${stderrF}" >&2)

assertNull 'Unexpected output to stdout' "$(<"$stdoutF")"

sync
sync
assertNull 'Unexpected output to stdout' "$(<"$stdoutF")"

diff -r "$source" "$target" \
> >(tee "${stdoutF}"; assertNull 'Unexpected output to stdout' "$(<"$stdoutF")")
2> >(tee "${stderrF}" >&2)

tee
assertNull
sync
