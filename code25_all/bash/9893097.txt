/some/dir/
/other/fold/
/some/dir
/some/dir/bla/foo/bar/snap_001a
/other/fold/bla/foo/bar/snap_001a
snap_xxxx
scp
rm
#!/bin/bash
# This is invoked by a cronjob ever once in a while.

files=$(find /some/dir/ -name snap_*)

IFS='
'
for current in $files; do
   name=$(basename $current)             # Get base name (i.e. strip directory)
   dir=$(dirname $current)               # Get the directory name of the curent file on tiny
   dir=${dir/\/some\/dir/\/other\/fold}  # Replace the directory root on tiny with the root on the storage server
   ssh -i keyfile myuser@storage.server.net \
     mkidir -p $dir                      # create the directory on the storage server and all parents if needed
   scp -i keyfile $current myuser@storage.server.net:$dir$name \
     && rm $current                      # remove files on success
done

rsync
rsync -av --remove-sent-files --prune-empty-dirs          \
      -e 'ssh -i /full/path/to/keyfile'                   \
      --include="*/" --include="snap_*" --exclude="*"     \
      /some/dir/ myuser@storage.server.com:/other/fold/

--remove-source-files
--remove-sent-files
--dry-run
