ssh root@IP "if '$(cat ~/.ssh/authorized_keys | grep $KEY)' == '';then;echo $KEY >> ~/.ssh/authorized_keys;done"

#!/bin/sh

# Get your RSA key.
KEY=""
for line in $(cat ~/.ssh/id_rsa.pub)
do
    KEY="$KEY $line"
done

# Add your RSA key to the machine's authorized_keys if it's not already there.
ssh root@$1 "grep -q '$KEY' ~/.ssh/authorized_keys || echo '$KEY' >> ~/.ssh/authorized_keys"

# Connect to the machine.
ssh root@$1

