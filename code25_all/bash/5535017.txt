#!/bin/bash


 iteration=0

 for (( ; ; ))
 do
    process_id=`ps -ef | grep java | grep TEST | awk '{print $2}' `
    kill_command='kill -3 '$process_id
    time=`date | awk '{print substr($4,0,5)}' `
    last_write=`ls -l /files/*.txt | awk '{print $8}' `

    if [ "$time" != "$last_write" ]
    then
            $kill_command
            sleep 1

            $kill_command
            sleep 1

            $kill_command
            sleep 1

            /test/show_queue.sh
    fi

    let "iteration+=1"

    if [ "$iteration" == "30" ] 
    then
            let "iteration=0"
            $kill_command
            echo '------------' >> memory_status.log
            date >> memory_status.log
            prstat -n 7 1 1 >>  memory_status.log
            echo '------------' >> memory_status.log
            /test/show_queue.sh
    fi

    sleep 60
   done

