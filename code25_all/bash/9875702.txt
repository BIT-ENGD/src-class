#!/bin/sh

find */ -name '*.tif' > temp-tif-list.txt

FILE="temp-tif-list.txt"

exec 3<&0
exec 0<$FILE
while read line
do
    J2K=`echo "$line" | sed 's/.tif/.jp2/'`
    PSNR=`compare -quiet -metric psnr $line $J2K null: 2>&1 | cut -d . -f 1`
    VALUE=45
    if [ "$PSNR" -le "$VALUE" ]
    then
        echo "possible problem with $line... compare value is $PSNR" >> visual-check.txt
        continue
    fi
done
echo "Deleting generated files..."
rm -f temp-tif-list.txt
exec 0<&3

    foo/
        foo-1.tif
        foo-1.jp2
        foo-2.tif
        foo-2.jp2
    foo2/
        foo2-1.tif
        foo2-1.jp2
        foo2-2.tif
        foo2-2.jp2
    ...
    ...
    etc

    PSNR=`compare -quiet -metric psnr $line $J2K null: 2>&1 | cut -d . -f 1`

    PSNR=`compare -quiet -metric psnr $line[0] $J2K null: 2>&1 | cut -d . -f 1`

