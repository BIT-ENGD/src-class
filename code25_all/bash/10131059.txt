#!/bin/bash

grep -r -l 'var createDocumentFragm' /home/user/Desktop/infected_site/* > /home/user/Desktop/filelist.txt

for i in $(cat /home/user/Desktop/filelist.txt)
do
   cp -f $i $i.bak
done

for i in $(cat /home/user/Desktop/filelist.txt)
do
   $i | sed 's/createDocumentFragm.*//g' > $i.awk
   awk '/<\/SCRIPT>/{p=1;print}/<\/script>/{p=0}!p'

+ for i in '$(cat /home/user/Desktop/filelist.txt)'    
+ sed 's/createDocumentFragm.*//g'    
+ /home/user/Desktop/infected_site/index.htm    

/home/user/Desktop/infected_site/index.htm: line 1: syntax error near unexpected token `<'    
/home/user/Desktop/infected_site/index.htm: line 1: `<html><head><script>(function (){ '    

for i in $(cat /home/user/Desktop/filelist.txt)
do
   rm -f $i.bak
done    

