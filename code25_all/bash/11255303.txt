for host in $(get-all-hosts)
do
  (restart-server $host; wait-for-server-to-come-up $host) &
done

restart-server
wait-for-server-to-come-up
grep -m 1 'server up' <(tail -f /path/to/log)
mkfifo mfifo
exec 3<>mfifo
echo >&3
echo >&3
echo >&3
for host in $(get-all-hosts)
do
  read
  (restart-server $host; wait-for-server-to-come-up $host; echo >&3) &
done <&3

