#!/bin/sh

handle_exit()
{
    # if func2 called first then do some thing to kill func1 also 
    # if func1 called first then do some thing to kill func2 also 

    exit
}

func1()
{
    for i in `seq 40`
    do
        echo I am in func1 $i
        sleep 3

        if [ "$i" = "20" ] ; then # this could be a failure condition
            handle_exit 
        fi
    done
}

func2()
{
    for i in `seq 40`
    do
        echo I am in func2 $i
        sleep 3

        if [ "$i" = "10" ] ; then # this could be a failure condition
            handle_exit             
        fi
    done
}

func1 &

pidfunc1=$!

func2 &

pidfunc2=$!

func1
handle_exit
exit
func1
func2
handle_exit
exit
func2
