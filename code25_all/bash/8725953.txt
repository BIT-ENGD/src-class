#!/bin/bash

function bar
{
  if true; then
    echo "error" >&2
    exit 1
  fi
  echo "bar"
}

function foo
{
  local val=`bar`
  echo $?
  echo "val: $val"
}

foo

foo
function foo
{
  val=`bar` #note no 'local'
  echo $?
  echo "val: $val"
}

error
0
val:

error
1
val:

local
bar
local
val
bar
