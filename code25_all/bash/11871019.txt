#!/bin/bash

function record {
  DATE=$(date "+%d%m%y%H%M%S%N");

  cvlc -vR rtsp://192.168.1.233 \
      --sout=file/mov:/var/www/continuous/%1/$DATE.mov 2>& 1 |

  while read event;
  do
    PID=$!
    lastevent=${event#*]}
    if [ "$lastevent" == "live555 demux warning: no data received in 10s, eof ?" ];
    then
      kill $PID
      record
    fi
  done
}

record &
sleep 65
kill $PID

