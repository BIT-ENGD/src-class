#!/bin/sh
# Save this in: /home/qwertymk/website-live.git/hooks/post-receive

# let's save all of out js files before the checkout
FILES="$(find /home/qwertymk/public_html -type f -name '*.js')"
for f in $FILES
do
 if [[ $f =~ /home/qwertymk/ignore-dir/dev-staging-area/ ]]; then continue; fi
  echo "copying - $f"
  cp $f $f.jscache
done
# done saving js files before checkout

export GIT_WORK_TREE=/home/qwertymk/public_html/
git checkout -f

# minify each js file that changed
cd /home/qwertymk/website-live.git
FILES=$(git whatchanged -n 1 --pretty=format: --name-only | grep '\.js$')
for f in $FILES
do
  echo "processing - $f"
  rm /home/qwertymk/public_html/$f.jscache
  php /home/qwertymk/jsmin/curl.php /home/qwertymk/public_html/$f
done
# done minifing

# anything that has a .jscache should be moved to the .js
FILES="$(find /home/qwertymk/public_html -type f -name '*.js')"
for f in $FILES
do
 if [[ $f =~ /home/qwertymk/public_html/dev-staging-area/ ]]; then continue; fi
 if [ ! -f $f.jscache ]; then continue; fi
  echo "restoring - $f"
  rm $f
  mv $f.jscache $f
done

