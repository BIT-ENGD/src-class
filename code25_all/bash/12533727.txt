$ ls $P
dirs/ are/ here/
$ cd /not/the/P/path
$ ls
other/ stuff/
$ myProg <tab>
dirs/ are/ here

_myProg ()
{
  local cur

  COMPREPLY=()
  cur=${COMP_WORDS[COMP_CWORD]}

  if [ "${P}x" = "x" ]; then
    return 1
  fi

  case "$cur" in
    *)
      pth=${P}/$( echo $cur | egrep -o "^.*/[^/]*$" )
      COMPREPLY=( $( compgen -W "$( cd $pth && ls -1d "$cur"* 2>/dev/null -- "$cur" )" ) )
      ;;
  esac

  return 0
}
complete -o nospace -F _myProg myProg

ls
