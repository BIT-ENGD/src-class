while true; do
    echo -n t > /dev/ttyACM0
    echo "$(date): Queried Arduino for temperature."
    sleep 10
    echo -n l > /dev/ttyACM0
    echo "$(date): Queried Arduino for light."
    sleep 10
done

ARDUINO_PORT=/dev/ttyACM0
ARDUINO_SPEED=9600
API_KEY='MY_PACHUBE_KEY'
FEED_ID='MY_FEED_ID'

# Set speed for usb
stty -F $ARDUINO_PORT ispeed $ARDUINO_SPEED ospeed $ARDUINO_SPEED raw
exec 6<$ARDUINO_PORT

# Read data from Arduino
while read -u 6 f ;do
    # Remove trailing carriage return character added
    # by println to satisfy stupid MS-DOS Computers
    f=${f:0:${#f} - 1}

    curl --request PUT --header "X-PachubeApiKey: $API_KEY" --data-binary "{ \"version\":\"1.0.0\", \"datastreams\":[ $f ] }" "http://api.pachube.com/v2/feeds/MY_FEED_ID"
    echo "$(date) $f was read."
done

