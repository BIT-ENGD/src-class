<!-- Begin foo.html -->
<p>some html code</p>

    <!-- Begin foo2.html -->
    <p>some html code</p>
    <!-- End foo2.html -->

<!-- End foo.html -->

<!-- Begin bar.html -->
<p>some html code</p>
<!-- End bar.html -->

awk '/<!-- Begin (.*?)-->/ {f=$1} f{print > f}  /<!-- End \1 -->/{close f; f=""}' index.html

