<input type="hidden" id="_lblId" value="<%=Model.Id%>"/>

$(function() {
var id = parseInt($("#_lblId").val());
$.ajaxSetup({ cache: false });
if (google.maps.BrowserIsCompatible()) {            
    $.getJSON("/Maptest/Element/Tracemap", {id: id},  initialise);
}
});

public ActionResult Tracemap(int id)
    {

        var map = new Map();

        var tracedata = _dataRep.ListSkanningerPaaKomponent(Convert.ToInt32(id));
        map.Name = "trace for element - " +id;
        map.Zoom = 2;
        map.LatLng = new LatLng { Latitude = 0.0, Longitude = 0.0 };
        var cnt = 0;
        foreach (var t in tracedata)
        {
            cnt++;

            var trace = new Trace
                            {
                                Name = "Trace " + cnt,
                                LatLng = new LatLng {Latitude = (double) t.Lat,                  Longitude = (double) t.Long},
                                Dato = (DateTime) t.Dato,
                                Tid = (DateTime) t.Tid,
                                Person = t.PersonId
            };
            map.Add(trace);
        }

        return Json(map);

    }

