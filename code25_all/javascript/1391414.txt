<input type="button" onclick="statusSubmit('Permission to publish : ');" value="Check connection status" />

<script type="text/javascript">
function statusSubmit(status)
{
    facebook_prompt_permission('publish_stream', function(accepted)
    {
        if(accepted) {
            // User (already) has permission
            alert(status + 'already granted');
        }
        else
        {
            //  User does not have permission
            alert(status + ' not granted');
        }
    });
}

function facebook_prompt_permission(permission, callbackFunc)
{
    // Check if user has permission, if not invoke dialog.
    FB.ensureInit(function() {
        FB.Connect.requireSession(function(){
            //check is user already granted for this permission or not
            FB.Facebook.apiClient.users_hasAppPermission(permission,
            function(result) {
                // prompt offline permission
                if (result == 0) {
                    // render the permission dialog
                    FB.Connect.showPermissionDialog(permission,
                    function(result){
                        if (null == result)
                            alert('no permissons granted');
                        else
                            alert('permissions ' + result);
                    }, true, null);
                } else {
                    // permission already granted.
                    callbackFunc(true);
                }
            });
        });
    });
}
</script>

