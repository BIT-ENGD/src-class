buttonparams.IsCommandButton = true;
buttonparams.ButtonId = "testsettings";
buttonparams.ButtonText = "Sending Test Mail...";
buttonparams.ButtonOrigText = "Test Settings";

if(buttonparams.IsCommandButton == true)
    HandleButtonStatus(true, buttonparams);

var request = function()
{
    var ret = SendForm(buttonparams);

    alert(ret);

}
window.setTimeout(request, 0);  

http = yXMLHttpRequest();

http.open("POST", "./", false);
http.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); 
http.setRequestHeader("Req-Type", "ajax");
formdata = xEncodePair("_object", "PrefMgr")+ "&";
formdata += xEncodePair("_action", "SmtpTest")+ "&";
formdata += GetEncodedFormData();   

http.send(formdata);

if(http.status == 200)
{   
    if(pButtonParams.IsCommandButton == true)
        HandleButtonStatus(false, pButtonParams);

    return (http.responseText);
}   
else
{

    return ("Error " + http.status + ": " + http.statusText);   
}   

if(pIsButtonStatusChange)
{
        document.body.style.cursor = "wait";
    button.value = pButtonParams.ButtonText;
    button.disabled = true;

}
else
{
    document.body.style.cursor = "default";
    button.disabled = false;
    button.value = pButtonParams.ButtonOrigText;
}

