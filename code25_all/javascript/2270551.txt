var dataStore = new Ext.data.JsonStore({
    url: '/ajaxGateway.php',
    root: 'data',
    baseParams: {
        useClass: 'App_GeoIP_GeoIP',
        useMethod: 'getLocationsStartingWith'
    },
    fields: [
             {name:'text', mapping:'TITLE'},
             {name:'stateName', mapping:'STATE_NAME'},
             {name:'regionHierarchy', mapping:'REGION_HIERARCHY'},
             {name:'id', mapping:'ID', type:'int'},
             {name:'lat', mapping:'LATITUDE', type:'float'},
             {name:'lng', mapping:'LONGITUDE', type:'float'}
            ]
});

var resultTpl = new Ext.XTemplate(
    '<tpl for="."><div class="search-item" style="text-align:left">',
    '<span>{text}, <small>{stateName}</small></span>',
    '</div></tpl>'
);

var locationBasedRulesTree = new Ext.tree.TreePanel({
    title: 'Location Based Regions',
    height: 329,
    width: 480,
    autoScroll: true,
    useArrows: true,
    animate: false,
    rootVisible: false,
    frame: true,
    enableDrag: true,
    root: new Ext.tree.AsyncTreeNode({
        id:'custom_root'
    }),
    tbar: new Ext.Toolbar(),
    listeners:
    {
        listenersHandlers...: function(){}
    }
});

locationBasedRulesTree.getTopToolbar().addField(
    new Ext.form.ComboBox({
        store: dataStore,
        displayField: 'text',
        typeAhead: false,
        loadingText: 'Finding...',
        blankText: "Search for a Place...",
        width: (Ext.isIE6) ? 155:200,
        hideTrigger: true,
        forceSelection: true,
        selectOnFocus:true,
        tpl: resultTpl,
        itemSelector: 'div.search-item',
        enableKeyEvents: true,
        onSelect: function(record)
        {
            selectHandler...();
        },
        listeners:
        {
            keypress : function(comboBox, event) {
                keypressHandler...();
            }
        }
    })
);

