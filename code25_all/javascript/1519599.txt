jQuery(document).ready(function() {

var opts;

jQuery.fn.trackAllLinks = function(settings) {
    settings = jQuery.extend({}, jQuery.fn.trackAllLinks.defaults, settings);
    opts = settings;

    function track() {
        href = jQuery(this).attr('href');
        var trackImage = new Image(1, 1);
        trackImage.src = opts.linkredirector + '?eurl=' + jQuery.URLEncode(href) + '&rnd=' + new Date().getTime() + '&title=trackerimage.gif';
        trackImage.onload = function() { 
            trackImage.onload = null; 
            doNothing(); 
        }
        delay(300);
        return true;
    };

    function delay(mseconds) {
        var currentTime = new Date();
        var endTime = currentTime.getTime() + mseconds;
        while (currentTime.getTime() < endTime) {
            currentTime = new Date();
        }
    }

    function doNothing() { 
    }

    if(jQuery(this).is("a")) {
        jQuery(this).click(track);
    }

    jQuery(this).find("a").click(track);

};

jQuery.fn.trackAllLinks.defaults = {
    linkredirector : '__url_to_post_on__'
};

});

