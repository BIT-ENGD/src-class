import UIKit
import SpriteKit

class MenuViewController: UIViewController {
    let background = UIImageView(image: UIImage(named: "background.png"))
    let titleImg = UIImageView(image: UIImage(named: "title.png"))

    override func viewDidLoad() {
        background.frame = self.view.frame
        titleImg.frame = CGRectMake(0, 0, self.view.frame.width, 100)
        self.view.addSubview(background)
        self.view.addSubview(titleImg)
        let bp = ButtonPositions(controller: self)
        let play = button(bp.playY, named: "playButton.png")
        let leader = button(bp.leaderY, named: "leaderButton.png")
        let rate = button(bp.rateY, named: "rateButton.png")
        play.addTarget(self, action: "playPressed", forControlEvents: UIControlEvents.TouchDown)
        leader.addTarget(self, action: "leaderPressed", forControlEvents: UIControlEvents.TouchDown)
        rate.addTarget(self, action: "ratePressed", forControlEvents: UIControlEvents.TouchDown)
        self.view.addSubview(rate)
        self.view.addSubview(leader)
        self.view.addSubview(play)
     }

    func button(y:CGFloat, named name:String!) -> UIButton {
        let bp = ButtonPositions(controller: self)
        let img = UIImage(named: name)
        let b = UIButton(frame: CGRectMake(bp.x, y, self.view.frame.width / 1.5, img.size.height))
        b.setImage(img, forState: UIControlState.Normal)
        return b
    }

    func playPressed() {
        println("playPressed") //only prints once
       changeVC()
    }

    func changeVC() {
        self.presentViewController(GameViewController(), animated: true, completion: nil) //maybe initializing the GameViewController twice for some reason?
    }

    func leaderPressed() {

    }

    func ratePressed() {

    }

    func center() -> CGPoint {
        return CGPoint(x: CGRectGetMidX(self.view.frame), y: CGRectGetMidY(self.view.frame))
    }

    override func prefersStatusBarHidden() -> Bool {
        return true
    }
}


class GameViewController: UIViewController {
    override func viewWillLayoutSubviews() {
        super.viewWillLayoutSubviews()
        //prepareGame() 
        println("test") //this prints twice, even through the button press event is only triggered once
    }

    func prepareGame() {
            let skView = self.view as SKView //crashes here when called
            let scene = GameScene(size: self.view.bounds.size)
            skView.showsFPS = true
            skView.showsNodeCount = true
            skView.ignoresSiblingOrder = true
            scene.scaleMode = .AspectFill
            skView.presentScene(scene)

    }

    override func shouldAutorotate() -> Bool {
       return true
    }

    override func supportedInterfaceOrientations() -> Int {
        if UIDevice.currentDevice().userInterfaceIdiom == .Phone {
            return Int(UIInterfaceOrientationMask.AllButUpsideDown.toRaw())
        } else {
            return Int(UIInterfaceOrientationMask.All.toRaw())
        }
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
    }

    override func prefersStatusBarHidden() -> Bool {
        return false
    }
}

