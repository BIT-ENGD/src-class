override func viewDidLoad() {

    super.viewDidLoad()
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), {
        var data = self.getStoresData()
        dispatch_async(dispatch_get_main_queue(), {
            self.parseStoresData(data)
            self.resultsController = PartnerStore.getAllStores()

        });
    });
}

func getStoresData() -> [NSDictionary]
{
    var responseData = [NSDictionary]()
    self.refreshControl.beginRefreshing()
    AppDelegate.appDelegate().httpRequestOperationManager?.GET(
        "partner_stores/",
        parameters: nil,
        success: { (operation: AFHTTPRequestOperation!, responseObject: AnyObject!) in
            self.tableView.reloadData();
            println("RESPONSE OBJECT IN GET PARTNER STORES: \(responseObject)") },
        failure: { (operation: AFHTTPRequestOperation!, error: NSError!) in
            println("FAIL IN GET PARTNER STORES: \(error)") })
    self.refreshControl.endRefreshing()
    return responseData
}

func parseStoresData(storesData: [NSDictionary])
{
    for storeDict in storesData {
// just inserts a new object to CoreData
        PartnerStore.addNewStore(storeDict)
    }
}

