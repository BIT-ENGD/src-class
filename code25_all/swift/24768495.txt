class AppDelegate: NSObject, NSApplicationDelegate {

var statusItem : NSStatusItem

init() {
    statusItem = NSStatusBar.systemStatusBar().statusItemWithLength(CGFloat(-2))

    // When the bug is fixed, replace the line above with this line.
    //statusItem = NSStatusBar.systemStatusBar().statusItemWithLength(CGFloat(NSSquareStatusItemLength))
}

override func awakeFromNib() {
    SetupStatusItem()
}

func SetupStatusItem() {
    statusItem.title = nil
    var icon = NSImage(named: "Moon_Full.png")
    icon.size = NSSize(width: 16, height: 16)
    icon.setTemplate(true)
    statusItem.button.image = icon
    statusItem.button.action = "StatusItemClicked"
}

func StatusItemClicked()  {

    if (statusItem.button.appearsDisabled)
    {
        statusItem.button.appearsDisabled = false
        println("Hide NSPopover here")
    }
    else
    {
        statusItem.button.appearsDisabled = true
        println("Show NSPopover here")
    }
}
}

performSegueWithIdentifier("ShowPop", sender: sender)

    var newView = NSView(frame: sender.frame)
    var popupViewController = ViewController(nibName: "PopupViewController", bundle: NSBundle(identifier: "PopupViewController"))

    presentViewController(popupViewController,asPopoverRelativeToRect: sender.frame, ofView: newView,preferredEdge: NSRectEdge.max,behavior: NSPopoverBehavior.Transient)

