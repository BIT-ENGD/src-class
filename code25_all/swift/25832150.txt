func squareImageFromImage(image:UIImage, newSize: CGFloat) -> UIImage {
    var scaleTransform :CGAffineTransform
    var  origin : CGPoint
    var scaleRatio: CGFloat

    if (image.size.width > image.size.height) {
        scaleRatio = newSize / image.size.height
        scaleTransform = CGAffineTransformMakeScale(scaleRatio, scaleRatio);

        origin = CGPointMake(-(image.size.width - image.size.height) / 2.0, 0)
    } else {
        scaleRatio = newSize / image.size.width
        scaleTransform = CGAffineTransformMakeScale(scaleRatio, scaleRatio);

        origin = CGPointMake(0, -(image.size.height - image.size.width) / 2.0)
    }

    var size: CGSize  = CGSizeMake(newSize, newSize)

    if (UIScreen.mainScreen().respondsToSelector(aSelector: scaleTransform)) {

        UIGraphicsBeginImageContextWithOptions(size, false, 0.0)

    } else {

        UIGraphicsBeginImageContext(size)
    }

    var context: CGContextRef = UIGraphicsGetCurrentContext()
    CGContextConcatCTM(context, scaleTransform)

    image.drawAtPoint(origin)

    var newImage:UIImage = UIGraphicsGetImageFromCurrentImageContext()

    UIGraphicsEndImageContext()

    return newImage
}

