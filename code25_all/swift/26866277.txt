let userdefault = NSUserDefaults.standardUserDefaults()
var params:Dictionary<String,String> = Dictionary()

override init() {
    var league_id = userdefault.valueForKeyPath("userdata.User.active_league") as Int
    var hash = userdefault.valueForKeyPath("userdata.encrypted") as String
    var token = userdefault.valueForKeyPath("userdata.token") as String

    params = ["token": token, "hash": hash, "league_id": String(league_id)]
}

func switchleague(active_league: Int) -> Bool {
    var switched = false
    var url = "switchleague"
    var user_id = userdefault.valueForKeyPath("userdata.User.id") as Int
// following error is shown to the code line below
// Thread 1:EXC_BAD_ACCESS (code=EXC_i386_GPFLT)
    params.updateValue(String(active_league), forKey: "active_league") 
    params.updateValue(String(user_id), forKey: "user_id")
    var resp:AnyObject = conn.postArrayToUrl(base + url, params: params)
    switched = resp.valueForKey("success") as Bool
    if(switched == true) {
        var league_id = resp.valueForKey("active_league") as Int
        userdefault.setObject(league_id, forKey: "userdata.User.active_league")
        userdefault.synchronize()
    }
    return switched
}

