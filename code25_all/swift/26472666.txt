    func animateTransition(transitionContext: UIViewControllerContextTransitioning) {
    println("animating transition")
    var containerView = transitionContext.containerView()
    var toViewController = transitionContext.viewControllerForKey(UITransitionContextToViewControllerKey)!
    var fromViewController = transitionContext.viewControllerForKey(UITransitionContextFromViewControllerKey)!
    var window = UIApplication.sharedApplication().keyWindow
    var imageCenter = imageViewToSegue.center
    var frame = window.convertRect(imageViewToSegue.frame, fromView: fromView)


    var www = imageViewToSegue.image?.size.width
    var hhh = imageViewToSegue.image?.size.height
    var index = www! / self.view.frame.width


    if (isPresenting) {
        var copyImageView = UIImageView(frame: imageViewToSegue.frame)
        copyImageView.frame.origin = view.convertPoint(imageViewToSegue.frame.origin, fromView: fromView)
        copyImageView.image = imageViewToSegue.image
        copyImageView.contentMode = imageViewToSegue.contentMode
        copyImageView.clipsToBounds = true
        copyImageView.userInteractionEnabled = true
        window.addSubview(copyImageView)

        containerView.addSubview(toViewController.view)
        toViewController.view.alpha = 0

        if let vc = toViewController as? ImageViewController {
            vc.imageView.hidden = true
        }

        UIView.animateWithDuration(0.4, animations: { () -> Void in
        copyImageView.frame = CGRect(x: 0, y: (self.view.bounds.height / 2) - ( hhh!/(index * 2)), width: www!/index , height: hhh!/index)

            toViewController.view.alpha = 1
            }) { (finished: Bool) -> Void in
                copyImageView.removeFromSuperview()
                if let vc = toViewController as? ImageViewController {
                    vc.imageView.hidden = false
                }
                transitionContext.completeTransition(true)
        }

    } else {
        let vc = fromViewController as ImageViewController

        var copyImageView = UIImageView(frame: vc.imageView.frame)
                copyImageView.frame = CGRect(x: 0, y: (self.view.bounds.height / 2) - ( hhh!/(index * 2)), width: www!/index , height: hhh!/index)

        copyImageView.image = imageViewToSegue.image
        copyImageView.contentMode = imageViewToSegue.contentMode
        copyImageView.clipsToBounds = true
        copyImageView.userInteractionEnabled = true
        window.addSubview(copyImageView)
        vc.imageView.hidden = true

        UIView.animateWithDuration(0.4, animations: { () -> Void in
            fromViewController.view.alpha = 0
            copyImageView.frame = frame
            }) { (finished: Bool) -> Void in
                copyImageView.removeFromSuperview()
                transitionContext.completeTransition(true)
                fromViewController.view.removeFromSuperview()

        }
    }
}

