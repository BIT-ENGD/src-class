--Check all DB's for Guest permissions.
--Guest user should NOT be disabled on system databases https://support.microsoft.com/en-us/kb/2539091

exec sp_MSforeachdb '
SELECT Db_name = ''?''
, prins.name AS grantee_name
, perms.permission_name
, state_desc
, Revoke_TSQL = CASE WHEN state_desc = ''GRANT'' and db_ID(''?'') > 4 THEN ''use [?]; REVOKE CONNECT TO GUEST;'' END
, *
FROM [?].sys.database_principals AS prins 
INNER JOIN [?].sys.database_permissions AS perms
ON perms.grantee_principal_id = prins.principal_id
WHERE prins.name = ''guest'' 
AND state_desc = ''GRANT''

'
drop table VMS.MANCHU_VERB_STEM;

CREATE TABLE VMS.MANCHU_VERB_STEM (
 ID NUMBER,
 STEM VARCHAR2(70),
 TRANSLATION VARCHAR2(500)
);

ALTER TABLE VMS.MANCHU_VERB_STEM ADD PRIMARY KEY( ID );

CREATE INDEX IX_MCH_VERB_STEM ON VMS.MANCHU_VERB_STEM ( STEM);


INSERT INTO VMS.MANCHU_VERB_STEM ( ID, STEM, TRANSLATION )
 SELECT ID, substr( d.word ,1, length( d.word)-3 ), translation
  FROM VMS.MANCHU_DICT_JOIN d
  WHERE d.word like '%MBI';
  
  COMMIT;
  
  