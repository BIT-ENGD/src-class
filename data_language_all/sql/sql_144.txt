/* Load the 2012-2013 DocGraph Data with new fields into a database */

create table teaming_graph_providers_2012_2013
    (npi_from char(10),
     npi_to char(10),
     shared_transaction_count integer,
     patient_total integer,
     same_day_total integer);
     
     
     
LOAD DATA INFILE '/tmp/DocGraph-2012-2013-Days30.csv' INTO TABLE teaming_graph_providers_2012_2013
      FIELDS TERMINATED BY ',' ENCLOSED BY '"' ESCAPED BY '\0'
      LINES TERMINATED BY '\n'
       (@npi_from, @npi_to, @shared_transaction_count, @patient_total, @same_day_total)
       set
       npi_from = case @npi_from when '' then NULL else @npi_from end,
       npi_to = case @npi_to when '' then NULL else @npi_to end,
       shared_transaction_count = case @shared_transaction_count when '' then NULL else @shared_transaction_count end,
       patient_total = case @patient_total when '' then NULL else @patient_total end,
       same_day_total = case @same_day_total when '' then NULL else @same_day_total end;
       
 create index idx_dg_30_13_npi_from on teaming_graph_providers_2012_2013(npi_from);
 create index idx_dg_30_13_npi_to on teaming_graph_providers_2012_2013(npi_to);
        -- http://help.sap.com/businessobject/product_guides/vi01/en/lumS115_user_en.pdf
-- http://help.sap.com/boall_en/

DROP USER LUMIRAUSER;
CREATE USER LUMIRAUSER PASSWORD Password1;
CALL GRANT_ACTIVATED_ROLE('sap.bi.common::BI_DATA_ANALYST','LUMIRAUSER');
CALL GRANT_ACTIVATED_ROLE('sap.bi.common::BI_TECH_USER','LUMIRAUSER');
GRANT MODELING TO LUMIRAUSER;
GRANT REPO.READ ON "live2_views" TO LUMIRAUSER;

-- %%%% Lumira Server Demo %%%%
Remember to change Tweets Table to Tweets_for_Live2CD Table in Analytic View
Build Sentiment Analyis Over Time Stacked Bar Chart

-- reset
delete from "LIVE2"."Tweets_for_Live2CD"
where "tweetId" > 9990;
delete from "LIVE2"."$TA_MYINDEX_VOC_WITH_LIVE2CD"
where "tweetId" > 9990;
SELECT count(*) FROM "LIVE2"."$TA_MYINDEX_VOC_WITH_LIVE2CD"
where TA_TYPE = 'WeakPositiveSentiment';
-- insert new data
insert into "LIVE2"."Tweets_for_Live2CD"
values(9991,1,'2008.9.27 01:01:00 AM','Liked the speech by Obama !');
-- select new insert
SELECT * FROM "LIVE2"."Tweets_for_Live2CD"
order by 3 asc;
-- select new data in index table
SELECT * FROM "LIVE2"."$TA_MYINDEX_VOC_WITH_LIVE2CD"
order by 1 desc;
SELECT count(*) FROM "LIVE2"."$TA_MYINDEX_VOC_WITH_LIVE2CD"
where TA_TYPE = 'WeakPositiveSentiment';
